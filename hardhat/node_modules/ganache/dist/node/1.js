/*! For license information please see 1.js.LICENSE.txt */
exports.id=1,exports.ids=[1],exports.modules={10:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Address=void 0;const s=r(1);class Address extends s.Data{constructor(e){super(e,Address.ByteLength)}static from(e){return new Address(e)}static toBuffer(e){return Address.from(e).toBuffer()}static toString(e){return Address.from(e).toString()}}t.Address=Address,Address.ByteLength=20},74:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(428),t),n(r(435),t),n(r(812),t),n(r(436),t)},811:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BlockParams=void 0,t.BlockParams={INITIAL_BASE_FEE_PER_GAS:1000000000n,ELASTICITY:2n,BASE_FEE_MAX_CHANGE_DENOMINATOR:8n}},428:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Block=void 0;const s=r(1),n=r(36),i=r(15),a=r(435),o=r(1),c=r(811);class Block{constructor(e,t){if(this._common=t,e){const t=(0,i.decode)(e);this._raw=t[0],this._rawTransactions=t[1]||[];const r=t[3];this.header=(0,a.makeHeader)(this._raw,r),this._rawTransactionMetaData=t[4]||[],this._size=s.Quantity.toNumber(t[5])}}hash(){return this._hash||(this._hash=s.Data.from((0,o.keccak)((0,i.encode)(this._raw)),32))}getTransactions(){const e=this._common;return this._rawTransactions.map(((t,r)=>{const[i,a]=this._rawTransactionMetaData[r],o=[i,a,this.hash().toBuffer(),this.header.number.toBuffer(),s.Quantity.toBuffer(r)];return n.TransactionFactory.fromDatabaseTx(t,e,o)}))}toJSON(e){const t=this.hash(),r=this.getTxFn(e),i=t.toBuffer(),a=this.header,o=a.number.toBuffer(),c=this._common,l=this._rawTransactions.map(((e,t)=>{const[l,u]=this._rawTransactionMetaData[t],h=[l,u,i,o,s.Quantity.toBuffer(t)],d=n.TransactionFactory.fromDatabaseTx(e,c,h);return d.updateEffectiveGasPrice(a.baseFeePerGas),r(d)}));return{hash:t,...a,size:s.Quantity.from(this._size),transactions:l,uncles:[]}}getTxFn(e=!1){return e?e=>e.toJSON(this._common):e=>e.hash}static fromParts(e,t,r,s,n,i){const o=new Block(null,i);return o._raw=e,o._rawTransactions=t,o.header=(0,a.makeHeader)(e,r),o._rawTransactionMetaData=s,o._size=n,o}static calcNextBaseFeeBigInt(e){let t;const r=e,s=r.gasLimit.toBigInt()/c.BlockParams.ELASTICITY,n=r.gasUsed.toBigInt(),i=r.baseFeePerGas?r.baseFeePerGas.toBigInt():c.BlockParams.INITIAL_BASE_FEE_PER_GAS;if(s===n)t=i;else if(n>s){const e=i*(n-s)/s/c.BlockParams.BASE_FEE_MAX_CHANGE_DENOMINATOR;t=e>1n?i+e:i+1n}else{t=i-i*(s-n)/s/c.BlockParams.BASE_FEE_MAX_CHANGE_DENOMINATOR}return t}static calcNBlocksMaxBaseFee(e,t){const{BASE_FEE_MAX_CHANGE_DENOMINATOR:r}=c.BlockParams;let s=this.calcNextBaseFeeBigInt(t);for(;--e;)s+=s/r;return s}static calcNextBaseFee(e){const t=e.header;return void 0===t.baseFeePerGas?void 0:this.calcNextBaseFeeBigInt(t)}}t.Block=Block,Block.INITIAL_BASE_FEE_PER_GAS=c.BlockParams.INITIAL_BASE_FEE_PER_GAS},435:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RuntimeBlock=t.makeHeader=t.getBlockSize=void 0;const s=r(1),n=r(0),i=r(436),a=r(428);class BnExtra extends n.BN{constructor(e){super(e,10,"be"),this.buf=e}}function makeHeader(e,t){return{parentHash:s.Data.from(e[0],32),sha3Uncles:s.Data.from(e[1],32),miner:s.Data.from(e[2],20),stateRoot:s.Data.from(e[3],32),transactionsRoot:s.Data.from(e[4],32),receiptsRoot:s.Data.from(e[5],32),logsBloom:s.Data.from(e[6],256),difficulty:s.Quantity.from(e[7],!1),number:s.Quantity.from(e[8],!1),gasLimit:s.Quantity.from(e[9],!1),gasUsed:s.Quantity.from(e[10],!1),timestamp:s.Quantity.from(e[11],!1),extraData:s.Data.from(e[12]),mixHash:s.Data.from(e[13],32),nonce:s.Data.from(e[14],8),totalDifficulty:s.Quantity.from(t,!1),baseFeePerGas:void 0===e[15]?void 0:s.Quantity.from(e[15],!1)}}t.getBlockSize=function getBlockSize(e,t){return e.length-t.length},t.makeHeader=makeHeader;t.RuntimeBlock=class RuntimeBlock{constructor(e,t,r,n,i,a,o,c,l){this.serializeBaseFeePerGas=!0;const u=a.toBuffer(),h=r.toBuffer();this.header={parentHash:t.toBuffer(),coinbase:{buf:h,toBuffer:()=>h},number:new BnExtra(e.toBuffer()),difficulty:new BnExtra(o.toBuffer()),totalDifficulty:s.Quantity.from(c.toBigInt()+o.toBigInt()).toBuffer(),gasLimit:new BnExtra(n),gasUsed:new BnExtra(i),timestamp:new BnExtra(u),baseFeePerGas:new BnExtra(void 0===l?s.BUFFER_ZERO:s.Quantity.toBuffer(l))},void 0===l&&(this.serializeBaseFeePerGas=!1)}finalize(e,t,r,o,c,l,u,h){const{header:d}=this,p=[d.parentHash,n.KECCAK256_RLP_ARRAY,d.coinbase.buf,o,e,t,r,d.difficulty.buf,d.number.buf,d.gasLimit.buf,0n===c?s.BUFFER_EMPTY:s.Quantity.toBuffer(c),d.timestamp.buf,l.toBuffer(),s.BUFFER_32_ZERO,s.BUFFER_8_ZERO];this.serializeBaseFeePerGas&&void 0!==d.baseFeePerGas&&(p[15]=d.baseFeePerGas.buf);const{totalDifficulty:m}=d,g=[],y=[];u.forEach((e=>{g.push(e.raw),y.push([e.from.toBuffer(),e.hash.toBuffer()])}));const{serialized:w,size:b}=(0,i.serialize)([p,g,[],m,y]),_=new a.Block(null,u.length>0?u[0].common:null);return _._raw=p,_._rawTransactions=g,_.header=makeHeader(p,m),_.serializeBaseFeePerGas=void 0===p[15],_._rawTransactionMetaData=y,_._size=b,{block:_,serialized:w,storageKeys:h,transactions:u}}}},436:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;const s=r(15),n=r(1);t.serialize=function serialize(e){const t=(0,s.encodeRange)(e,0,3),r=t.length,i=(0,s.encodeLength)(r,192).length+r,a=(0,s.encodeRange)(e,3,2),o=(0,s.encode)((0,n.uintToBuffer)(i));return{serialized:(0,s.digest)([t.output,a.output,[o]],r+a.length+o.length),size:i}}},812:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},312:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(313),t),n(r(894),t)},894:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},298:function(e,t,r){"use strict";var s,n,i,a,o,c,l=this&&this.__decorate||function(e,t,r,s){var n,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(i<3?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},u=this&&this.__classPrivateFieldSet||function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r},h=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const p=r(5),m=r(74),g=r(36),y=r(0),w=r(357),b=r(1),_=d(r(177)),v=d(r(830)),k=r(831),E=r(442),B=r(15),P=r(10),A=r(181);async function autofillDefaultTransactionValues(e,t,r,s,n,i){if(e.gas.isNull()){const r=i.miner.defaultTransactionGasLimit;r===b.Quantity.Empty?e.gas=await t(s,p.Tag.latest):e.gas=r}if("gasPrice"in e&&e.gasPrice.isNull()&&(e.gasPrice=i.miner.defaultGasPrice),"maxFeePerGas"in e&&e.maxFeePerGas.isNull()){const t=n.blocks.latest;e.maxFeePerGas=b.Quantity.from(m.Block.calcNBlocksMaxBaseFee(3,t.header))}"maxPriorityFeePerGas"in e&&e.maxPriorityFeePerGas.isNull()&&(e.maxPriorityFeePerGas=await r())}const T=b.Data.from("0x3f"),O={eth:"1.0",net:"1.0",rpc:"1.0",web3:"1.0",evm:"1.0",personal:"1.0"};function assertExceptionalTransactions(e){let t,r=null;const s={};if(e.forEach((e=>{e.execException&&(r?(r=p.VM_EXCEPTIONS,t.push(`${e.hash.toString()}: ${e.execException}\n`),s[e.execException.data.hash]=e.execException.data):(r=p.VM_EXCEPTION,t=[e.execException.message],s[e.execException.data.hash]=e.execException.data))})),r){const e=new Error(r+t.join("\n"));throw e.data=s,e}}class EthereumApi{constructor(e,t,r){var l;s.set(this,(l=0,()=>b.Quantity.from(++l))),n.set(this,new Map),i.set(this,new Map),a.set(this,void 0),o.set(this,void 0),c.set(this,void 0),u(this,a,e,"f"),u(this,c,t,"f"),u(this,o,r,"f")}async db_putString(e,t,r){return!1}async db_getString(e,t){return""}async db_putHex(e,t,r){return!1}async db_getHex(e,t){return"0x00"}async bzz_hive(){return[]}async bzz_info(){return[]}async evm_mine(e){const t=h(this,o,"f"),r=h(this,a,"f").chain.vmErrorsOnRPCResponse;if(null!==e&&"object"==typeof e){let{blocks:s,timestamp:n}=e;null==s&&(s=1);for(let e=0;e<s;e++){const{transactions:e}=await t.mine(A.Capacity.FillBlock,n,!0);r&&assertExceptionalTransactions(e)}}else{const{transactions:s}=await t.mine(A.Capacity.FillBlock,e,!0);r&&assertExceptionalTransactions(s)}return"0x0"}async evm_setAccountNonce(e,t){const r=P.Address.from(e).toBuffer(),s=h(this,o,"f"),n=s.vm.stateManager,i=await n.getAccount({buf:r});return i.nonce={toArrayLike:()=>b.Quantity.toBuffer(t)},await n.putAccount({buf:r},i),await s.mine(A.Capacity.Empty),!0}async evm_setAccountBalance(e,t){const r=P.Address.from(e).toBuffer(),s=h(this,o,"f"),n=s.vm.stateManager,i=await n.getAccount({buf:r});return i.balance={toArrayLike:()=>b.Quantity.toBuffer(t)},await n.putAccount({buf:r},i),await s.mine(A.Capacity.Empty),!0}async evm_setAccountCode(e,t){const r=P.Address.from(e).toBuffer(),s=b.Data.toBuffer(t),n=h(this,o,"f"),i=n.vm.stateManager;if(s.length>0)await i.putContractCode({buf:r},s);else{const e=await i.getAccount({buf:r});e.codeHash=y.KECCAK256_NULL,await i.putAccount({buf:r},e)}return await n.mine(A.Capacity.Empty),!0}async evm_setAccountStorageAt(e,t,r){const s=P.Address.from(e).toBuffer(),n=b.Data.toBuffer(t),i=b.Data.toBuffer(r),a=h(this,o,"f"),c=a.vm.stateManager;return await c.putContractStorage({buf:s},n,i),await a.mine(A.Capacity.Empty),!0}async evm_increaseTime(e){const t=1e3*("number"==typeof e?e:b.Quantity.toNumber(e));return Math.floor(h(this,o,"f").increaseTime(t)/1e3)}async evm_setTime(e){let t;switch(typeof e){case"object":t=e.getTime();break;case"number":t=e;break;default:t=b.Quantity.toNumber(e)}const r=h(this,o,"f").setTimeDiff(t);return Math.floor(r/1e3)}async evm_revert(e){return h(this,o,"f").revert(b.Quantity.from(e))}async evm_snapshot(){return b.Quantity.from(h(this,o,"f").snapshot())}async evm_addAccount(e,t){const r=new P.Address(e);return h(this,c,"f").addUnknownAccount(r,t)}async evm_removeAccount(e,t){const r=new P.Address(e);return h(this,c,"f").removeKnownAccount(r,t)}async miner_start(e=1){if("eager"===h(this,a,"f").miner.instamine){const t=await h(this,o,"f").resume(e);t&&null!=t.transactions&&h(this,a,"f").chain.vmErrorsOnRPCResponse&&assertExceptionalTransactions(t.transactions)}else h(this,o,"f").resume(e);return!0}async miner_stop(){return h(this,o,"f").pause(),!0}async miner_setGasPrice(e){return h(this,a,"f").miner.defaultGasPrice=b.Quantity.from(e),!0}async miner_setEtherbase(e){return h(this,o,"f").coinbase=P.Address.from(e),!0}async miner_setExtra(e){const t=b.Data.from(e),r=t.toBuffer().length;if(r>32)throw new Error(`extra exceeds max length. ${r} > 32`);return h(this,a,"f").miner.extraData=t,!0}async web3_clientVersion(){return"Ganache/v7.3.2/EthereumJS TestRPC/v7.3.2/ethereum-js"}async web3_sha3(e){return b.Data.from((0,b.keccak)(b.Data.toBuffer(e)))}async net_version(){return h(this,a,"f").chain.networkId.toString()}async net_listening(){return!0}async net_peerCount(){return b.Quantity.Zero}async eth_estimateGas(e,t=p.Tag.latest){const r=h(this,o,"f"),s=r.blocks,n=(await s.get(t)).header,i=h(this,a,"f"),generateVM=()=>r.vm.copy();return new Promise(((t,s)=>{const{coinbase:a}=r,o=g.TransactionFactory.fromRpc(e,r.common);null==o.from&&(o.from=a),o.gas.isNull()&&(o.gas=i.miner.callGasLimit);const c=new m.RuntimeBlock(b.Quantity.from((n.number.toBigInt()||0n)+1n),n.parentHash,n.miner,o.gas.toBuffer(),n.gasUsed.toBuffer(),n.timestamp,i.miner.difficulty,n.totalDifficulty,0n),l={tx:o.toVmTransaction(),block:c,skipBalance:!0,skipNonce:!0};(0,v.default)(generateVM,l,((e,r)=>{if(e)return s(e);t(b.Quantity.from(r.gasEstimate.toArrayLike(Buffer)))}))}))}async eth_protocolVersion(){return T}async eth_syncing(){return!1}async eth_coinbase(){return h(this,o,"f").coinbase}async eth_getBlockByNumber(e,t){void 0===t&&(t=!1);const r=await h(this,o,"f").blocks.get(e).catch((e=>null));return r?r.toJSON(t):null}async eth_getBlockByHash(e,t){void 0===t&&(t=!1);const r=await h(this,o,"f").blocks.getByHash(e).catch((e=>null));return r?r.toJSON(t):null}async eth_getBlockTransactionCountByNumber(e){const{blocks:t}=h(this,o,"f"),r=t.getEffectiveNumber(e),s=await t.getRawByBlockNumber(r);if(!s)return null;const[,n]=(0,B.decode)(s);return b.Quantity.from(n.length)}async eth_getBlockTransactionCountByHash(e){const{blocks:t}=h(this,o,"f"),r=await t.getNumberFromHash(e);if(!r)return null;const s=await t.getRawByBlockNumber(b.Quantity.from(r));if(!s)return null;const[,n]=(0,B.decode)(s);return b.Quantity.from(n.length)}async eth_getCompilers(){return[]}async eth_getTransactionByBlockHashAndIndex(e,t){const r=h(this,o,"f"),s=await r.blocks.getByHash(e).catch((e=>null));if(!s)return null;return s.getTransactions()[b.Quantity.toNumber(t)].toJSON(r.common)}async eth_getTransactionByBlockNumberAndIndex(e,t){const r=h(this,o,"f"),s=await r.blocks.get(e).catch((e=>null));if(!s)return null;return s.getTransactions()[b.Quantity.toNumber(t)].toJSON(r.common)}async eth_getUncleCountByBlockHash(e){return b.Quantity.Zero}async eth_getUncleCountByBlockNumber(e){return b.Quantity.Zero}async eth_getUncleByBlockHashAndIndex(e,t){return null}async eth_getUncleByBlockNumberAndIndex(e,t){return null}async eth_getWork(e){return[]}async eth_submitWork(e,t,r){return!1}async eth_submitHashrate(e,t){return!1}async eth_mining(){return h(this,o,"f").isStarted()}async eth_hashrate(){return b.Quantity.Zero}async eth_gasPrice(){return h(this,a,"f").miner.defaultGasPrice}async eth_maxPriorityFeePerGas(){return b.Quantity.Gwei}async eth_accounts(){return h(this,c,"f").addresses}async eth_blockNumber(){return h(this,o,"f").blocks.latest.header.number}async eth_chainId(){return b.Quantity.from(h(this,a,"f").chain.chainId)}async eth_getBalance(e,t=p.Tag.latest){return h(this,o,"f").accounts.getBalance(P.Address.from(e),t)}async eth_getCode(e,t=p.Tag.latest){const{accounts:r}=h(this,o,"f");return r.getCode(P.Address.from(e),t)}async eth_getStorageAt(e,t,r=p.Tag.latest){const s=h(this,o,"f"),n=s.blocks.getEffectiveNumber(r),i=await s.blocks.getRawByBlockNumber(n);if(!i)throw new Error("header not found");const[[,,,a]]=(0,B.decode)(i),c=s.trie.copy(!1);c.setContext(a,null,n);const l=b.Quantity.toBuffer(t),u=l.length;let d;u<32?(d=Buffer.allocUnsafe(32).fill(0),l.copy(d,32-u)):d=32===u?l:l.slice(-32);const m=P.Address.from(e).toBuffer(),g=await c.get(m),y=(0,B.decode)(g)[2];c.setContext(y,m,n);const w=await c.get(d);return b.Data.from((0,B.decode)(w))}async eth_getTransactionByHash(e){const{transactions:t}=h(this,o,"f"),r=b.Data.toBuffer(e),s=await t.get(r);if(null===s){const e=t.transactionPool.find(r);return e?e.toJSON(h(this,o,"f").common):null}return s.toJSON(h(this,o,"f").common)}async eth_getTransactionReceipt(e){const{transactions:t,transactionReceipts:r,blocks:s,common:n}=h(this,o,"f"),i=b.Data.from(e),c=i.toBuffer(),l=t.get(c),u=r.get(c),d=l.then((e=>e?s.get(e.blockNumber.toBuffer()):null)),[p,m,g]=await Promise.all([l,u,d]);if(p)return m.toJSON(g,p,n);const y=h(this,a,"f");if(y.miner.blockTime<=0&&"strict"===y.miner.instamine&&h(this,o,"f").isStarted()){null!=h(this,o,"f").transactions.transactionPool.find(c)&&y.logging.logger.log(` > Ganache \`eth_getTransactionReceipt\` notice: the transaction with hash\n > \`${i.toString()}\` has not\n > yet been mined. See https://trfl.io/v7-instamine for additional information.`)}return null}async eth_sendTransaction(e){const t=h(this,o,"f"),r=g.TransactionFactory.fromRpc(e,t.common);if(null==r.from)throw new Error("from not found; is required");const s=r.from.toString(),n=h(this,c,"f"),i=n.knownAccounts.has(s),l=n.unlockedAccounts.get(s);if(void 0===l){throw new Error(i?"authentication needed: passphrase or unlock":"sender account not recognized")}return await autofillDefaultTransactionValues(r,this.eth_estimateGas.bind(this),this.eth_maxPriorityFeePerGas,e,t,h(this,a,"f")),t.queueTransaction(r,l)}async eth_signTransaction(e){const t=h(this,o,"f"),r=g.TransactionFactory.fromRpc(e,t.common);if(null==r.from)throw new Error("from not found; is required");const s=r.from.toString(),n=h(this,c,"f"),i=n.knownAccounts.has(s),a=n.unlockedAccounts.get(s);if(void 0===a){throw new Error(i?"authentication needed: passphrase or unlock":"sender account not recognized")}return r.signAndHash(a.toBuffer()),b.Data.from(r.serialized)}async eth_sendRawTransaction(e){const t=h(this,o,"f"),r=g.TransactionFactory.fromString(e,t.common);return t.queueTransaction(r)}async eth_sign(e,t){const r=P.Address.from(e).toString().toLowerCase(),s=h(this,c,"f").unlockedAccounts.get(r);if(null==s)throw new Error("cannot sign data; no private key");const n=(0,y.hashPersonalMessage)(b.Data.toBuffer(t)),{v:i,r:a,s:o}=(0,y.ecsign)(n,s.toBuffer());return(0,y.toRpcSig)(i,a,o)}async eth_signTypedData(e,t){return this.eth_signTypedData_v4(e,t)}async eth_signTypedData_v4(e,t){const r=P.Address.from(e).toString().toLowerCase(),s=h(this,c,"f").unlockedAccounts.get(r);if(null==s)throw new Error("cannot sign data; no private key");if("string"==typeof t)throw new Error("cannot sign data; string sent, expected object");if(!t.types)throw new Error("cannot sign data; types missing");if(!t.types.EIP712Domain)throw new Error("cannot sign data; EIP712Domain definition missing");if(!t.domain)throw new Error("cannot sign data; domain missing");if(!t.primaryType)throw new Error("cannot sign data; primaryType missing");if(!t.message)throw new Error("cannot sign data; message missing");return(0,w.signTypedData_v4)(s.toBuffer(),{data:t})}eth_subscribe(e,t){const r=h(this,i,"f");switch(e){case"newHeads":{const e=h(this,s,"f").call(this),t=b.PromiEvent.resolve(e),n=h(this,o,"f").on("block",(r=>{const s=r.header,n={logsBloom:s.logsBloom,miner:s.miner,difficulty:s.difficulty,totalDifficulty:s.totalDifficulty,extraData:s.extraData,gasLimit:s.gasLimit,gasUsed:s.gasUsed,hash:r.hash(),mixHash:r.header.mixHash,nonce:s.nonce,number:s.number,parentHash:s.parentHash,receiptsRoot:s.receiptsRoot,stateRoot:s.stateRoot,timestamp:s.timestamp,transactionsRoot:s.transactionsRoot,sha3Uncles:s.sha3Uncles};void 0!==s.baseFeePerGas&&(n.baseFeePerGas=s.baseFeePerGas),t.emit("message",{type:"eth_subscription",data:{result:n,subscription:e.toString()}})}));return r.set(e.toString(),n),t}case"logs":{const e=h(this,s,"f").call(this),n=b.PromiEvent.resolve(e),{addresses:i,topics:a}=t?(0,E.parseFilterDetails)(t):{addresses:[],topics:[]},c=h(this,o,"f").on("blockLogs",(t=>{for(const r of t.filter(i,a))n.emit("message",{type:"eth_subscription",data:{result:r,subscription:e.toString()}})}));return r.set(e.toString(),c),n}case"newPendingTransactions":{const e=h(this,s,"f").call(this),t=b.PromiEvent.resolve(e),n=h(this,o,"f").on("pendingTransaction",(r=>{const s=r.hash.toString();t.emit("message",{type:"eth_subscription",data:{result:s,subscription:e.toString()}})}));return r.set(e.toString(),n),t}case"syncing":{const e=h(this,s,"f").call(this),t=b.PromiEvent.resolve(e);return h(this,i,"f").set(e.toString(),(()=>{})),t}default:throw new p.CodedError(`no "${e}" subscription in eth namespace`,b.JsonRpcErrorCode.METHOD_NOT_FOUND)}}async eth_unsubscribe(e){const t=h(this,i,"f"),r=t.get(e);return!!r&&(t.delete(e),r(),!0)}async eth_newBlockFilter(){const e={updates:[],unsubscribe:h(this,o,"f").on("block",(t=>{e.updates.push(t.hash())})),filter:null,type:p.FilterTypes.block},t=h(this,s,"f").call(this);return h(this,n,"f").set(t.toString(),e),t}async eth_newPendingTransactionFilter(){const e={updates:[],unsubscribe:h(this,o,"f").on("pendingTransaction",(t=>{e.updates.push(t.hash)})),filter:null,type:p.FilterTypes.pendingTransaction},t=h(this,s,"f").call(this);return h(this,n,"f").set(t.toString(),e),t}async eth_newFilter(e){const t=h(this,o,"f");null==e&&(e={});const{addresses:r,topics:i}=(0,E.parseFilterDetails)(e||{}),a={updates:[],unsubscribe:t.on("blockLogs",(s=>{const n=s.blockNumber,{fromBlock:o,toBlock:c}=(0,E.parseFilterRange)(e,t);o<=n&&c>=n&&a.updates.push(...s.filter(r,i))})),filter:e,type:p.FilterTypes.log},c=h(this,s,"f").call(this);return h(this,n,"f").set(c.toString(),a),c}async eth_getFilterChanges(e){const t=h(this,n,"f").get(b.Quantity.toString(e));if(t){const e=t.updates;return t.updates=[],e}throw new Error("filter not found")}async eth_uninstallFilter(e){const t=b.Quantity.toString(e),r=h(this,n,"f").get(t);return!!r&&(r.unsubscribe(),h(this,n,"f").delete(t))}async eth_getFilterLogs(e){const t=h(this,n,"f").get(b.Quantity.toString(e));if(t&&t.type===p.FilterTypes.log)return this.eth_getLogs(t.filter);throw new Error("filter not found")}async eth_getLogs(e){return h(this,o,"f").blockLogs.getLogs(e)}async eth_getTransactionCount(e,t=p.Tag.latest){return h(this,o,"f").accounts.getNonce(P.Address.from(e),t)}async eth_call(e,t=p.Tag.latest,r={}){const s=h(this,o,"f"),n=s.common,i=s.blocks,c=await i.get(t),l=c.header,u=h(this,a,"f");let d,g;d=void 0===e.gasLimit?void 0!==e.gas?b.Quantity.from(e.gas):u.miner.callGasLimit:b.Quantity.from(e.gasLimit),void 0===e.data?void 0!==e.input&&(g=b.Data.from(e.input)):g=b.Data.from(e.data);const y=c.header.baseFeePerGas?c.header.baseFeePerGas.toBigInt():void 0;let w;const _=void 0!==e.gasPrice;if(n.isActivatedEIP(1559)&&void 0!==y){const t=void 0!==e.maxFeePerGas,r=void 0!==e.maxPriorityFeePerGas;if(_&&(t||r))throw new Error("both gasPrice and (maxFeePerGas or maxPriorityFeePerGas) specified");let s=0n,n=0n;if(t&&(s=BigInt(e.maxFeePerGas)),r&&(n=BigInt(e.maxPriorityFeePerGas)),n>0||s>0){const e=s-y,t=e<n?e:n;w=b.Quantity.from(y+t)}else w=b.Quantity.from(0)}else w=b.Quantity.from(_?0:e.gasPrice);const v=new m.RuntimeBlock(l.number,l.parentHash,s.coinbase,d.toBuffer(),l.gasUsed.toBuffer(),l.timestamp,u.miner.difficulty,l.totalDifficulty,y),k={gas:d,from:null==e.from?s.coinbase:P.Address.from(e.from),to:null==e.to?null:P.Address.from(e.to),gasPrice:w,value:null==e.value?null:b.Quantity.from(e.value),data:g,block:v};return s.simulateTransaction(k,c,r)}async debug_traceTransaction(e,t){return h(this,o,"f").traceTransaction(e,t||{})}async debug_storageRangeAt(e,t,r,s,n){return h(this,o,"f").storageRangeAt(e,b.Quantity.toNumber(t),r,s,b.Quantity.toNumber(n))}async personal_listAccounts(){return h(this,c,"f").addresses}async personal_newAccount(e){if("string"!=typeof e)throw new Error("missing value for required argument `passphrase`");const t=h(this,c,"f"),r=t.createRandomAccount(),s=r.address,n=s.toString();return await t.addToKeyFile(s,r.privateKey,e,!0),t.addresses.push(n),t.knownAccounts.add(n),r.address}async personal_importRawKey(e,t){if("string"!=typeof t)throw new Error("missing value for required argument `passphrase`");const r=h(this,c,"f"),s=_.default.createAccountFromPrivateKey(b.Data.from(e)),n=s.address,i=n.toString();return await r.addToKeyFile(n,s.privateKey,t,!0),r.addresses.push(i),r.knownAccounts.add(i),s.address}async personal_lockAccount(e){return h(this,c,"f").lockAccount(e.toLowerCase())}async personal_unlockAccount(e,t,r=300){const s=new P.Address(e);return h(this,c,"f").unlockAccount(s,t,r)}async personal_sendTransaction(e,t){const r=h(this,o,"f"),s=g.TransactionFactory.fromRpc(e,r.common);if(null==s.from)throw new Error("from not found; is required");const n=h(this,c,"f"),i=await n.getFromKeyFile(s.from,t);return await autofillDefaultTransactionValues(s,this.eth_estimateGas.bind(this),this.eth_maxPriorityFeePerGas,e,r,h(this,a,"f")),r.queueTransaction(s,b.Data.from(i))}async personal_signTransaction(e,t){const r=h(this,o,"f"),s=g.TransactionFactory.fromRpc(e,r.common);if(null==s.from)throw new Error("from not found; is required");const n=h(this,c,"f"),i=await n.getFromKeyFile(s.from,t);return s.signAndHash(i),b.Data.from(s.serialized)}async rpc_modules(){return O}async shh_newIdentity(){return"0x00"}async shh_hasIdentity(e){return!1}async shh_newGroup(){return"0x00"}async shh_addToGroup(e){return!1}async shh_newFilter(e,t){return!1}async shh_uninstallFilter(e){return!1}async shh_getFilterChanges(e){return[]}async shh_getMessages(e){return!1}async shh_post(e){return!1}async shh_version(){return"2"}async txpool_content(){const{transactions:e,common:t}=h(this,o,"f"),{transactionPool:{executables:r,origins:s}}=e,processMap=e=>{let r={};for(let[s,{array:n,length:i}]of e)for(let e=0;e<i;++e){const s=n[e],i=s.from.toString();void 0===r[i]&&(r[i]={});const a=s.nonce.toBigInt().toString();r[i][a]=s.toJSON(t)}return r};return{pending:processMap(r.pending),queued:processMap(s)}}}s=new WeakMap,n=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakMap,l([(0,k.assertArgLength)(3)],EthereumApi.prototype,"db_putString",null),l([(0,k.assertArgLength)(2)],EthereumApi.prototype,"db_getString",null),l([(0,k.assertArgLength)(3)],EthereumApi.prototype,"db_putHex",null),l([(0,k.assertArgLength)(2)],EthereumApi.prototype,"db_getHex",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"bzz_hive",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"bzz_info",null),l([(0,k.assertArgLength)(0,1)],EthereumApi.prototype,"evm_mine",null),l([(0,k.assertArgLength)(2)],EthereumApi.prototype,"evm_setAccountNonce",null),l([(0,k.assertArgLength)(2)],EthereumApi.prototype,"evm_setAccountBalance",null),l([(0,k.assertArgLength)(2)],EthereumApi.prototype,"evm_setAccountCode",null),l([(0,k.assertArgLength)(3)],EthereumApi.prototype,"evm_setAccountStorageAt",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"evm_increaseTime",null),l([(0,k.assertArgLength)(0,1)],EthereumApi.prototype,"evm_setTime",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"evm_revert",null),l([(0,k.assertArgLength)(0,1)],EthereumApi.prototype,"miner_start",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"miner_stop",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"miner_setGasPrice",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"miner_setEtherbase",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"miner_setExtra",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"web3_clientVersion",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"web3_sha3",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"net_version",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"net_listening",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"net_peerCount",null),l([(0,k.assertArgLength)(1,2)],EthereumApi.prototype,"eth_estimateGas",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"eth_protocolVersion",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"eth_syncing",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"eth_coinbase",null),l([(0,k.assertArgLength)(1,2)],EthereumApi.prototype,"eth_getBlockByNumber",null),l([(0,k.assertArgLength)(1,2)],EthereumApi.prototype,"eth_getBlockByHash",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"eth_getBlockTransactionCountByNumber",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"eth_getBlockTransactionCountByHash",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"eth_getCompilers",null),l([(0,k.assertArgLength)(2)],EthereumApi.prototype,"eth_getTransactionByBlockHashAndIndex",null),l([(0,k.assertArgLength)(2)],EthereumApi.prototype,"eth_getTransactionByBlockNumberAndIndex",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"eth_getUncleCountByBlockHash",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"eth_getUncleCountByBlockNumber",null),l([(0,k.assertArgLength)(2)],EthereumApi.prototype,"eth_getUncleByBlockHashAndIndex",null),l([(0,k.assertArgLength)(2)],EthereumApi.prototype,"eth_getUncleByBlockNumberAndIndex",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"eth_getWork",null),l([(0,k.assertArgLength)(3)],EthereumApi.prototype,"eth_submitWork",null),l([(0,k.assertArgLength)(2)],EthereumApi.prototype,"eth_submitHashrate",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"eth_mining",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"eth_hashrate",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"eth_gasPrice",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"eth_maxPriorityFeePerGas",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"eth_accounts",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"eth_blockNumber",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"eth_chainId",null),l([(0,k.assertArgLength)(1,2)],EthereumApi.prototype,"eth_getBalance",null),l([(0,k.assertArgLength)(1,2)],EthereumApi.prototype,"eth_getCode",null),l([(0,k.assertArgLength)(2,3)],EthereumApi.prototype,"eth_getStorageAt",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"eth_getTransactionByHash",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"eth_getTransactionReceipt",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"eth_sendTransaction",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"eth_signTransaction",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"eth_sendRawTransaction",null),l([(0,k.assertArgLength)(2)],EthereumApi.prototype,"eth_sign",null),l([(0,k.assertArgLength)(2)],EthereumApi.prototype,"eth_signTypedData",null),l([(0,k.assertArgLength)(2)],EthereumApi.prototype,"eth_signTypedData_v4",null),l([(0,k.assertArgLength)(1,2)],EthereumApi.prototype,"eth_subscribe",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"eth_unsubscribe",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"eth_newBlockFilter",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"eth_newPendingTransactionFilter",null),l([(0,k.assertArgLength)(0,1)],EthereumApi.prototype,"eth_newFilter",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"eth_getFilterChanges",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"eth_uninstallFilter",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"eth_getFilterLogs",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"eth_getLogs",null),l([(0,k.assertArgLength)(1,2)],EthereumApi.prototype,"eth_getTransactionCount",null),l([(0,k.assertArgLength)(1,3)],EthereumApi.prototype,"eth_call",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"personal_listAccounts",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"personal_newAccount",null),l([(0,k.assertArgLength)(2)],EthereumApi.prototype,"personal_importRawKey",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"personal_lockAccount",null),l([(0,k.assertArgLength)(2,3)],EthereumApi.prototype,"personal_unlockAccount",null),l([(0,k.assertArgLength)(2)],EthereumApi.prototype,"personal_sendTransaction",null),l([(0,k.assertArgLength)(2)],EthereumApi.prototype,"personal_signTransaction",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"rpc_modules",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"shh_newIdentity",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"shh_hasIdentity",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"shh_newGroup",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"shh_addToGroup",null),l([(0,k.assertArgLength)(2)],EthereumApi.prototype,"shh_newFilter",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"shh_uninstallFilter",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"shh_getFilterChanges",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"shh_getMessages",null),l([(0,k.assertArgLength)(1)],EthereumApi.prototype,"shh_post",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"shh_version",null),l([(0,k.assertArgLength)(0)],EthereumApi.prototype,"txpool_content",null),t.default=EthereumApi},294:function(e,t,r){"use strict";var s,n,i,a,o,c,l,u,h,d,p,m,g,y,w,b,_,v,k,E,B,P,A=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),T=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),O=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&A(t,e,r);return T(t,e),t},S=this&&this.__classPrivateFieldSet||function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r},R=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)},N=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Status=void 0;const D=r(40),F=O(r(181)),I=N(r(316)),C=N(r(27)),M=r(5),x=r(15),L=r(0),j=N(r(19)),z=N(r(299)),G=r(9),Q=r(1),U=N(r(333)),W=N(r(183)),H=N(r(318)),K=N(r(319)),q=r(10),V=r(36),J=r(74),$=r(387),Z=r(388),Y=r(80),X=r(557),ee=r(302),te=r(888),re=N(r(321)),se=r(1),ne=r(466),ie=N(r(558)),ae=ie.default.init(ie.default.BLS12_381).then((()=>{ie.default.setMapToMode(ie.default.IRTF),ie.default.verifyOrderG1(!0),ie.default.verifyOrderG2(!0)}));var oe;function makeTrie(e,t,r){return e.fallback?new ee.ForkTrie(t,r?r.toBuffer():null,e):new X.GanacheTrie(t,r?r.toBuffer():null,e)}!function(e){e[e.started=1]="started",e[e.starting=2]="starting",e[e.stopped=4]="stopped",e[e.stopping=8]="stopping",e[e.paused=16]="paused"}(oe=t.Status||(t.Status={}));class Blockchain extends C.default{constructor(e,t,r){super(),s.set(this,oe.starting),n.set(this,void 0),i.set(this,void 0),a.set(this,null),o.set(this,!1),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),h.set(this,(({block:e,serialized:t,storageKeys:r,transactions:s})=>{const{blocks:n}=this;return n.latest=e,R(this,c,"f").batch((()=>{const i=e.hash(),a=e.header,o=a.number,c=o.toBuffer(),u=M.BlockLogs.create(i),h=a.timestamp,d=new Date(1e3*h.toNumber()).toString(),m=[];return s.forEach(((e,t)=>{const r=e.hash.toBuffer(),s=Q.Quantity.from(t),n=e.serializeForDb(i,o,s);this.transactions.set(r,n);const c=e.getReceipt(),l=c.serialize(!0);this.transactionReceipts.set(r,l),e.getLogs().forEach(u.append.bind(u,s,e.hash)),m.push(R(this,p,"f").call(this,r,c,a.number,d,e.execException))})),r.forEach((e=>{this.storageKeys.put(e.hashedKey,e.key)})),u.blockNumber=a.number,this.blockLogs.set(c,u.serialize()),n.putBlock(c,i,t),n.updateLatestIndex(c),m.length>0&&R(this,l,"f").logging.logger.log(m.join(D.EOL)),{block:e,blockLogs:u,transactions:s}}))})),d.set(this,(async e=>{const t=R(this,l,"f"),{block:r,blockLogs:s,transactions:n}=e;return n.forEach((e=>{e.finalize("confirmed",e.execException)})),"eager"===t.miner.instamine?await new Promise((e=>{setImmediate((async()=>{await Promise.all([this.emit("blockLogs",s),this.emit("block",r)]),e(void 0)}))})):await Promise.all([this.emit("blockLogs",s),this.emit("block",r)]),e})),p.set(this,((e,t,r,s,n)=>{let i=`${D.EOL}  Transaction: ${Q.Data.from(e)}${D.EOL}`;const a=t.contractAddress;return null!=a&&(i+=`  Contract created: ${q.Address.from(a)}${D.EOL}`),i+=`  Gas usage: ${Q.Quantity.toNumber(t.raw[1])}\n  Block number: ${r.toNumber()}\n  Block time: ${s}${D.EOL}`,n&&(i+=`  Runtime error: ${n.data.message}${D.EOL}`,n.data.reason&&(i+=`  Revert reason: ${n.data.reason}${D.EOL}`)),i})),m.set(this,(async e=>{S(this,i,R(this,i,"f").then((()=>{const t=R(this,h,"f").call(this,e);return t.then(R(this,d,"f")),t})),"f"),await R(this,i,"f")})),g.set(this,((e,t)=>{const r=e.header,s=r.number.toBigInt()||0n,n=R(this,l,"f").miner;return null==t&&(t=R(this,v,"f").call(this,r.timestamp)),new J.RuntimeBlock(Q.Quantity.from(s+1n),e.hash(),this.coinbase,n.blockGasLimit.toBuffer(),se.BUFFER_ZERO,Q.Quantity.from(t),n.difficulty,r.totalDifficulty,J.Block.calcNextBaseFee(e))})),this.isStarted=()=>R(this,s,"f")===oe.started,this.mine=async(e,t,r=!1)=>{const s=R(this,g,"f").call(this,this.blocks.latest,t),a=await R(this,n,"f").mine(s,e,r);return await R(this,i,"f"),{transactions:a,blockNumber:s.header.number.toArrayLike(Buffer)}},y.set(this,(()=>0!=(R(this,s,"f")&oe.paused))),this.createVmFromStateTrie=async(e,t,r,s)=>{const n=this.blocks,i={getBlock:async e=>{const t=await n.get(e.toBuffer()).catch((e=>null));return t?{hash:()=>t.hash().toBuffer()}:null},copy:()=>i};s=s||this.common;const a=new z.default({state:e,activatePrecompiles:!1,common:s,allowUnlimitedContractSize:t,blockchain:i,stateManager:this.fallback?new Z.ForkStateManager({common:s,trie:e}):new Y.DefaultStateManager({common:s,trie:e})});return r&&(await(0,te.activatePrecompiles)(a.stateManager),s.isActivatedEIP(2537)&&await ae),a._isInitialized=!0,a},w.set(this,(e=>Promise.all(e.map((e=>this.trie.put(e.address.toBuffer(),e.serialize())))))),b.set(this,(async(e,t,r)=>{if(null!=this.fallback){const{block:s}=this.fallback,{miner:n}=R(this,l,"f"),i=this.vm.stateManager;let a;await i.checkpoint(),r.forEach((e=>{const t={buf:e.address.toBuffer()};i._cache.put(t,e),i.touchAccount(t)})),await i.commit(),this.common.isActivatedEIP(1559)&&(a=void 0===s.header.baseFeePerGas?J.Block.INITIAL_BASE_FEE_PER_GAS:s.header.baseFeePerGas.toBigInt());const o=new J.RuntimeBlock(Q.Quantity.from(s.header.number.toBigInt()+1n),s.hash(),this.coinbase,t.toBuffer(),se.BUFFER_ZERO,Q.Quantity.from(e),n.difficulty,s.header.totalDifficulty,a),{block:c,serialized:u}=o.finalize(L.KECCAK256_RLP,L.KECCAK256_RLP,Q.BUFFER_256_ZERO,this.trie.root,0n,n.extraData,[],new Map),h=c.hash();return this.blocks.putBlock(c.header.number.toBuffer(),h,u).then((e=>({block:c,blockLogs:M.BlockLogs.create(h)})))}await R(this,w,"f").call(this,r);const s=Q.Quantity.Empty,n=this.common.isActivatedEIP(1559)?J.Block.INITIAL_BASE_FEE_PER_GAS:void 0,i=new J.RuntimeBlock(s,Q.Data.from(Q.BUFFER_32_ZERO),this.coinbase,t.toBuffer(),se.BUFFER_ZERO,Q.Quantity.from(e),R(this,l,"f").miner.difficulty,Q.Quantity.Zero,n),{block:a,serialized:o}=i.finalize(L.KECCAK256_RLP,L.KECCAK256_RLP,Q.BUFFER_256_ZERO,this.trie.root,0n,R(this,l,"f").miner.extraData,[],new Map);a.header.number=Q.Quantity.Zero;const c=a.hash();return this.blocks.putBlock(a.header.number.toBuffer(),c,o).then((e=>({block:a,blockLogs:M.BlockLogs.create(c)})))})),_.set(this,0),v.set(this,(e=>{const t=R(this,_,"f"),r=R(this,l,"f").miner.timestampIncrement;return"clock"===r?Math.floor((Date.now()+t)/1e3):e.toNumber()+Math.floor(t/1e3)+r.toNumber()})),k.set(this,(async(e,t)=>{"revertMetaData"in this.trie&&await this.trie.revertMetaData(e[e.length-1].header.number,e[0].header.number),await R(this,c,"f").batch((()=>{const{blocks:r,transactions:s,transactionReceipts:n,blockLogs:i}=this;r.updateLatestIndex(t),e.forEach((e=>{e.getTransactions().forEach((e=>{const t=e.hash.toBuffer();s.del(t),n.del(t)}));const t=e.header.number.toBuffer();r.del(t),r.del(e.hash().toBuffer()),i.del(t)}))}))})),E.set(this,{snaps:[],blocks:null,unsubscribeFromBlocks:null}),B.set(this,(async(e,t,r,s,n,i)=>{let a=-1;const l=[],u=this.blocks,h={getBlock:async e=>{const t=await u.get(e.toBuffer()).catch((e=>null));return t?{hash:()=>t.hash().toBuffer()}:null}},d=this.fallback?this.fallback.getCommonForBlockNumber(this.common,BigInt(r.header.number.toString())):this.common,p=await z.default.create({state:t,activatePrecompiles:!1,common:d,allowUnlimitedContractSize:this.vm.allowUnlimitedContractSize,blockchain:h,stateManager:this.fallback?new Z.ForkStateManager({common:d,trie:t}):new Y.DefaultStateManager({common:d,trie:t})}),m={};let g=0;const y=[],w=(0,M.TraceDataFactory)(),b={},stepListener=async(t,r)=>{R(this,o,"f")&&this.emit("ganache:vm:tx:step",(0,ne.makeStepEvent)(b,t));const n=t.gasLeft.toNumber(),i=e.gasLimit.toNumber()-n-g;g+=i;const c=[];if(!0!==s.disableMemory){let e=0;for(;e<t.memory.length;){const r=t.memory.slice(e,e+32);c.push(w.from(Buffer.from(r))),e+=32}}const u=[];if(!0!==s.disableStack)for(const e of t.stack)u.push(w.from(e.toArrayLike(Buffer)));const h={depth:t.depth+1,error:"",gas:n,gasCost:0,memory:c,op:t.opcode.name,pc:t.pc,stack:u,storage:null};if(y.length&&(y[y.length-1].gasCost=i),!0===s.disableStorage)y.push(h),r();else{const{depth:e}=t;switch(a>e?l.pop():a<e&&l.push(new M.TraceStorageMap),a=e,t.opcode.name){case"SSTORE":{const t=u[u.length-1],s=u[u.length-2];h.storage=new M.TraceStorageMap(l[e]),y.push(h),r(),l[e].set(t,s);break}case"SLOAD":{const s=u[u.length-1],n=await p.stateManager.getContractStorage(t.address,s.toBuffer()),i=w.from(n);l[e].set(s,i),h.storage=new M.TraceStorageMap(l[e]),y.push(h),r();break}default:h.storage=new M.TraceStorageMap(l[e]),y.push(h),r()}}};p.stateManager._cache.flush=()=>{},await p.stateManager.checkpoint();try{for(let t=0,s=r.transactions.length;t<s;t++){const a=r.transactions[t];if(a===e){if(n&&i){const e=R(this,c,"f"),t={buf:i};await Promise.all(n.map((async r=>{const s=await e.storageKeys.get(r),n=await p.stateManager.getContractStorage(t,s);m[Q.Data.toString(r,r.length)]={key:Q.Data.from(s,s.length),value:Q.Data.from(n,32)}})));break}p.on("step",stepListener),t=s}this.emit("ganache:vm:tx:before",{context:b}),await p.runTx({tx:a,block:r}),this.emit("ganache:vm:tx:after",{context:b})}p.removeListener("step",stepListener)}finally{await p.stateManager.revert()}return{gas:g,structLogs:y,returnValue:"",storage:m}})),P.set(this,((e,t,r)=>{const s=new J.RuntimeBlock(Q.Quantity.from((t.header.number.toBigInt()||0n)+1n),t.hash(),t.header.miner,t.header.gasLimit.toBuffer(),se.BUFFER_ZERO,e.header.timestamp,R(this,l,"f").miner.difficulty,t.header.totalDifficulty,J.Block.calcNextBaseFee(t));s.transactions=[],s.uncleHeaders=[];const n=e.getTransactions();for(const e of n)if(s.transactions.push(e.toVmTransaction()),e.hash.toBuffer().equals(r))break;return s})),S(this,l,e,"f"),this.fallback=r,this.coinbase=t,S(this,u,!e.miner.blockTime||e.miner.blockTime<=0,"f"),S(this,c,new I.default(e.database,this),"f")}async initialize(e){const t=R(this,c,"f"),r=R(this,l,"f"),h=R(this,u,"f");try{let s;this.fallback?(await this.fallback.initialize(),await t.initialize(),s=this.common=this.fallback.common,r.fork.blockNumber=this.fallback.blockNumber.toNumber(),r.chain.networkId=s.networkId(),r.chain.chainId=s.chainId()):(await t.initialize(),s=this.common=function createCommon(e,t,r){const s=j.default.forCustomChain(Q.KNOWN_CHAINIDS.has(e)?e:1,{name:"ganache",networkId:t,chainId:e,comment:"Local test network"},r);return s.on=()=>{},s}(r.chain.chainId,r.chain.networkId,r.chain.hardfork));const c=this.blocks=await W.default.initialize(this,s,t.blockIndexes,t.blocks);this.blockLogs=new H.default(t.blockLogs,this),this.transactions=new K.default(r.miner,s,this,t.transactions),this.transactionReceipts=new re.default(t.transactionReceipts,this),this.accounts=new U.default(this),this.storageKeys=t.storageKeys;const{latest:l}=c;{let e;l?(S(this,i,Promise.resolve({block:l,blockLogs:null}),"f"),({stateRoot:e}=l.header)):e=null,this.trie=makeTrie(this,t.trie,e)}this.vm=await this.createVmFromStateTrie(this.trie,r.chain.allowUnlimitedContractSize,!0);{null==r.chain.time&&(r.chain.time=new Date);const t=r.chain.time.getTime(),s=Math.floor(t/1e3);"clock"===r.miner.timestampIncrement&&S(this,_,t-Date.now(),"f"),l||(e.length>0&&await R(this,w,"f").call(this,e),S(this,i,R(this,b,"f").call(this,s,r.miner.blockGasLimit,e),"f"),c.earliest=c.latest=await R(this,i,"f").then((({block:e})=>e)))}{const e=this.transactions.transactionPool,t=r.miner,s=S(this,n,new F.default(t,e.executables,this.vm,R(this,g,"f")),"f");s.on("ganache:vm:tx:before",(e=>{this.emit("ganache:vm:tx:before",e)})),s.on("ganache:vm:tx:step",(e=>{R(this,o,"f")&&this.emit("ganache:vm:tx:step",e)})),s.on("ganache:vm:tx:after",(e=>{this.emit("ganache:vm:tx:after",e)}));const i=Promise.resolve(null),mineAll=(e,t=!1)=>R(this,y,"f").call(this)?i:this.mine(e,null,t);if(h)e.on("drain",mineAll.bind(null,F.Capacity.Single));else{const wait=()=>S(this,a,setTimeout(next,1e3*t.blockTime),"f"),next=()=>{mineAll(F.Capacity.FillBlock,!0).then(wait)};wait()}s.on("block",R(this,m,"f")),this.once("stop").then((()=>s.clearListeners()))}}catch(e){throw S(this,s,oe.stopping,"f"),await this.stop().catch((e=>{})),e}S(this,s,oe.started,"f"),this.emit("ready")}pause(){S(this,s,R(this,s,"f")|oe.paused,"f")}resume(e=1){if(R(this,y,"f").call(this))return S(this,s,R(this,s,"f")^oe.paused,"f"),R(this,u,"f")?this.mine(F.Capacity.FillBlock):void 0;console.log("Warning: startMining called when miner was already started")}increaseTime(e){return e<0&&(e=0),S(this,_,R(this,_,"f")+e,"f")}setTimeDiff(e){const t="clock"===R(this,l,"f").miner.timestampIncrement?Date.now():1e3*this.blocks.latest.header.timestamp.toNumber();return S(this,_,e-t,"f")}snapshot(){const e=R(this,E,"f"),t=e.snaps.push({block:this.blocks.latest,timeAdjustment:R(this,_,"f")});return 1===t&&(e.unsubscribeFromBlocks=this.on("block",(t=>{e.blocks={current:t.hash().toBuffer(),next:e.blocks}}))),R(this,l,"f").logging.logger.log("Saved snapshot #"+t),t}async revert(e){if(e.isNull())throw new Error("invalid snapshotId");const t=e.toBigInt();R(this,l,"f").logging.logger.log("Reverting to snapshot #"+e);const r=R(this,E,"f"),s=r.snaps,a=Number(t-1n),o=s[a];if(!o)return!1;await this.transactions.pause(),await R(this,n,"f").pause(),await R(this,i,"f"),this.transactions.clear();const c=this.blocks,u=c.latest.hash().toBuffer(),h=o.block,d=h.header,p=h.hash().toBuffer();if(s.splice(a),0===s.length&&r.unsubscribeFromBlocks(),!u.equals(p)){const e=[];let t=r.blocks;for(;null!==t&&!t.current.equals(p);)e.push(c.getByHash(t.current)),t=t.next;r.blocks=t;const s=await Promise.all(e);await R(this,k,"f").call(this,s,d.number.toBuffer()),function setStateRootSync(e,t){e._trie.root=t,e._cache.clear(),e._storageTries={}}(this.vm.stateManager,d.stateRoot.toBuffer()),c.latest=h}return S(this,_,o.timeAdjustment,"f"),R(this,n,"f").resume(),this.transactions.resume(),!0}async queueTransaction(e,t){!0===await this.transactions.add(e,t)&&process.nextTick(this.emit.bind(this),"pendingTransaction",e);const r=e.hash;if(R(this,y,"f").call(this)||!R(this,u,"f"))return r;if(R(this,u,"f")&&"eager"===R(this,l,"f").miner.instamine){const{status:t,error:r}=await e.once("finalized");if(r&&("rejected"===t||R(this,l,"f").chain.vmErrorsOnRPCResponse))throw r}return r}async simulateTransaction(e,t,r){let s;const n=e.data;let i=e.gas.toBigInt();const a=null!=e.to;let c=null;if(a){const t=e.to.toBuffer();c={equals:e=>t.equals(e.buf),buf:t}}else c=null;const u=this.fallback?this.fallback.getCommonForBlockNumber(this.common,BigInt(e.block.header.number.toString())):this.common,h=i-(0,V.calculateIntrinsicGas)(n,a,u),d={};if(this.emit("ganache:vm:tx:before",{context:d}),h>=0n){const n=this.trie.copy(!1);n.setContext(t.header.stateRoot.toBuffer(),null,t.header.number);const a=await this.createVmFromStateTrie(n,R(this,l,"f").chain.allowUnlimitedContractSize,!1,u);a.stateManager.checkpoint(),a.on("step",(e=>{if(!R(this,o,"f"))return;const t=(0,ne.makeStepEvent)(d,e);this.emit("ganache:vm:tx:step",t)}));const p=e.from.toBuffer();if(u.isActivatedEIP(2929)){const e=a.stateManager;(0,te.warmPrecompiles)(e),e.addWarmedAddress(p),c&&e.addWarmedAddress(c.buf)}await(0,$.applySimulationOverrides)(n,a,r);const m=await a.stateManager.getAccount({buf:p});m.nonce.iaddn(1);const g=new L.BN((i*e.gasPrice.toBigInt()).toString());m.balance.isub(g),await a.stateManager.putAccount({buf:p},m),s=await a.runCall({caller:{buf:p,equals:e=>p.equals(e.buf)},data:e.data&&e.data.toBuffer(),gasPrice:new L.BN(e.gasPrice.toBuffer()),gasLimit:new L.BN(Q.Quantity.toBuffer(h)),to:c,value:null==e.value?new L.BN(0):new L.BN(e.value.toBuffer()),block:e.block})}else s={execResult:{runState:{programCounter:0},exceptionError:new G.VmError(G.ERROR.OUT_OF_GAS),returnValue:Q.BUFFER_EMPTY}};if(this.emit("ganache:vm:tx:after",{context:d}),s.execResult.exceptionError)throw new M.CallError(s);return Q.Data.from(s.execResult.returnValue||"0x")}async traceTransaction(e,t){const r=Q.Data.toBuffer(e),s=await this.transactions.get(r);if(!s)throw new Error("Unknown transaction "+e);const n=await this.blocks.getByHash(s.blockHash.toBuffer()),i=await this.blocks.getByHash(n.header.parentHash.toBuffer()),a=R(this,P,"f").call(this,n,i,r),o=this.trie.copy();o.setContext(i.header.stateRoot.toBuffer(),null,i.header.number);const{gas:c,structLogs:l,returnValue:u,storage:h}=await R(this,B,"f").call(this,a.transactions[s.index.toNumber()],o,a,t);return{gas:c,structLogs:l,returnValue:u,storage:h}}async storageRangeAt(e,t,r,s,n){const i=await this.blocks.getByHash(e),a=i.getTransactions()[t];if(!a)throw new Error(`transaction index ${t} is out of range for block ${e}`);const o=await this.blocks.getByHash(i.header.parentHash.toBuffer()),l=makeTrie(this,R(this,c,"f").trie,o.header.stateRoot),u=q.Address.from(r).toBuffer(),h=await l.get(u);if(!h)throw new Error(`account ${r} doesn't exist`);const{keys:d,nextKey:p}=await(()=>{const e=l.copy(!1);return e.setContext((0,x.decode)(h)[2],u,o.header.number),new Promise(((t,r)=>{const i=Q.Data.toBuffer(s),compare=(e,t)=>e.compare(t)<0,a=[];e.createReadStream().on("data",(({key:e})=>{if(i.compare(e)>0)return;const t=(0,Q.findInsertPosition)(a,e,compare);t>n||a.splice(t,0,e)})).on("error",r).on("end",(()=>{a.length>n?t({keys:a.slice(0,n),nextKey:Q.Data.from(a[n])}):t({keys:a,nextKey:null})}))}))})(),m=a.hash.toBuffer(),g=R(this,P,"f").call(this,i,o,m),{storage:y}=await R(this,B,"f").call(this,g.transactions[a.index.toNumber()],l,g,{disableMemory:!0,disableStack:!0,disableStorage:!1},d,u);return{storage:y,nextKey:p}}toggleStepEvent(e){S(this,o,e,"f"),R(this,n,"f").toggleStepEvent(e)}async stop(){R(this,s,"f")===oe.starting&&await this.once("ready"),S(this,s,oe.stopping,"f"),clearTimeout(R(this,a,"f")),this.vm&&this.vm.removeAllListeners(),this.transactions&&await this.transactions.pause(),R(this,n,"f")&&await R(this,n,"f").pause(),await R(this,i,"f"),this.fallback&&await this.fallback.close(),await this.emit("stop"),R(this,c,"f")&&await R(this,c,"f").close(),S(this,s,oe.stopped,"f")}}t.default=Blockchain,s=new WeakMap,n=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,h=new WeakMap,d=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,b=new WeakMap,_=new WeakMap,v=new WeakMap,k=new WeakMap,E=new WeakMap,B=new WeakMap,P=new WeakMap},313:function(e,t,r){"use strict";var s,n,i=this&&this.__classPrivateFieldSet||function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r},a=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Connector=void 0;const c=o(r(27)),l=r(1),u=r(314),h=r(5),d=r(893);class Connector extends c.default{constructor(e=null,t){super(),s.set(this,void 0),this.BUFFERIFY_THRESHOLD=Connector.BUFFERIFY_THRESHOLD,n.set(this,((e,t)=>{const r=e.method;if("eth_subscribe"===r&&function isHttp(e){return"uWS.HttpRequest"===e.constructor.name||"HttpRequest"===e.constructor.name}(t))return Promise.reject(new h.CodedError("notifications not supported",l.JsonRpcErrorCode.METHOD_NOT_SUPPORTED));const n=e.params;return a(this,s,"f")._requestRaw({method:r,params:n})})),i(this,s,new u.EthereumProvider(e,t),"f")}get provider(){return a(this,s,"f")}async connect(){await a(this,s,"f").initialize(),await this.emit("ready")}parse(e){try{return JSON.parse(e)}catch(e){throw new h.CodedError(e.message,l.JsonRpcErrorCode.PARSE_ERROR)}}handle(e,t){if(Array.isArray(e)){const r=e.map((e=>a(this,n,"f").call(this,e,t).then((({value:e})=>e)).catch((e=>e))));return Promise.resolve({value:Promise.all(r)})}return a(this,n,"f").call(this,e,t)}format(e,t){if(Array.isArray(t))return JSON.stringify(t.map(((t,r)=>{const s=e[r];return s instanceof Error?(0,l.makeError)(t.id,s):(0,l.makeResponse)(t.id,s)})));{const r=(0,l.makeResponse)(t.id,e);return"debug_traceTransaction"===t.method&&"object"==typeof e&&Array.isArray(e.structLogs)&&e.structLogs.length>this.BUFFERIFY_THRESHOLD?(0,d.bufferify)(r,""):JSON.stringify(r)}}formatError(e,t){const r=(0,l.makeError)(t&&t.id?t.id:null,e);return JSON.stringify(r)}close(){return a(this,s,"f").disconnect()}}t.Connector=Connector,s=new WeakMap,n=new WeakMap,Connector.BUFFERIFY_THRESHOLD=1e5},333:function(e,t,r){"use strict";var s,n=this&&this.__classPrivateFieldSet||function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r},i=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0});const a=r(5),o=r(0),c=r(1),l=r(15);t.default=class AccountManager{constructor(e){s.set(this,void 0),n(this,s,e,"f")}async get(e,t=a.Tag.latest){const r=await this.getRaw(e,t);return null==r?null:a.Account.fromBuffer(r)}async getRaw(e,t=a.Tag.latest){const{trie:r,blocks:n}=i(this,s,"f"),{stateRoot:o,number:c}=(await n.get(t)).header,l=r.copy(!1);return l.setContext(o.toBuffer(),null,c),await l.get(e.toBuffer())}async getStorageAt(e,t,r=a.Tag.latest){const{trie:n,blocks:o}=i(this,s,"f"),{stateRoot:c,number:l}=(await o.get(r)).header,u=n.copy(!1);return u.setContext(c.toBuffer(),e.toBuffer(),l),await u.get(t)}async getNonce(e,t=a.Tag.latest){const r=await this.getRaw(e,t);if(null==r)return c.Quantity.Zero;const[s]=(0,l.decode)(r);return 0===s.length?c.Quantity.Zero:c.Quantity.from(s)}async getBalance(e,t=a.Tag.latest){const r=await this.getRaw(e,t);if(null==r)return c.Quantity.Zero;const[,s]=(0,l.decode)(r);return 0===s.length?c.Quantity.Zero:c.Quantity.from(s)}async getNonceAndBalance(e,t=a.Tag.latest){const r=await this.getRaw(e,t);if(null==r)return{nonce:c.Quantity.Zero,balance:c.Quantity.Zero};const[s,n]=(0,l.decode)(r);return{nonce:0===s.length?c.Quantity.Zero:c.Quantity.from(s),balance:0===n.length?c.Quantity.Zero:c.Quantity.from(n)}}async getCode(e,t=a.Tag.latest){const r=await this.getRaw(e,t);if(null==r)return c.Data.Empty;const[,,,n]=(0,l.decode)(r);return n.equals(o.KECCAK256_NULL)?c.Data.Empty:i(this,s,"f").trie.db.get(n).then(c.Data.from)}},s=new WeakMap},183:function(e,t,r){"use strict";var s,n,i,a=this&&this.__classPrivateFieldSet||function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r},o=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=c(r(76)),u=r(5),h=r(1),d=r(74),p=r(10),m=r(36),g=h.BUFFER_ZERO,y=Buffer.from([]);class BlockManager extends l.default{constructor(e,t,r,c){super(c,d.Block,t),s.set(this,void 0),n.set(this,void 0),i.set(this,void 0),this.fromFallback=async e=>{const t=o(this,s,"f").fallback;let r;if("string"==typeof e)r=e;else{if(!t.isValidForkBlockNumber(e))return null;r=e.toString()}const i=await t.request("eth_getBlockByNumber",[r,!0]);if(null==i)return null;{const e=t.getCommonForBlockNumber(o(this,n,"f"),BigInt(i.number));return BlockManager.rawFromJSON(i,e)}},a(this,s,e,"f"),a(this,n,t,"f"),a(this,i,r,"f")}static async initialize(e,t,r,s){const n=new BlockManager(e,t,r,s);return await n.updateTaggedBlocks(),n}static rawFromJSON(e,t){const r=[h.Data.toBuffer(e.parentHash),h.Data.toBuffer(e.sha3Uncles),p.Address.from(e.miner).toBuffer(),h.Data.toBuffer(e.stateRoot),h.Data.toBuffer(e.transactionsRoot),h.Data.toBuffer(e.receiptsRoot),h.Data.toBuffer(e.logsBloom),h.Quantity.toBuffer(e.difficulty),h.Quantity.toBuffer(e.number),h.Quantity.toBuffer(e.gasLimit),h.Quantity.toBuffer(e.gasUsed),h.Quantity.toBuffer(e.timestamp),h.Data.toBuffer(e.extraData),h.Data.toBuffer(e.mixHash),h.Data.toBuffer(e.nonce)];void 0!==e.baseFeePerGas&&(r[15]=h.Data.toBuffer(e.baseFeePerGas));const s=h.Quantity.toBuffer(e.totalDifficulty),n=[],i=[];return e.transactions.forEach(((r,s)=>{const a=[h.Quantity.toBuffer(r.from),h.Quantity.toBuffer(r.hash)],o=[...a,h.Data.toBuffer(e.hash),h.Quantity.toBuffer(e.number),s],c=m.TransactionFactory.fromRpc(r,t,o),l=c.toEthRawTransaction(c.v.toBuffer(),c.r.toBuffer(),c.s.toBuffer());n.push(l),i.push(a)})),(0,d.serialize)([r,n,[],s,i]).serialized}getBlockByTag(e){switch(e){case"latest":case"pending":return this.latest;case"earliest":return this.earliest}}getEffectiveNumber(e=typeof u.Tag.latest){if("string"==typeof e){const t=this.getBlockByTag(e);if(t)return t.header.number}return h.Quantity.from(e)}async getNumberFromHash(e){return o(this,i,"f").get(h.Data.toBuffer(e)).catch((e=>{if(404===e.status)return null;throw e}))}async getByHash(e){const t=await this.getNumberFromHash(e);if(null===t){const t=o(this,s,"f").fallback;if(t){const r=await t.request("eth_getBlockByHash",[h.Data.from(e),!0]);if(r){const e=BigInt(r.number);if(e<=t.blockNumber.toBigInt()){const s=t.getCommonForBlockNumber(o(this,n,"f"),e);return new d.Block(BlockManager.rawFromJSON(r,s),s)}}}return null}return this.get(t)}async getRawByBlockNumber(e){const t=o(this,s,"f").fallback,r=e.toBuffer();return this.getRaw(r).then((r=>null==r&&t?this.fromFallback(e):r))}async get(e){if("string"==typeof e){const t=this.getBlockByTag(e);if(t)return t}const t=h.Quantity.from(e),r=await this.getRaw(t.toBuffer()),i=o(this,n,"f");if(r)return new d.Block(r,i);{const e=o(this,s,"f").fallback;if(e){const r=await this.fromFallback(t);if(r)return new d.Block(r,e.getCommonForBlockNumber(i,t.toBigInt()))}}throw new Error("header not found")}async putBlock(e,t,r){let s=e;y.equals(s)&&(s=Buffer.from([0]));const n=t.toBuffer();await Promise.all([o(this,i,"f").put(n,s),super.set(s,r)])}async updateLatestIndex(e){await o(this,i,"f").put(g,e)}async updateTaggedBlocks(){const[e,t]=await Promise.all([new Promise(((e,t)=>{let r;this.base.createValueStream({limit:1}).on("data",(e=>{r=new d.Block(e,o(this,n,"f"))})).on("error",(e=>{t(e)})).on("end",(()=>{e(r)}))})),o(this,i,"f").get(g).catch((e=>null))]);if(e&&(this.earliest=e),t)this.latest=await this.get(t);else{const e=this.base.createValueStream();this.latest=await new Promise(((t,r)=>{let s;e.on("data",(e=>{const t=new d.Block(e,o(this,n,"f"));(!s||t.header.number.toBigInt()>s.header.number.toBigInt())&&(s=t)})).on("error",(e=>{r(e)})).on("end",(()=>{t(s)}))})),this.latest&&await o(this,i,"f").put(g,this.latest.header.number.toBuffer()).catch((e=>null))}}}t.default=BlockManager,s=new WeakMap,n=new WeakMap,i=new WeakMap},318:function(e,t,r){"use strict";var s,n=this&&this.__classPrivateFieldSet||function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r},i=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(5),c=a(r(76)),l=r(1),u=r(442);class BlockLogManager extends c.default{constructor(e,t){super(e,o.BlockLogs),s.set(this,void 0),n(this,s,t,"f")}async get(e){const t=await super.get(e);if(t)t.blockNumber=l.Quantity.from(e);else if(i(this,s,"f").fallback){const t=l.Quantity.from(e),r=await i(this,s,"f").fallback.request("eth_getLogs",[{fromBlock:t,toBlock:t}]);return o.BlockLogs.fromJSON(r)}return t}async getLogs(e){const t=i(this,s,"f");if("blockHash"in e){const{addresses:r,topics:s}=(0,u.parseFilterDetails)(e),n=await t.blocks.getNumberFromHash(e.blockHash);if(!n)return[];const i=await this.get(n);return i?[...i.filter(r,s)]:[]}{const{addresses:r,topics:s,fromBlock:n,toBlockNumber:i}=(0,u.parseFilter)(e,t),a=[this.get(n.toBuffer())],o=n.toNumber();if(o!==i)for(let e=o+1,t=i+1;e<t;e++)a.push(this.get(l.Quantity.toBuffer(e)));return Promise.all(a).then((e=>{const t=[];return e.forEach((e=>{e&&t.push(...e.filter(r,s))})),t}))}}}t.default=BlockLogManager,s=new WeakMap},76:function(e,t,r){"use strict";var s,n,i=this&&this.__classPrivateFieldSet||function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r},a=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0});const o=r(1);t.default=class Manager{constructor(e,t,r){s.set(this,void 0),n.set(this,void 0),i(this,s,t,"f"),i(this,n,r,"f"),this.base=e}getRaw(e){return"string"==typeof e&&(e=o.Data.toBuffer(e)),0===e.length&&(e=o.BUFFER_ZERO),this.base.get(e).catch((e=>{if(404===e.status)return null;throw e}))}async get(e){const t=await this.getRaw(e);return t?new(a(this,s,"f"))(t,a(this,n,"f")):null}set(e,t){return this.base.put(e,t)}del(e){return this.base.del(e)}},s=new WeakMap,n=new WeakMap},319:function(e,t,r){"use strict";var s,n,i,a,o,c=this&&this.__classPrivateFieldSet||function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r},l=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const h=u(r(76)),d=u(r(311)),p=u(r(320)),m=r(1),g=r(10),y=r(36);class TransactionManager extends h.default{constructor(e,t,r,u){super(u,y.TransactionFactory,t),s.set(this,new p.default),n.set(this,!1),i.set(this,void 0),a.set(this,void 0),o.set(this,void 0),this.fromFallback=async e=>{const{fallback:t}=l(this,o,"f"),r=await t.request("eth_getTransactionByHash",[m.Data.toString(e)]);if(null==r)return null;const s=m.Data.from(r.blockHash,32),n=m.Quantity.from(r.blockNumber),i=m.Quantity.from(r.transactionIndex);if(!t.isValidForkBlockNumber(n))return null;const a=[g.Address.toBuffer(r.from),m.Data.toBuffer(r.hash,32),s.toBuffer(),n.toBuffer(),i.toBuffer(),m.Quantity.toBuffer(r.gasPrice)],c=t.getCommonForBlockNumber(t.common,n.toBigInt());return y.TransactionFactory.fromRpc(r,c,a).serializeForDb(s,n,i)},this.resume=()=>{l(this,n,"f")&&(c(this,n,!1,"f"),l(this,a,"f").call(this))},c(this,o,r,"f"),this.transactionPool=new d.default(e,r)}async getRaw(e){return super.getRaw(e).then((t=>null==t&&l(this,o,"f").fallback?this.fromFallback(e):t))}async get(e){const t=await super.get(e);return t?t.tx:null}async add(e,t){l(this,n,"f")&&await l(this,i,"f");const r=this.transactionPool.prepareTransaction(e,t),a=await l(this,s,"f").add(r);return a&&this.transactionPool.drain(),a}clear(){l(this,s,"f").clear(!1),this.transactionPool.clear()}async pause(){l(this,n,"f")||(c(this,n,!0,"f"),c(this,i,new Promise((e=>{c(this,a,e,"f")})),"f")),l(this,s,"f").isBusy()&&await l(this,s,"f").emit("idle")}}t.default=TransactionManager,s=new WeakMap,n=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap},321:function(e,t,r){"use strict";var s,n=this&&this.__classPrivateFieldSet||function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r},i=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=a(r(76)),c=r(1),l=r(36),u=r(10);class TransactionReceiptManager extends o.default{constructor(e,t){super(e,l.InternalTransactionReceipt),s.set(this,void 0),n(this,s,t,"f")}async get(e){const t=await super.get(e);if(t)return t;if(i(this,s,"f").fallback){const t=await i(this,s,"f").fallback.request("eth_getTransactionReceipt",["string"==typeof e?e:c.Data.from(e)]);if(!t)return null;const r="0x1"===t.status?c.Quantity.One.toBuffer():c.BUFFER_ZERO,n=c.Quantity.toBuffer(t.cumulativeGasUsed),a=c.Data.toBuffer(t.logsBloom,256),o=t.logs.map((e=>[u.Address.from(e.address).toBuffer(),e.topics.map((e=>c.Data.toBuffer(e))),Array.isArray(e.data)?e.data.map((e=>c.Data.toBuffer(e))):c.Data.toBuffer(e.data)])),h=c.Quantity.toBuffer(t.gasUsed),d=null==t.contractAddress?c.BUFFER_EMPTY:u.Address.from(t.contractAddress).toBuffer();return l.InternalTransactionReceipt.fromValues(r,n,a,o,h,d)}}}t.default=TransactionReceiptManager,s=new WeakMap},316:function(e,t,r){"use strict";var s,n,i,a,o,c=this&&this.__classPrivateFieldSet||function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r},l=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const h=u(r(27)),d=r(362),p=u(r(115)),m=u(r(142)),g=u(r(232)),y=r(140);(0,d.setGracefulCleanup)();const w={prefix:"ganache_",unsafeCleanup:!0},noop=()=>Promise.resolve();class Database extends h.default{constructor(e,t){super(),s.set(this,void 0),n.set(this,noop),i.set(this,!1),this.directory=null,this.db=null,a.set(this,void 0),this.initialize=async()=>{const e={keyEncoding:"binary",valueEncoding:"binary"},t=l(this,s,"f").db;let r;if(t)c(this,a,(0,m.default)(t,e),"f"),r=y(l(this,a,"f"),{});else{let t=l(this,s,"f").dbPath;if(!t){const e=await(0,d.dir)(w);if(t=e.path,c(this,n,e.cleanup,"f"),l(this,i,"f"))return l(this,o,"f").call(this)}this.directory=t;const u={prefix:""},h=(0,m.default)((0,g.default)(t,u),e);c(this,a,h,"f"),r=y(h)}if(l(this,i,"f"))return l(this,o,"f").call(this);const u=r.open();return this.trie=(0,p.default)(r,"T",e),this.db=r,await u,l(this,i,"f")?l(this,o,"f").call(this):(this.blocks=(0,p.default)(r,"b",e),this.blockIndexes=(0,p.default)(r,"i",e),this.blockLogs=(0,p.default)(r,"l",e),this.transactions=(0,p.default)(r,"t",e),this.transactionReceipts=(0,p.default)(r,"r",e),this.storageKeys=(0,p.default)(r,"s",e),this.emit("ready"))},o.set(this,(async()=>{const e=this.db;return e&&(await new Promise(((t,r)=>e.close((e=>{e?r(e):t(void 0)})))),await Promise.all([this.blocks.close(),this.blockIndexes.close(),this.blockIndexes.close(),this.transactionReceipts.close(),this.transactions.close(),this.storageKeys.close(),this.trie.close()])),l(this,n,"f").call(this)})),c(this,s,e,"f"),this.blockchain=t}batch(e){const t=l(this,a,"f").db,r=this.db.batch(),s=t.put,n=t.del;let i;t.put=r.put.bind(r),t.del=r.del.bind(r);try{const a=e();i=r.write().then((()=>a))}finally{t.put=s,t.del=n}return i}async close(){const e=l(this,i,"f");c(this,i,!0,"f"),await l(this,o,"f").call(this),e||this.emit("close")}}t.default=Database,s=new WeakMap,n=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap},389:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ForkCache=void 0;const n=r(0),i=s(r(537));class ForkCache extends i.default{constructor(e){super({getCb:async t=>{const r=await e.get(t.buf);return r?n.Account.fromRlpSerializedAccount(r):new n.Account},putCb:e.put.bind(e),deleteCb:e.del.bind(e)})}}t.ForkCache=ForkCache},566:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function Deferred(){const e={};return e.promise=new Promise(((t,r)=>{e.resolve=t,e.reject=r})),e}},322:function(e,t,r){"use strict";var s,n,i,a,o,c,l,u,h=this&&this.__classPrivateFieldSet||function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r},d=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Fork=void 0;const m=r(1),g=p(r(561)),y=p(r(19)),w=r(303),b=r(392),_=r(5),v=r(74),k=p(r(183)),E=r(890),B=r(304),P=r(88);async function fetchNetworkId(e){const t=await e.request("net_version",[]);return parseInt(t,10)}function fetchBlock(e,t){return e.request("eth_getBlockByNumber",[t,!0])}t.Fork=class Fork{constructor(e,t){s.set(this,new g.default),n.set(this,void 0),i.set(this,void 0),a.set(this,void 0),o.set(this,void 0),c.set(this,(async e=>{const[t,r]=await Promise.all([e,fetchNetworkId(this)]);this.chainId=t,this.common=y.default.forCustomChain(m.KNOWN_CHAINIDS.has(t)?t:1,{name:"ganache-fork",defaultHardfork:d(this,o,"f"),networkId:r,chainId:d(this,i,"f").chain.chainId,comment:"Local test network fork"}),this.common.on=()=>{}})),l.set(this,(async e=>{const{fork:t}=d(this,i,"f");if(t.blockNumber===_.Tag.latest){const[r,s]=await Promise.all([fetchBlock(this,_.Tag.latest),e]);let n=parseInt(r.number,16);const i=m.KNOWN_CHAINIDS.has(s)?Math.max(n-t.preLatestConfirmations,0):n;let a;return a=i!==n?await fetchBlock(this,m.Quantity.from(i)):r,t.blockNumber=i,this.blockNumber=m.Quantity.from(i),this.stateRoot=m.Data.from(a.stateRoot),await d(this,u,"f").call(this,this.blockNumber),a}if(Number.isInteger(t.blockNumber)&&t.blockNumber>=0){const e=m.Quantity.from(t.blockNumber),[s]=await Promise.all([fetchBlock(this,e).then((async t=>(this.stateRoot=t.stateRoot,await d(this,u,"f").call(this,e),t))),(r=this,r.request("eth_blockNumber",[],{disableCache:!0})).then((r=>{const s=parseInt(r,16);if(t.blockNumber>s)throw new Error(`\`fork.blockNumber\` (${t.blockNumber}) must not be greater than the current block number (${s})`);this.blockNumber=e}))]);return s}throw new Error(`Invalid value for \`fork.blockNumber\` option: "${t.blockNumber}". Must be a positive integer or the string "latest".`);var r})),u.set(this,(e=>Promise.all(d(this,a,"f").map((async t=>{const r=await async function fetchNonce(e,t,r){const s=await e.request("eth_getTransactionCount",[t,r]);return m.Quantity.from(s)}(this,t.address,e);t.nonce=r}))))),h(this,i,e,"f");const r=e.fork;h(this,o,e.chain.hardfork,"f"),h(this,a,t,"f");const{url:p,network:v}=r;if(p){const{protocol:t}=p;switch(t){case"ws:":case"wss:":h(this,n,new b.WsHandler(e,d(this,s,"f").signal),"f");break;case"http:":case"https:":h(this,n,new w.HttpHandler(e,d(this,s,"f").signal),"f");break;default:throw new Error(`Unsupported protocol: ${t}`)}}else if(r.provider)h(this,n,new E.ProviderHandler(e,d(this,s,"f").signal),"f");else if(v){let t;"g\xf6rli"===v?r.network=t="goerli":t=v;const i="db244d7eaedb430ebea06787b77a7d5a";if(!i)throw new Error("The INFURA_KEY environment variable was not given and is required when using Ganache's integrated archive network feature.");r.url=new P.URL(`wss://${t}.infura.io/ws/v3/${i}`),h(this,n,new b.WsHandler(e,d(this,s,"f").signal),"f")}}async initialize(){let e;const{fork:t,chain:r,miner:s}=d(this,i,"f");t.deleteCache&&await B.PersistentCache.deleteDb(),e=!1===t.disableCache?B.PersistentCache.create().catch((e=>null)):null;const n=async function fetchChainId(e){const t=await e.request("eth_chainId",[]);return parseInt(t,16)}(this),[a,o]=await Promise.all([d(this,l,"f").call(this,n),e,d(this,c,"f").call(this,n)]),u=this.getCommonForBlockNumber(this.common,this.blockNumber.toBigInt());this.block=new v.Block(k.default.rawFromJSON(a,u),u),r.time||"clock"===s.timestampIncrement||(r.time=new Date(1e3*(this.block.header.timestamp.toNumber()+s.timestampIncrement.toNumber()))),o&&await this.initCache(o)}async initCache(e){await e.initialize(this.block.header.number,this.block.hash(),this.request.bind(this)),d(this,n,"f").setCache(e)}request(e,t,r={disableCache:!1}){return d(this,n,"f").request(e,t,r)}abort(){return d(this,s,"f").abort()}close(){return d(this,n,"f").close()}isValidForkBlockNumber(e){return e.toBigInt()<=this.blockNumber.toBigInt()}selectValidForkBlockNumber(e){return this.isValidForkBlockNumber(e)?e:this.blockNumber}getCommonForBlockNumber(e,t){if(t<=this.blockNumber.toBigInt()){if(m.KNOWN_CHAINIDS.has(this.chainId)){let r;for(const s of e.hardforks())if(null!==s.block){if(!(t>=BigInt(s.block)))break;r=s.name}return new y.default({chain:this.chainId,hardfork:r})}return y.default.forCustomChain(1,{chainId:this.chainId},e.hardfork())}return e}},s=new WeakMap,n=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap},117:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseHandler=void 0;const n=r(1),i=s(r(390)),a=s(r(563)),o=r(5);class BaseHandler{constructor(e,t){this.id=1,this.requestCache=new Map,this.fireForget=new Set;const r=e.fork,{requestsPerSecond:s,url:n,userAgent:o,origin:c}=r;if(this.abortSignal=t,this.limiter=new i.default(30*s,3e4,t),this.valueCache=new a.default({max:1073741824,length:(e,t)=>e.length+t.length}),n){const e={"user-agent":o};c&&(e.origin=c),n.password=n.username="";const t=n.host.endsWith(".infura.io");BaseHandler.setAuthHeaders(r,e),BaseHandler.setUserHeaders(r,e,!t),this.headers=e}}setCache(e){this.persistentCache=e}static setAuthHeaders(e,t){if(null!=e.username||null!=e.password){if(null!=e.jwt)throw new Error("Authentication via both username/password (Basic) and JWT (Bearer) is not possible");t.authorization=`Basic ${Buffer.from(`${e.username||""}:${e.password||""}`).toString("base64")}`}else e.jwt&&(t.authorization=`Bearer ${e.jwt}`)}static setUserHeaders(e,t,r){const s=e.headers;if(s)for(let e=0,n=s.length;e<n;e++){let{name:n,value:i}=s[e];const a=n.toLowerCase();if("authorization"===a&&"authorization"in t){if(!r)throw new Error("Authentication with multiple auth-params is not allowed.");const e=t.authorization.split(" ",1)[0],[s,n]=i.split(/\.(?:.+)/);if(s.toLowerCase()!==e.toLowerCase())throw new Error(`Authentication via both ${e} and ${s} is not allowed.`);t.authorization+=","+n}else t[a]=i}}getFromMemCache(e){const t=this.requestCache.get(e);if(void 0!==t)return t;const r=this.valueCache.get(e);return void 0!==r?JSON.parse(r).result:void 0}async getFromSlowCache(e,t,r){if(!this.persistentCache)return;const s=await this.persistentCache.get(e,t,r).catch((e=>{if(e.notFound)return null;throw e}));return null!=s?{result:JSON.parse(s).result,raw:s}:void 0}async queueRequest(e,t,r,s,i={disableCache:!1}){if(!i.disableCache){const s=this.getFromMemCache(r);if(void 0!==s)return s;const n=await this.getFromSlowCache(e,t,r);if(void 0!==n)return this.valueCache.set(r,Buffer.from(n.raw)),n.result}const a=this.limiter.handle(s).then((async({response:s,raw:a})=>{if(this.abortSignal.aborted)return Promise.reject(new o.AbortError);if((0,n.hasOwn)(s,"result")){if(!i.disableCache&&(this.valueCache.set(r,a),this.persistentCache)){const s=this.persistentCache.put(e,t,r,"string"==typeof a?Buffer.from(a):a).catch((e=>{}));this.fireForget.add(s),s.finally((()=>{this.fireForget.delete(s)}))}return s.result}if((0,n.hasOwn)(s,"error")&&null!=s.error){const{error:e}=s;throw new o.CodedError(e.message,e.code)}throw new Error(`Invalid response from fork provider: \`${JSON.stringify(s)}\``)}));return this.requestCache.set(r,a),await a}async close(){await Promise.all(this.fireForget.keys()),this.persistentCache&&await this.persistentCache.close()}}t.BaseHandler=BaseHandler,BaseHandler.JSONRPC_PREFIX='{"jsonrpc":"2.0","id":'},303:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return n(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HttpHandler=void 0;const o=r(5),c=i(r(99)),l=i(r(167)),u=r(117),h=a(r(566)),{JSONRPC_PREFIX:d}=u.BaseHandler;class HttpHandler extends u.BaseHandler{constructor(e,t){super(e,t),this.url=e.fork.url,this.headers.accept=this.headers["content-type"]="application/json","http:"===this.url.protocol?(this._request=c.default.request,this.agent=new c.Agent({keepAlive:!0,scheduling:"fifo"})):(this._request=l.default.request,this.agent=new l.Agent({keepAlive:!0,scheduling:"fifo"}))}async handleLengthedResponse(e,t){return await new Promise(((r,s)=>{const n=Buffer.allocUnsafe(t);let i=0;e.on("data",(function data(e){const t=e.length;e.copy(n,i,0,t),i+=t})),e.on("end",(function end(){i!==t?s(new Error("content-length mismatch")):r(n)})),e.on("error",s)}))}async handleChunkedResponse(e){const t=[];let r=0;for await(let s of e)t.push(s),r+=s.length;return 1===t.length?t[0]:Buffer.concat(t,r)}async request(e,t,r={disableCache:!1}){const s=JSON.stringify({method:e,params:t}),{protocol:n,hostname:i,port:a,pathname:c,search:l}=this.url,u={protocol:n,host:i,port:a,path:c+l,headers:this.headers,method:"POST",agent:this.agent,signal:this.abortSignal};return await this.queueRequest(e,t,s,(()=>{if(this.abortSignal.aborted)return Promise.reject(new o.AbortError);const e=(0,h.default)(),t=`${d}${this.id++},${s.slice(1)}`;this.headers["content-length"]=t.length;const r=this._request(u);return r.on("response",(t=>{const{headers:r}=t;let s;if("transfer-encoding"in r)s=this.handleChunkedResponse(t);else{const e=r["content-length"]/1;s=isNaN(e)||e<=0?this.handleChunkedResponse(t):this.handleLengthedResponse(t,e)}s.then((t=>{try{e.resolve({response:JSON.parse(t),raw:t})}catch{const r=t.toString();let s;s=r.length>340?r.slice(0,320)+"\u2026":r;let n=`Invalid JSON response from fork provider:\n\n ${s}`;(r.startsWith("invalid project id")||r.startsWith("project id required in the url"))&&this.url.host.endsWith("infura.io")&&(n+=`\n\nThe provided fork url, ${this.url}, may be an invalid or incorrect Infura endpoint.`,n+="\nVisit https://infura.io/docs/ethereum for Infura documentation."),e.reject(new Error(n))}}))})),r.setTimeout(5e3,r.abort.bind(r,null)),r.on("error",e.reject),r.write(t),r.end(),e.promise.finally((()=>this.requestCache.delete(s)))}),r)}}t.HttpHandler=HttpHandler},890:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProviderHandler=void 0;const s=r(117);class ProviderHandler extends s.BaseHandler{constructor(e,t){super(e,t);const r=e.fork.provider;if("function"==typeof r.request)this._request=async(e,t)=>{try{const s={result:await r.request({method:e,params:t})};return{response:s,raw:JSON.stringify(s)}}catch(e){if("number"!=typeof e.code)throw e;return{response:{error:e},raw:null}}};else{if("function"!=typeof r.send)throw new Error("Forking `provider` must be EIP-1193 compatible");this._request=async(e,t)=>await new Promise(((s,n)=>{const i={id:this.id++,jsonrpc:"2.0",method:e,params:t};r.send(i,((e,t)=>{e?n(e):s({response:t,raw:JSON.stringify(t)})}))}))}}async request(e,t,r={disableCache:!1}){const s=JSON.stringify(t);return await this.queueRequest(e,t,`${e}:${s}`,(()=>this._request(e,JSON.parse(s))),r)}}t.ProviderHandler=ProviderHandler},392:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WsHandler=void 0;const n=r(5),i=s(r(258)),a=r(117),o=s(r(566)),{JSONRPC_PREFIX:c}=a.BaseHandler;class WsHandler extends a.BaseHandler{constructor(e,t){super(e,t),this.inFlightRequests=new Map;const{url:r,origin:s}=e.fork;this.connection=new i.default(r.toString(),{origin:s,headers:this.headers}),this.connection.binaryType="nodebuffer",this.open=this.connect(this.connection),this.connection.onclose=()=>{this.open=this.connect(this.connection)},this.abortSignal.addEventListener("abort",(()=>{this.connection.onclose=null,this.connection.close(1e3)})),this.connection.onmessage=this.onMessage.bind(this)}async request(e,t,r={disableCache:!1}){if(await this.open,this.abortSignal.aborted)return Promise.reject(new n.AbortError);const s=JSON.stringify({method:e,params:t});return await this.queueRequest(e,t,s,(()=>{if(this.abortSignal.aborted)return Promise.reject(new n.AbortError);const e=this.id++,t=(0,o.default)();return this.inFlightRequests.set(e,t),this.connection.send(`${c}${e},${s.slice(1)}`),t.promise.finally((()=>this.requestCache.delete(s)))}),r)}onMessage(e){if("message"!==e.type)return;const t=e.data,r=JSON.parse(t),s=r.id,n=this.inFlightRequests.get(s);n&&(this.inFlightRequests.delete(s),n.resolve({response:r,raw:t}))}connect(e){let t=new Promise(((t,r)=>{e.onopen=t,e.onerror=r}));return t.then((()=>{e.onopen=null,e.onerror=null}),(e=>{console.log(e)})),t}async close(){await super.close(),this.connection.close()}}t.WsHandler=WsHandler},257:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decode=t.encode=void 0;const s=r(1);t.encode=function encode(e){const t=e.length;let r=0;const n=[];for(let i=0;i<t;i++){const t=e[i];if(null===t)r+=2,n.push([s.BUFFER_ZERO,s.BUFFER_EMPTY]);else{const e=t.length,i=s.Quantity.toBuffer(e);r+=1+i.length+e,n.push([i,t])}}const i=Buffer.allocUnsafe(r);let a=0;for(let e=0;e<t;e++){const[t,r]=n[e],s=t.length;i[a++]=s,t.copy(i,a,0,s),r.copy(i,a+=s,0,r.length),a+=r.length}return i},t.decode=function decode(e){const t=[];for(let r=0,n=e.length;r<n;){const n=e[r++],i=s.Quantity.from(e.slice(r,r+=n)).toNumber();t.push(e.slice(r,r+=i))}return t}},891:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Ancestry=void 0;const s=r(1),n=r(107);t.Ancestry=class Ancestry{constructor(e,t){this.cacheLock=new Map,this.db=e,null==t?(this.next=null,this.knownAncestors=new Set):(this.next=t.closestKnownAncestor.equals(s.BUFFER_EMPTY)?null:t.closestKnownAncestor,this.knownAncestors=new Set([t.hash.toString("hex")]))}async loadNextAncestor(e){const t=e.toString("hex");if(this.cacheLock.has(t))throw new Error("couldn't load next ancestor as it is locked");let r;this.cacheLock.set(t,new Promise((e=>{r=e})));const i=await this.db.get(e),a=n.Tree.deserialize(e,i);this.next=a.closestKnownAncestor.equals(s.BUFFER_EMPTY)?null:a.closestKnownAncestor,this.knownAncestors.add(a.hash.toString("hex")),this.cacheLock.delete(t),r()}async has(e){const t=e.toString("hex");if(this.knownAncestors.has(t))return!0;if(this.next){const t=this.cacheLock.get(this.next.toString("hex"));return t?(await t,this.has(e)):(await this.loadNextAncestor(this.next),this.has(e))}return!1}}},892:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBlockByNumber=t.findClosestDescendants=t.findClosestAncestor=t.findRelated=t.resolveTargetAndClosestAncestor=t.setDbVersion=t.getBlockNumberFromParams=void 0;const s=r(5),n=r(1),i=r(107);async function*findRelated(e,t,r){const s=e.createReadStream({keys:!0,values:!0,...r});for await(const e of s){const{key:r,value:s}=e,a=i.Tree.deserialize(r,s),{height:o}=a.decodeKey(),c=await getBlockByNumber(t,o);null!=c&&c.hash===n.Data.toString(a.hash)&&(yield a)}}async function findClosestAncestor(e,t,r,s){const a=findRelated(e,t,{gte:s,lt:i.Tree.encodeKey(r,n.Data.Empty),reverse:!0}),o=await a.next();return await a.return(),o.value}async function getBlockByNumber(e,t){return await e("eth_getBlockByNumber",[t.toString(),!1])}t.getBlockNumberFromParams=function getBlockNumberFromParams(e,t){switch(e){case"eth_getBlockByNumber":return t[0];case"eth_getTransactionCount":case"eth_getCode":case"eth_getBalance":return t[1];case"eth_getStorageAt":return t[2];default:return null}},t.setDbVersion=async function setDbVersion(e,t){try{const r=await e.get("version");if(!t.equals(r))throw new Error(`Persistent cache version "${t.toString()}"" is not understood.`)}catch(r){if(!r.notFound)throw r;await e.put("version",t)}},t.resolveTargetAndClosestAncestor=async function resolveTargetAndClosestAncestor(e,t,r,a){let o,c,l;try{const s=i.Tree.encodeKey(r,a);o=i.Tree.deserialize(s,await e.get(s)),o.closestKnownAncestor.equals(n.BUFFER_EMPTY)?(c=null,l=null):(l=i.Tree.deserialize(o.closestKnownAncestor,await e.get(o.closestKnownAncestor)),c=await findClosestAncestor(e,t,r,l.key)||l)}catch(u){if(!u.notFound)throw u;if(l=null,0n===r.toBigInt())c=null,o=new i.Tree(r,a);else{const l=await getBlockByNumber(t,s.Tag.earliest);if(!l)throw new Error('Could not find "earliest" block.');const{hash:u,number:h}=l,d=n.Data.from(u,32),p=new i.Tree(n.Quantity.from(h),d);c=await findClosestAncestor(e,t,r,p.key)||p,o=new i.Tree(r,a,c.key)}}return{targetBlock:o,closestAncestor:c,previousClosestAncestor:l}},t.findRelated=findRelated,t.findClosestAncestor=findClosestAncestor,t.findClosestDescendants=async function*findClosestDescendants(e,t,r){const s=findRelated(e,t,{gte:i.Tree.encodeKey(n.Quantity.from(r.toBigInt()+1n),n.Data.Empty),reverse:!1});for await(const e of s)yield e},t.getBlockByNumber=getBlockByNumber},304:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return n(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PersistentCache=void 0;const o=r(107),c=r(13),l=a(r(575)),u=a(r(232)),h=a(r(115)),d=a(r(142)),p=i(r(257)),m=r(1),g=r(891),y=r(892),w=r(140),b={keyEncoding:"binary",valueEncoding:"binary"},_={prefix:""},v=Buffer.from([255]);class PersistentCache{constructor(){this.version=m.BUFFER_ZERO,this._reBalancePromise=null,this.status="open"}static async deleteDb(e){return new Promise(((t,r)=>{const s=PersistentCache.getDbDirectory(e);u.default.destroy(s,(e=>{e?r(e):t(void 0)}))}))}static async serializeDb(e){const t=await PersistentCache.create(e);return await new Promise((async e=>{const r=t.ancestorDb.createReadStream({gte:m.BUFFER_ZERO,keys:!0,values:!0}),s={},n={};for await(const e of r){const{key:t,value:r}=e,i=o.Tree.deserialize(t,r);i.height=i.decodeKey().height.toNumber();const a=t.toString("hex"),c=i.closestKnownAncestor.toString("hex");if(n[a]=i,0===i.closestKnownAncestor.length)s[a]=i;else{const e=n[c].descendants||{};e[a]=i,n[c].descendants=e}i.hash=m.Data.toString(i.hash),i.parent=i.closestKnownAncestor.length>0?m.Data.toString(n[c].hash):null,delete i.key,delete i.closestKnownDescendants,delete i.closestKnownAncestor}await t.close(),e(JSON.parse(JSON.stringify(s)))}))}static getDbDirectory(e=""){const{data:t}=(0,l.default)("Ganache/db",{suffix:e});return t}static async create(e){const t=new PersistentCache,r=PersistentCache.getDbDirectory(e);await c.promises.mkdir(r,{recursive:!0});const s=(0,d.default)((0,u.default)(r,_),b),n=await new Promise(((e,t)=>{const r=w(s,(s=>{s?t(s):e(r)}))}));return t.db=n,t.cacheDb=(0,h.default)(n,"c",b),t.ancestorDb=(0,h.default)(n,"a",b),await t.cacheDb.open(),await t.ancestorDb.open(),await(0,y.setDbVersion)(t.db,t.version),t}async initialize(e,t,r){this.hashBuffer=t.toBuffer(),this.request=r;const{targetBlock:s,closestAncestor:n,previousClosestAncestor:i}=await(0,y.resolveTargetAndClosestAncestor)(this.ancestorDb,this.request,e,t);this.ancestry=new g.Ancestry(this.ancestorDb,n);const a=this.ancestorDb.batch();if(i&&!i.key.equals(n.key)){s.closestKnownAncestor=n.key;const e=i.closestKnownDescendants.findIndex((e=>e.equals(s.key)));i.closestKnownDescendants.splice(e,1),a.put(i.key,i.serialize())}let c=[...s.closestKnownDescendants];if(null==n)a.put(s.key,s.serialize());else{const t=[s.key];await Promise.all(n.closestKnownDescendants.map((async r=>{if(r.equals(s.key))return;const{height:n}=o.Tree.decodeKey(r);if(n.toBigInt()<=e.toBigInt())return void t.push(r);const i=await this.ancestorDb.get(r),l=o.Tree.deserialize(r,i),u=await this.getBlock(n);null==u||u.hash!==m.Data.toString(l.hash,32)?t.push(r):(s.closestKnownDescendants.push(l.key),c.push(...l.closestKnownDescendants),l.closestKnownAncestor=s.key,a.put(l.key,l.serialize()))}))),n.closestKnownDescendants=t,a.put(n.key,n.serialize())}a.put(s.key,s.serialize()),await a.write(),this._reBalancePromise=this.reBalanceDescendantTree(e,s,c).catch((e=>{})).finally((()=>{this._reBalancePromise=null}))}async getBlock(e){return await(0,y.getBlockByNumber)(this.request,e)}async reBalanceDescendantTree(e,t,r){const s=this.ancestorDb.batch(),n=t.closestKnownDescendants,i=n.length;for await(const i of(0,y.findClosestDescendants)(this.ancestorDb,this.request,e)){const e=i.key;if(t.key.equals(e))continue;if(r.push(...i.closestKnownDescendants),n.some((t=>t.equals(e))))continue;if(r.some((t=>t.equals(e))))continue;const a=o.Tree.deserialize(i.closestKnownAncestor,await this.ancestorDb.get(i.closestKnownAncestor));if(a.closestKnownDescendants.splice(a.closestKnownDescendants.findIndex((t=>t.equals(e))),1),i.closestKnownAncestor=t.key,n.push(i.key),s.put(a.key,a.serialize()),s.put(i.key,i.serialize()),"closed"===this.status)break}i!==n.length&&(s.put(t.key,t.serialize()),s.length>0&&this.ancestorDb.isOpen()&&await s.write())}async get(e,t,r){const s=(0,y.getBlockNumberFromParams)(e,t);if(null==s)return;const n=m.Quantity.from(s),i=Buffer.from(r),a=p.encode([n.toBuffer(),i]),o=Buffer.concat([a,v]),c=this.cacheDb.createReadStream({gt:a,lt:o,keys:!0,values:!0});for await(const e of c){const{key:t,value:r}=e,[s,n,a]=p.decode(t);if(!n.equals(i))return;if(this.hashBuffer.equals(a)||await this.ancestry.has(a))return r}}async put(e,t,r,s){const n=(0,y.getBlockNumberFromParams)(e,t);if(null==n)return!1;const i=m.Quantity.from(n),a=p.encode([i.toBuffer(),Buffer.from(r),this.hashBuffer]);return await this.cacheDb.put(a,s),!0}async close(){"closed"!==this.status&&(this.status="closed",this.cacheDb&&await this.cacheDb.close(),this.ancestorDb&&(await this._reBalancePromise,await this.ancestorDb.close()),this.db&&await this.db.close())}}t.PersistentCache=PersistentCache},107:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Tree=void 0;const a=i(r(257)),o=r(1),c=i(r(15));class Tree{constructor(e,t,r=o.BUFFER_EMPTY){this.closestKnownDescendants=[],this.key=Tree.encodeKey(e,t),this.hash=t.toBuffer(),this.closestKnownAncestor=r}serialize(){return c.encode([this.hash,this.closestKnownAncestor,this.closestKnownDescendants])}decodeKey(){return Tree.decodeKey(this.key)}static decodeKey(e){const[t,r]=a.decode(e);return{height:o.Quantity.from(t),hash:o.Data.from(r)}}static deserialize(e,t){const[r,s,n]=c.decode(t),i=Object.create(Tree.prototype);return i.key=e,i.hash=r,i.closestKnownAncestor=s,i.closestKnownDescendants=n,i}static encodeKey(e,t){return a.encode([e.toBuffer(),t.toBuffer()])}}t.Tree=Tree},889:(e,t)=>{"use strict";function timeSince(e){return Date.now()-e}Object.defineProperty(t,"__esModule",{value:!0}),t.LimitCounter=void 0;t.LimitCounter=class LimitCounter{constructor(e){this.counters=new Map,this.windowLength=e}evict(){const e=3*this.windowLength;if(timeSince(this.lastEvict)<e)return;this.lastEvict=Date.now();const t=this.counters;t.forEach(((r,s)=>{timeSince(r.updatedAt)>=e&&t.delete(s)}))}increment(e){this.evict();let t=this.counters.get(e);null==t?this.counters.set(e,{value:1,updatedAt:Date.now()}):(t.value+=1,t.updatedAt=Date.now())}get(e,t){let r=this.counters.get(e);null==r&&(r={value:0,updatedAt:Date.now()});let s=this.counters.get(t);return null==s&&(s={value:0,updatedAt:Date.now()}),[r.value,s.value]}}},390:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(1),a=s(r(391)),o=r(889),sleep=(e,t)=>t.aborted?Promise.reject(new n.AbortError):new Promise(((r,s)=>{function abort(){clearTimeout(i),t.removeEventListener("abort",abort),s(new n.AbortError)}const i=setTimeout((()=>{t.removeEventListener("abort",abort),r()}),e);t.addEventListener("abort",abort)}));t.default=class RateLimiter{constructor(e,t,r){this.sem=(0,a.default)(1),this.take=()=>new Promise((e=>this.sem.take(e))),this.mustBackoff=null,this.counter=0,this.requestLimit=e,this.windowSizeMs=t/2,this.limitCounter=new o.LimitCounter(this.windowSizeMs),this.abortSignal=r}status(e,t){const r=this.requestLimit,s=this.windowSizeMs,n=t,i=n-s,[a,o]=this.limitCounter.get(n,i);let c;if(c=0===o?a:o*((s-(e-n))/s)+a,r>0&&c+1>r){const e=a+1,t=r+1;return{rate:c,next:0===o?n+s+s/t:s*(o+e-t)/o+n}}return{rate:c,next:e}}async handle(e){await this.take();try{return await this.schedule(e)}finally{this.sem.leave()}}async schedule(e){const t=this.abortSignal;for(;;){if(t.aborted)return Promise.reject(new n.AbortError);this.mustBackoff&&await this.mustBackoff;const o=Date.now(),c=(s=o,a=this.windowSizeMs,s-s%a),{rate:l,next:u}=this.status(o,c);if(!(l+1>this.requestLimit&&u>o)){this.limitCounter.increment(c);const s=await e();if(r=s.response,(0,i.hasOwn)(r,"error")&&null!=r.error&&r.error.code===i.JsonRpcErrorCode.LIMIT_EXCEEDED&&(0,i.hasOwn)(s.response.error.data,"rate")){const e=s.response.error.data.rate.backoff_seconds;this.requestLimit=s.response.error.data.rate.allowed_rps*(this.windowSizeMs/1e3);const r=this.mustBackoff=sleep(1e3*e,t);await this.mustBackoff,this.mustBackoff===r&&(this.mustBackoff=null);continue}return s}await sleep(Date.now()-u,t)}var r,s,a}}},388:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ForkStateManager=void 0;const n=r(79),i=s(r(196)),a=r(389);class ForkStateManager extends i.default{constructor(e){super(e),this._cache=new a.ForkCache(e.trie)}copy(){return new ForkStateManager({trie:this._trie.copy(!1),common:this._common})}async _lookupStorageTrie(e){const t=await this.getAccount(e),r=this._trie.copy(!0);return r.setContext(t.stateRoot,e.buf,r.blockNumber),r.db.checkpoints=[],r}async getContractStorage(e,t){const r=await this._getStorageTrie(e),s=await r.get(t);return(0,n.decode)(s)}}t.ForkStateManager=ForkStateManager},302:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return n(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ForkTrie=void 0;const o=r(10),c=r(1),l=r(557),u=a(r(115)),h=r(465),d=i(r(257)),p=r(15),m=r(5),g=r(0),y=Buffer.allocUnsafe(1).fill(1),w=new WeakMap,b={keyEncoding:"binary",valueEncoding:"binary"};function isEqualKey(e,t,r){const s=d.decode(e),[n,i,a]=s;return i.equals(t)&&a.equals(r)}class ForkTrie extends l.GanacheTrie{constructor(e,t,r){if(super(e,t,r),this.address=null,this.isPreForkBlock=!1,this.accountFromFallback=async(e,t)=>{const{fallback:r}=this.blockchain,s=this.blockchain.fallback.selectValidForkBlockNumber(t),n=r.request("eth_getCode",[e,s]),i=[r.request("eth_getTransactionCount",[e,s]),r.request("eth_getBalance",[e,s]),null],a=new m.Account(e);try{const e=await n;if("0x"!==e){const t=c.Data.toBuffer(e);a.codeHash=(0,c.keccak)(t),a.codeHash.equals(g.KECCAK256_NULL)||(i[2]=this.db.put(a.codeHash,t))}}catch(e){throw Promise.all(i).catch((e=>{})),e}const[o,l]=await Promise.all(i);return a.nonce="0x0"===o?c.Quantity.Empty:c.Quantity.from(o,!0),a.balance="0x0"===l?c.Quantity.Empty:c.Quantity.from(l),a.serialize()},this.storageFromFallback=async(e,t,r)=>{const s=await this.blockchain.fallback.request("eth_getStorageAt",[`0x${e.toString("hex")}`,`0x${t.toString("hex")}`,this.blockchain.fallback.selectValidForkBlockNumber(r)]);if(!s)return null;const n=s.replace(/^0x(00)*/,""),i=Buffer.from(n,"hex");return(0,p.encode)(i)},this.accounts=r.accounts,this.blockNumber=this.blockchain.fallback.blockNumber,this.forkBlockNumber=this.blockNumber.toBigInt(),w.has(e))this.metadata=new h.CheckpointDB(w.get(e));else{const t=(0,u.default)(e,"f",b);w.set(e,t),this.metadata=new h.CheckpointDB(t)}}set root(e){this._root=e}get root(){return this._root}checkpoint(){super.checkpoint(),this.metadata.checkpoint(this.root)}async commit(){await Promise.all([super.commit(),this.metadata.commit()])}async revert(){await Promise.all([super.revert(),this.metadata.revert()])}setContext(e,t,r){this._root=e,this.address=t,this.blockNumber=r,this.isPreForkBlock=r.toBigInt()<this.forkBlockNumber}async put(e,t){return super.put(e,t)}async revertMetaData(e,t){const r=this.metadata._leveldb,s=r.createKeyStream({gte:d.encode([e.toBuffer()]),lt:d.encode([c.Quantity.from(t.toBigInt()+1n).toBuffer()])}),n=r.batch();for await(const e of s)n.del(e);await n.write()}createDelKey(e){const t=this.blockNumber.toBuffer();return d.encode([t,this.address,e])}async keyWasDeleted(e){const t=null===this.address?c.BUFFER_EMPTY:this.address,r=this.metadata.checkpoints;for(let s=r.length-1;s>=0;s--)for(let[n,i]of r[s].keyValueMap.entries()){if(!i||!i.equals(y))continue;if(isEqualKey(Buffer.from(n,"binary"),t,e))return!0}const s=this.metadata._leveldb.createReadStream({lte:this.createDelKey(e),reverse:!0});for await(const r of s){const{key:s,value:n}=r;if(n&&n.equals(y)&&isEqualKey(s,t,e))return!0}return!1}async del(e){if(await this.lock.wait(),this.isPreForkBlock){const t=(0,c.keccak)(e),{node:r,stack:s}=await this.findPath(t);r&&await this._deleteNode(t,s)}else{const t=this.createDelKey(e),r=this.metadata.put(t,y),s=(0,c.keccak)(e),{node:n,stack:i}=await this.findPath(s);n&&await this._deleteNode(s,i),await r}this.lock.signal()}async get(e){const t=await super.get(e);return null!=t?t:!this.isPreForkBlock&&await this.keyWasDeleted(e)?null:null===this.address?this.accountFromFallback(o.Address.from(e),this.blockNumber):this.storageFromFallback(this.address,e,this.blockNumber)}copy(e=!0){const t=this.db.copy(),r=new ForkTrie(t._leveldb,this.root,this.blockchain);return r.accounts=this.accounts,r.address=this.address,r.blockNumber=this.blockNumber,e&&this.isCheckpoint&&(r.db.checkpoints=[...this.db.checkpoints],r.metadata.checkpoints=this.metadata.checkpoints),r}}t.ForkTrie=ForkTrie},359:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deriveFromIndex=t.deriveFromPath=t.createAccountFromSeed=t.createAccountGeneratorFromSeedAndPath=void 0;const n=r(14),i=s(r(63)),a=r(1),o=2147483648,c=Buffer.from("Bitcoin seed","utf8");function createAccountFromSeed(e){const t=(0,n.createHmac)("sha512",c).update(e).digest(),r=t.slice(0,32);return{privateKey:r,chainCode:t.slice(32),publicKey:makePublicKey(r)}}function deriveFromPath(e,t){return e.forEach((function(e,r){if(0===r){if(!/^[mM]{1}/.test(e))throw new Error('Path must start with "m" or "M"');return}const s=e.length>1&&"'"===e[e.length-1];let n=parseInt(e,10);if(n>=o)throw new Error("Invalid index");s&&(n+=o),t=deriveChild(n,s,t.privateKey,t.publicKey,t.chainCode)})),t}function deriveFromIndex(e,t){if(e>=o)throw new Error("Invalid index");return deriveChild(e,!1,t.privateKey,t.publicKey,t.chainCode)}function makePublicKey(e){const t=Buffer.allocUnsafe(33);switch(i.default.publicKeyCreate(t,e)){case 0:return t;case 1:throw new Error("Private Key is invalid");case 2:throw new Error("Public Key serialization error")}}t.createAccountGeneratorFromSeedAndPath=function createAccountGeneratorFromSeedAndPath(e,t){const r=deriveFromPath(t,createAccountFromSeed(e));return e=>deriveFromIndex(e,r)},t.createAccountFromSeed=createAccountFromSeed,t.deriveFromPath=deriveFromPath,t.deriveFromIndex=deriveFromIndex;const l=Buffer.allocUnsafe(4);function deriveChild(e,t,r,s,o){const c=l;let u;c.writeUInt32BE(e,0);const h=r.length;if(t){const e=h+1+4;u=Buffer.concat([a.BUFFER_ZERO,r,c],e)}else u=Buffer.concat([s,c],s.length+4);const d=(0,n.createHmac)("sha512",o).update(u).digest(),p=d.slice(0,32);try{const e=Buffer.allocUnsafe(h);switch(r.copy(e,0,0,h),i.default.privateKeyTweakAdd(e,p)){case 0:return{privateKey:e,publicKey:makePublicKey(e),chainCode:d.slice(32)};case 1:throw new Error("The tweak was out of range or the resulted private key is invalid")}}catch{return deriveChild(e+1,t,r,s,o)}}},831:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assertArgLength=void 0,t.assertArgLength=function assertArgLength(e,t=e){return function(r,s,n){const i=n.value;return n.value=function(){const r=arguments.length;if(r<e||r>t)throw new Error(`Incorrect number of arguments. '${s}' requires ${e===t?`exactly ${e} ${1===e?"argument":"arguments"}.`:`between ${e} and ${t} arguments.`}`);return Reflect.apply(i,this,arguments)},n}}},893:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bufferify=void 0;const r=Buffer.from('[]{},"":null'),s=r.slice(0,2),n=s.slice(0,1),i=s.slice(1,2),a=r.slice(2,4),o=a.slice(0,1),c=a.slice(1,2),l=r.slice(4,6).slice(0,1),u=r.slice(5,7),h=r.slice(6,8).slice(1,2),d=r.slice(8,12),p=r.slice(0,0),m=Object.prototype.toString;function stringToQuotedBuffer(e){const{length:t}=e;if(t>0){const r=Buffer.allocUnsafe(t+2);return r[0]=34,r[t+1]=34,r.utf8Write(e,1,t),r}return u}function*bufferify(e,t){const r=typeof e;if("number"===r||"boolean"===r)yield function numberToBuffer(e){const t=e.toString(),{length:r}=t;if(r>0){const e=Buffer.allocUnsafe(r);return e.utf8Write(t,0,r),e}return p}(e);else if("string"===r)yield stringToQuotedBuffer(e);else if(Buffer.isBuffer(e))yield function bufferToQuotedBuffer(e){const{length:t}=e,r=Buffer.allocUnsafe(t+2);return r[0]=34,e.copy(r,1,0,t),r[t+1]=34,r}(e);else if(Array.isArray(e))yield*function*arrayToBuffer(e){const{length:t}=e;if(0!==t){yield n;for(const t of bufferify(e[0],"0"))yield 0===t.length?d:t;for(let r=1;r<t;r++){yield l;for(const t of bufferify(e[r],r.toString()))yield 0===t.length?d:t}yield i}else yield s}(e);else if(u=e,"[object Object]"===m.call(u))yield*function*objectToBuffer(e,t){if("toJSON"in e)return void(yield*bufferify(e.toJSON(t),t));let r=!1;for(const t in e){const s=e[t];let n=!0;for(const e of bufferify(s,t))if(0!==e.length)if(n){n=!1;const s=stringToQuotedBuffer(t);r?yield Buffer.concat([l,s,h,e]):(yield Buffer.concat([o,s,h,e]),r=!0)}else yield e}return r?void(yield c):void(yield a)}(e,t);else if(null===e)yield d;else if("undefined"===r)yield p;else{if(!("toJSON"in e)||"function"!=typeof e.toJSON)throw new Error("unsupported value in bufferify");yield*bufferify(e.toJSON(),t)}var u}t.bufferify=bufferify},442:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseFilter=t.parseFilterRange=t.parseFilterDetails=void 0;const s=r(5),n=r(10);function parseFilterDetails(e){return{addresses:e.address?(Array.isArray(e.address)?e.address:[e.address]).map((e=>n.Address.from(e.toLowerCase()).toBuffer())):[],topics:e.topics?e.topics:[]}}function parseFilterRange(e,t){const r=t.blocks.latest.header.number,n=t.blocks.getEffectiveNumber(e.fromBlock||s.Tag.latest),i=r.toNumber(),a=t.blocks.getEffectiveNumber(e.toBlock||s.Tag.latest);let o;return o=a>r?i:a.toNumber(),{fromBlock:n,toBlock:a,toBlockNumber:o}}t.parseFilterDetails=parseFilterDetails,t.parseFilterRange=parseFilterRange,t.parseFilter=function parseFilter(e={address:[],topics:[]},t){const{addresses:r,topics:s}=parseFilterDetails(e),{fromBlock:n,toBlock:i,toBlockNumber:a}=parseFilterRange(e,t);return{addresses:r,fromBlock:n,toBlock:i,toBlockNumber:a,topics:s}}},830:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(0),n=r(5),i=r(1),bn=(e=0)=>new s.BN(e),a=bn(2300),check=e=>t=>e.has(t),o=check(new Set(["CALL","DELEGATECALL","STATICCALL","CALLCODE"])),c=check(new Set(["CALL","CALLCODE"])),l=check(new Set(["CREATE","CREATE2"])),u=check(new Set(["STOP","RETURN","REVERT","INVALID","SELFDESTRUCT"])),binSearch=async(e,t,r,n)=>{const i=t.block.header.gasLimit,a=r.execResult.gasRefund,o=a?r.gasEstimate.add(a):r.gasEstimate,c={lo:o,hi:o},isEnoughGas=async r=>{const n=e();t.tx.gasLimit=new s.BN(r.toArrayLike(Buffer)),await n.stateManager.checkpoint();const i=await n.runTx(t).catch((e=>({vmerr:e})));return await n.stateManager.revert(),!i.vmerr&&!i.execResult.exceptionError};if(!await isEnoughGas(c.hi)){do{c.hi=c.hi.muln(1.0158730158730158)}while(!await isEnoughGas(c.hi));for(;c.lo.addn(1).lt(c.hi);){const e=c.lo.add(c.hi).divn(2);await isEnoughGas(e)?c.hi=e:c.lo=e}if(c.hi.gte(i)&&!await isEnoughGas(c.hi))return n(new Error("gas required exceeds allowance or always failing transaction"))}r.gasEstimate=c.hi,n(null,r)},exactimate=async(e,t,r)=>{const s=(()=>{const e=[],t=[],r=new Set;let s=!1,n=0;return{collect:i=>{s&&(i.depth===n&&r.add(t.length-1),s=!1),o(i.opcode.name)?(i.stack=i.stack.map((e=>e.clone())),s=!0,n=i.depth,e.push({index:t.length,depth:i.depth,name:i.opcode.name})):(l(i.opcode.name)||u(i.opcode.name))&&e.push({index:t.length,depth:i.depth,name:i.opcode.name}),t.push(i)},isPrecompile:e=>r.has(e),done:()=>!t.length||e.length<2||!u(t[t.length-1].opcode.name),ops:t,systemOps:e}})();e.on("step",s.collect);const Context=(e,t)=>{const r=0===e;let n=e,i=0;const o=bn();let l=bn();const u=s.ops[e],h=s.ops[e+1],d=u.gasLeft.sub(h.gasLeft),p=t||bn();let m=!1;function addGas(e){l.gtn(0)&&(e.gte(l)?l=bn():l.isub(e)),o.iadd(e)}return{start:()=>n,stop:()=>i,setStart:e=>{n=e,m=!0},setStop:e=>{i=e},getCost:()=>({cost:o,sixtyFloorths:l}),transfer:e=>{const t=e.getCost();addGas(t.cost),l.iadd(t.sixtyFloorths)},addSixtyFloorth:e=>{l.iadd(e)},addRange:(e=bn())=>{addGas(s.ops[r||m?n:n+1].gasLeft.sub(s.ops[i].gasLeft).add(e))},finalizeRange:()=>{let e;if(m&&i!==s.ops.length-1){e=s.ops[n].gasLeft.sub(s.ops[i-1].gasLeft),addGas(e);e=s.ops[i-1].gasLeft.sub(s.ops[i].gasLeft).add(d)}else e=s.ops[n].gasLeft.sub(s.ops[i].gasLeft);if(e.isub(p),addGas(e),c(u.opcode.name)&&!u.stack[u.stack.length-3].isZero()){o.iadd(l);const e=h.gasLeft.sub(s.ops[i-1].gasLeft);e.gt(a)?l=o.divn(63):e.lte(a)&&(l=a.sub(e))}else i!==s.ops.length-1&&(o.iadd(l),l=o.divn(63))}}};await e.stateManager.checkpoint();const h=await e.runTx(t).catch((e=>({vmerr:e})));await e.stateManager.revert();const d=h.vmerr;if(d)return r(d);if(h.execResult.exceptionError){return r(new n.RuntimeError(i.Quantity.Empty,h,n.RETURN_TYPES.RETURN_VALUE),h)}if(s.done()){const e=h.gasUsed;h.gasEstimate=e}else{const e=s.ops[0].gasLeft.sub(s.ops[s.ops.length-1].gasLeft),t=(()=>{const e=s.systemOps,t=s.ops,opIndex=t=>e[t].index,r=[];let n=0,i=Context(0);for(;n<e.length;){const e=opIndex(n),c=t[e],h=c.opcode.name;if(o(h)||l(h))s.isPrecompile(e)?(i.setStop(e+1),i.addRange(),i.setStart(e+1),i.addSixtyFloorth(a)):(i.setStop(e),i.addRange(bn(c.opcode.fee)),r.push(i),i=Context(e,bn(c.opcode.fee)));else{if(!u(h))throw new Error("INVALID OPCODE");{i.setStop(e+1<s.ops.length?e+1:e),i.finalizeRange();const t=r.pop();if(!t)break;t.transfer(i),i=t,i.setStart(e+1)}}n++}const c=i.getCost();return c.cost.add(c.sixtyFloorths)})().sub(e);h.gasEstimate=h.gasUsed.add(t)}r(d,h)};t.default=(e,t,r)=>{exactimate(e(),t,((s,n)=>{if(s)return r(s);binSearch(e,t,n,((e,t)=>{if(e)return r(e);r(null,t)}))}))}},888:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.warmPrecompiles=t.activatePrecompiles=void 0;const r=Uint8Array.from([248,68,128,1,160,86,232,31,23,27,204,85,166,255,131,69,230,146,192,248,110,91,72,224,27,153,108,173,192,1,98,47,181,227,99,180,33,160,197,210,70,1,134,247,35,60,146,126,125,178,220,199,3,192,229,0,182,83,202,130,39,59,123,250,216,4,93,133,164,112]),s={serialize:()=>r},n=[],makeAccount=e=>{if(n[e])return n[e];const t=Buffer.allocUnsafe(20).fill(0,0,19);return t[19]=e,n[e]={buf:t}};t.activatePrecompiles=async e=>{await e.checkpoint();const t=e._cache;for(let r=1;r<=18;r++){const n=makeAccount(r);t.put(n,s),e.touchAccount(n)}await e.commit()};t.warmPrecompiles=async e=>{for(let t=1;t<=18;t++){const r=makeAccount(t);e.addWarmedAddress(r.buf)}}},387:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.applySimulationOverrides=t.runCall=void 0;const n=r(1),i=r(10),a=s(r(97)),o=r(0),c=s(r(7)),l=r(0);t.runCall=function runCall(e,t,r){const s={buf:t.from.toBuffer()},i=null==t.to?void 0:{buf:t.to.toBuffer()},l=new o.BN(null==t.value?0:t.value.toBuffer()),u={gasPrice:new o.BN(t.gasPrice.toBuffer()),origin:s},h=new a.default({caller:s,gasLimit:new o.BN(n.Quantity.toBuffer(r)),to:i,value:l,data:t.data&&t.data.toBuffer()});return new c.default(e,u,t.block).executeMessage(h)};const validateStorageOverride=(e,t,r)=>{if("string"==typeof e&&""!==e&&0===e.indexOf("0x")&&66!=e.length)throw new Error(`${r} override slot must be a 64 character hex string. Received ${e.length-2} character string.`);if(null==t)throw new Error(`${r} override data not valid. Received: ${t}`);if("string"==typeof t&&""!==t&&0===t.indexOf("0x")&&66!=t.length)throw new Error(`${r} override data must be a 64 character hex string. Received ${t.length-2} character string.`)};t.applySimulationOverrides=async function applySimulationOverrides(e,t,r){const s=t.stateManager;for(const t in r){if(!(0,n.hasOwn)(r,t))continue;const{balance:a,nonce:o,code:c,state:u,stateDiff:h}=r[t],d={buf:i.Address.from(t).toBuffer()};if(null!=o||null!=a||null!=c){const t=await s.getAccount(d);if(null!=o&&(t.nonce={toArrayLike:()=>""===o?n.BUFFER_EMPTY:n.Quantity.toBuffer(o)}),null!=a&&(t.balance={toArrayLike:()=>""===a?n.BUFFER_EMPTY:n.Quantity.toBuffer(a)}),null!=c){const r=n.Data.toBuffer(""===c?"0x":c),s=r.length>0?(0,n.keccak)(r):l.KECCAK256_NULL;t.codeHash=s,await e.db.put(s,r)}await s.putAccount(d,t)}if(u||h)if(u){if(h)throw new Error("both state and stateDiff overrides specified");let e=!1;for(const t in u){if(!(0,n.hasOwn)(u,t))continue;const r=u[t];validateStorageOverride(t,r,"State"),e||(await s.clearContractStorage(d),e=!0);const i=n.Data.toBuffer(t,32),a=n.Data.toBuffer(r);await s.putContractStorage(d,i,a)}}else for(const e in h){if(!(0,n.hasOwn)(h,e))continue;const t=h[e];validateStorageOverride(e,t,"StateDiff");const r=n.Data.toBuffer(e,32),i=n.Data.toBuffer(t);await s.putContractStorage(d,r,i)}}}},557:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GanacheTrie=void 0;const s=r(48);class GanacheTrie extends s.SecureTrie{constructor(e,t,r){super(e,t),this.blockchain=r}setContext(e,t,r){this.root=e}copy(e=!0){const t=this.db.copy(),r=new GanacheTrie(t._leveldb,this.root,this.blockchain);return e&&this.isCheckpoint&&(r.db.checkpoints=[...this.db.checkpoints]),r}}t.GanacheTrie=GanacheTrie},181:function(e,t,r){"use strict";var s,n,i,a,o,c,l,u,h,d,p,m,g,y,w,b,_,v,k,E,B,P,A=this&&this.__classPrivateFieldSet||function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r},T=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)},O=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Capacity=void 0;const S=r(5),R=r(1),N=r(15),D=r(48),F=O(r(27)),I=O(r(838)),C=r(36),M=r(466);var x;!function(e){e[e.FillBlock=-1]="FillBlock",e[e.Empty=0]="Empty",e[e.Single=1]="Single"}(x=t.Capacity||(t.Capacity={}));const updateBloom=(e,t)=>{let r=256;for(;--r;)e[r]|=t[r]},sortByPrice=(e,t,r)=>e[t].effectiveGasPrice>e[r].effectiveGasPrice,refresher=(e,t)=>e.updateEffectiveGasPrice(t);class Miner extends F.default{constructor(e,t,r,O){super(),s.set(this,0n),n.set(this,new Set),i.set(this,void 0),a.set(this,!1),o.set(this,!1),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),h.set(this,!1),d.set(this,void 0),p.set(this,void 0),m.set(this,void 0),g.set(this,void 0),y.set(this,new R.Heap(sortByPrice,refresher)),w.set(this,(async(e,t=x.FillBlock,r=!1)=>{const{block:s,transactions:n}=await T(this,b,"f").call(this,e,t,r);if(T(this,i,"f")&&(T(this,E,"f").call(this),A(this,i,!1,"f"),!r&&T(this,y,"f").length>0)){const e=T(this,g,"f").call(this,s);await T(this,w,"f").call(this,e,t)}return n})),b.set(this,(async(e,t,r)=>{let n;const i=T(this,m,"f"),{pending:o,inProgress:c}=T(this,d,"f"),u=T(this,p,"f");let h=!0;const w=T(this,y,"f"),b=new Map;let E;do{h=!1,A(this,a,!0,"f"),E=[];const d=new D.BaseTrie(null,null),p=new D.BaseTrie(null,null);if(t===x.Empty){await i.stateManager.checkpoint(),await i.stateManager.commit();const t=e.finalize(d.root,p.root,R.BUFFER_256_ZERO,i.stateManager._trie.root,0n,u.extraData,[],b);return this.emit("block",t),T(this,k,"f").call(this),{block:t.block,transactions:[]}}let m=0,y=u.blockGasLimit.toBigInt(),P=0n;const O=Buffer.allocUnsafe(256).fill(0),F=[];await i.stateManager.checkpoint();const M=(0,S.TraceDataFactory)(),stepListener=(e,t)=>{if("SSTORE"===e.opcode.name){const t=M.from(e.stack[e.stack.length-1].toArrayLike(Buffer)).toBuffer(),r=(0,R.keccak)(t);b.set(r.toString(),{key:t,hashedKey:r})}t()};let L;for(i.on("step",stepListener);L=w.peek();){const r=L.from.toString();if(L.calculateIntrinsicGas()>y){L.locked=!1,T(this,v,"f").call(this,r);continue}A(this,s,L.effectiveGasPrice.toBigInt(),"f"),await i.stateManager.checkpoint(),i.stateManager._trie.blockNumber=R.Quantity.from(e.header.number.toArrayLike(Buffer));const n=await T(this,_,"f").call(this,L,e,r,o);if(null!==n){const e=R.Quantity.from(n.gasUsed.toArrayLike(Buffer)).toBigInt();if(y>=e){await i.stateManager.commit(),E[m]=L,y-=e,P+=e;const s=(0,N.encode)(0===m?R.BUFFER_EMPTY:(0,R.uintToBuffer)(m));F.push(d.put(s,L.serialized));const a=L.fillFromResult(n,P);F.push(p.put(s,a)),updateBloom(O,n.bloom.bitvector),m++;const l=o.get(r);c.add(L),L.once("finalized").then((()=>{c.delete(L)}));if(h=l.removeBest()?(0,I.default)(w,l):T(this,v,"f").call(this,r),y<=C.Params.TRANSACTION_GAS||m===t)break}else await i.stateManager.revert(),L.locked=!1,h=w.removeBest()}else await i.stateManager.revert()}await Promise.all(F),await i.stateManager.commit(),i.removeListener("step",stepListener);const j=e.finalize(d.root,p.root,O,i.stateManager._trie.root,P,u.extraData,E,b);if(n=j.block,this.emit("block",j),r){A(this,s,0n,"f"),T(this,k,"f").call(this);break}A(this,s,0n,"f"),T(this,B,"f").call(this),0!==w.length?(e=T(this,g,"f").call(this,n),void 0!==T(this,l,"f")&&w.refresh(T(this,l,"f"))):T(this,k,"f").call(this)}while(h);return{block:n,transactions:E}})),_.set(this,(async(e,t,r,s)=>{const n={},i=T(this,m,"f");this.emit("ganache:vm:tx:before",{context:n});const stepListener=e=>{T(this,h,"f")&&this.emit("ganache:vm:tx:step",(0,M.makeStepEvent)(n,e))};i.on("step",stepListener);try{return await i.runTx({tx:e.toVmTransaction(),block:t})}catch(t){const n=t.message,i=s.get(r);i.removeBest()?(0,I.default)(T(this,y,"f"),i):T(this,v,"f").call(this,r);const a={execResult:{runState:{programCounter:0},exceptionError:{error:n},returnValue:R.BUFFER_EMPTY}},o=new S.RuntimeError(e.hash,a,S.RETURN_TYPES.TRANSACTION_HASH);return e.finalize("rejected",o),null}finally{i.removeListener("step",stepListener),this.emit("ganache:vm:tx:after",{context:n})}})),v.set(this,(e=>(T(this,n,"f").delete(e),T(this,y,"f").removeBest()))),k.set(this,(()=>{T(this,n,"f").clear();const e=T(this,y,"f"),t=e.length,r=e.array;for(let e=0;e<t;e++){r[e].locked=!1}e.clear(),A(this,a,!1,"f")})),E.set(this,(()=>{const{pending:e}=T(this,d,"f"),t=T(this,n,"f"),r=T(this,y,"f");for(let s of e){const e=s[1].peek();if(e&&!e.locked){const s=e.from.toString();t.add(s),e.updateEffectiveGasPrice(T(this,l,"f")),r.push(e),e.locked=!0}}})),B.set(this,(()=>{const{pending:e}=T(this,d,"f"),t=T(this,n,"f"),r=T(this,y,"f");for(let n of e){const e=n[1].peek();if(e&&!e.locked){const n=e.effectiveGasPrice.toBigInt();if(T(this,s,"f")>n)continue;const i=e.from.toString();if(t.has(i))continue;t.add(i),e.updateEffectiveGasPrice(T(this,l,"f")),r.push(e),e.locked=!0}}})),P.set(this,(e=>{const t=e.header.baseFeePerGas;A(this,l,void 0===t?void 0:R.Quantity.from(t.buf),"f")})),A(this,m,r,"f"),A(this,p,e,"f"),A(this,d,t,"f"),A(this,g,(e=>{const t=O(e);return T(this,P,"f").call(this,t),t}),"f"),T(this,y,"f").init([])}async pause(){T(this,o,"f")||(A(this,o,!0,"f"),A(this,c,new Promise((e=>{A(this,u,e,"f")})),"f")),T(this,a,"f")&&await this.once("idle")}resume(){T(this,o,"f")&&(A(this,o,!1,"f"),T(this,u,"f").call(this))}async mine(e,t=x.FillBlock,r=!1){if(T(this,o,"f")&&await T(this,c,"f"),T(this,a,"f"))return A(this,i,!0,"f"),void T(this,B,"f").call(this);{T(this,P,"f").call(this,e),T(this,E,"f").call(this);const s=await T(this,w,"f").call(this,e,t,r);return this.emit("idle"),s}}toggleStepEvent(e){A(this,h,e,"f")}}t.default=Miner,s=new WeakMap,n=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,h=new WeakMap,d=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,b=new WeakMap,_=new WeakMap,v=new WeakMap,k=new WeakMap,E=new WeakMap,B=new WeakMap,P=new WeakMap},838:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function replaceFromHeap(e,t){const r=t.peek();return r?(e.replaceBest(r),r.locked=!0,!0):e.removeBest()}},466:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeStepEvent=void 0;const s=r(1);function normalizeEvent(e){const{account:t,memory:r,opcode:n}=e,i=r.length,a=Buffer.allocUnsafe(104+i);t.stateRoot.copy(a,0,0,32),t.codeHash.copy(a,32,0,32),e.address.buf.copy(a,64,0,20),e.codeAddress.buf.copy(a,84,0,20);const o=a.slice(0,32),c=a.slice(32,64),l=a.slice(64,84),u=a.slice(84,104);let h;return 0!==i?(r.copy(a,104,0,i),h=a.slice(104,104+i)):h=s.BUFFER_ZERO,{account:{nonce:s.Quantity.from(t.nonce.toArrayLike(Buffer)).toBigInt(),balance:s.Quantity.from(t.balance.toArrayLike(Buffer)).toBigInt(),stateRoot:o,codeHash:c},address:l,codeAddress:u,depth:BigInt(e.depth),gasLeft:s.Quantity.from(e.gasLeft.toArrayLike(Buffer)).toBigInt(),gasRefund:s.Quantity.from(e.gasRefund.toArrayLike(Buffer)).toBigInt(),memory:h,memoryWordCount:s.Quantity.from(e.memoryWordCount.toArrayLike(Buffer)).toBigInt(),opcode:{name:n.name,fee:n.fee},pc:BigInt(e.pc),returnStack:e.returnStack.map((e=>e.toArrayLike(Buffer))),stack:e.stack.map((e=>e.toArrayLike(Buffer)))}}t.makeStepEvent=function makeStepEvent(e,t){return{context:e,data:normalizeEvent(t)}}},314:function(e,t,r){"use strict";var s,n,i,a,o,c,l,u,h,d=this&&this.__classPrivateFieldSet||function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r},p=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)},m=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EthereumProvider=void 0;const g=m(r(27)),y=m(r(298)),w=r(1),b=r(184),_=m(r(308)),v=m(r(177)),k=m(r(294)),E=r(322),B=r(10);class EthereumProvider extends g.default{constructor(e={},t){super(),s.set(this,void 0),n.set(this,void 0),i.set(this,void 0),a.set(this,void 0),o.set(this,void 0),this.removeListener=this.off,c.set(this,((e,t)=>{let r,s,n;if("string"==typeof e)r=e,s=t,n=this.request({method:r,params:s});else{if("function"!=typeof t)throw new Error("No callback provided to provider's send function. As of web3 1.0, provider.send is no longer synchronous and must be passed a callback as its final argument.");if(Array.isArray(e)){const r=t;p(this,u,"f").call(this,e).then((({error:e,result:t})=>{r(e,t)}))}else{const r=t;p(this,h,"f").call(this,e).then((({error:e,result:t})=>{r(e,t)}))}}return n})),l.set(this,((e,t)=>{const r=p(this,s,"f");r.logging.verbose?r.logging.logger.log(`   >  ${e}: ${null==t?t:JSON.stringify(t,null,2).split("\n").join("\n   > ")}`):r.logging.logger.log(e)})),this.disconnect=async()=>{await p(this,o,"f").stop(),this.emit("disconnect")},u.set(this,(e=>Promise.all(e.map(p(this,h,"f"))).then((e=>{let t=null;const r=[];return e.forEach((({error:e,result:s},n)=>{r.push(s),e&&(null==t&&(t=new Error("Batch error:")),t.errors[n]=e)})),{error:t,result:r}})))),h.set(this,(async e=>{const t=e.method,r=e.params;try{const s=await this.request({method:t,params:r});return{error:null,result:(0,w.makeResponse)(e.id,JSON.parse(JSON.stringify(s)))}}catch(t){let r;return(0,w.hasOwn)(t,"result")&&(r=t.result,delete t.result),{error:t,result:(0,w.makeError)(e.id,t,r)}}})),d(this,i,t,"f");const r=d(this,s,b.EthereumOptionsConfig.normalize(e),"f"),m=d(this,a,new v.default(r.wallet),"f"),_=m.initialAccounts,P=r.fork.url||r.fork.provider||r.fork.network?new E.Fork(r,_):null,A=function parseCoinbase(e,t){switch(typeof e){case"object":return e;case"number":const r=t[e];if(r)return r.address;throw new Error(`invalid coinbase address index: ${e}`);case"string":return B.Address.from(e);default:throw new Error(`coinbase address must be string or number, received: ${e}`)}}(r.miner.coinbase,_),T=new k.default(r,A,P);d(this,o,T,"f"),T.on("ganache:vm:tx:before",(e=>{this.emit("ganache:vm:tx:before",e)})),T.on("ganache:vm:tx:step",(e=>{this.emit("ganache:vm:tx:step",e)})),T.on("ganache:vm:tx:after",(e=>{this.emit("ganache:vm:tx:after",e)})),function hookEventSystem(e,t){let r=0;e.on(g.default.listenerAdded,(({eventName:e})=>{"ganache:vm:tx:step"!==e&&void 0!==e||(0===r&&t(!0),r++)})),e.on(g.default.listenerRemoved,(({eventName:e})=>{"ganache:vm:tx:step"!==e&&void 0!==e||(r--,0===r&&t(!1))}))}(this,(e=>{T.toggleStepEvent(e)})),d(this,n,new y.default(r,m,T),"f")}async initialize(){await p(this,o,"f").initialize(p(this,a,"f").initialAccounts),this.emit("connect")}getOptions(){return(0,_.default)(p(this,s,"f"))}getInitialAccounts(){const e={},t=p(this,a,"f"),r=p(this,a,"f").unlockedAccounts;return t.initialAccounts.forEach((t=>{const s=t.address.toString();e[s]={secretKey:t.privateKey.toString(),balance:t.balance.toBigInt(),unlocked:r.has(s)}})),e}send(e,t){return p(this,c,"f").call(this,e,t)}sendAsync(e,t){p(this,c,"f").call(this,e,t)}async request(e){const t=await this._requestRaw(e),r=await t.value;return JSON.parse(JSON.stringify(r))}async _requestRaw({method:e,params:t}){p(this,l,"f").call(this,e,t);const r=(await p(this,i,"f").execute(p(this,n,"f"),e,t)).value;r instanceof w.PromiEvent&&r.on("message",(e=>{const t=JSON.parse(JSON.stringify(e));this.emit("message",t),this.emit("data",{jsonrpc:"2.0",method:"eth_subscription",params:t.data})}));return{value:r.catch((e=>{throw p(this,s,"f").chain.vmErrorsOnRPCResponse&&(0,w.hasOwn)(e,"result")&&(e.result=JSON.parse(JSON.stringify(e.result))),e}))}}}t.EthereumProvider=EthereumProvider,s=new WeakMap,n=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,h=new WeakMap},311:function(e,t,r){"use strict";var s,n,i,a,o,c=this&&this.__classPrivateFieldSet||function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r},l=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TriageOption=void 0;const h=u(r(27)),d=r(1),p=r(1),m=r(5);function shouldReplace(e,t,r,s){if(e.nonce.toBigInt()!==t)return!1;if(e.locked)throw new m.CodedError(m.TRANSACTION_LOCKED,p.JsonRpcErrorCode.TRANSACTION_REJECTED);const n="maxPriorityFeePerGas"in r?r.maxPriorityFeePerGas.toBigInt():r.effectiveGasPrice.toBigInt(),i="maxFeePerGas"in r?r.maxFeePerGas.toBigInt():r.effectiveGasPrice.toBigInt(),a="maxPriorityFeePerGas"in e?e.maxPriorityFeePerGas.toBigInt():e.effectiveGasPrice.toBigInt(),o="maxFeePerGas"in e?e.maxFeePerGas.toBigInt():e.effectiveGasPrice.toBigInt();if(n<a+a*s/100n||i<o+o*s/100n)throw new m.CodedError(m.UNDERPRICED,p.JsonRpcErrorCode.TRANSACTION_REJECTED);return!0}function byNonce(e,t,r){return(e[r].nonce.toBigInt()||0n)>(e[t].nonce.toBigInt()||0n)}var g;!function(e){e[e.FutureQueue=0]="FutureQueue",e[e.Executable=1]="Executable",e[e.ReplacesPendingExecutable=2]="ReplacesPendingExecutable",e[e.ReplacesFutureTransaction=3]="ReplacesFutureTransaction"}(g=t.TriageOption||(t.TriageOption={}));class TransactionPool extends h.default{constructor(e,t,r=new Map){super(),s.set(this,void 0),n.set(this,void 0),i.set(this,void 0),this.executables={inProgress:new Set,pending:new Map},a.set(this,new Map),this.drain=()=>{this.emit("drain")},o.set(this,(e=>{if(e.gas>l(this,s,"f").blockGasLimit)return new m.CodedError(m.GAS_LIMIT,p.JsonRpcErrorCode.INVALID_INPUT);const t=e.calculateIntrinsicGas();return-1n===t||e.gas.toBigInt()<t?new m.CodedError(m.INTRINSIC_GAS_TOO_LOW,p.JsonRpcErrorCode.INVALID_INPUT):null})),c(this,i,t,"f"),c(this,s,e,"f"),this.origins=r,c(this,n,e.priceBump,"f")}async prepareTransaction(e,t){let r;if(r=l(this,o,"f").call(this,e),null!=r)throw r;const s=e.from;let c;e.nonce.isNull()||(c=e.nonce.toBigInt());const u=s.toString();let h=l(this,a,"f").get(u);if(h&&await h,!e.effectiveGasPrice&&l(this,i,"f").common.isActivatedEIP(1559)){const t=l(this,i,"f").blocks.latest.header.baseFeePerGas;e.updateEffectiveGasPrice(t)}let y=0n;h||(h=l(this,i,"f").accounts.getNonceAndBalance(s),l(this,a,"f").set(u,h),h.then((()=>{l(this,a,"f").delete(u)})));const w=await h,b=e.gas.toBigInt()*e.maxGasPrice().toBigInt()+e.value.toBigInt();if(w.balance.toBigInt()<b)throw new m.CodedError(m.INSUFFICIENT_FUNDS,p.JsonRpcErrorCode.TRANSACTION_REJECTED);const _=this.origins,v=_.get(u);let k=g.FutureQueue;const E=this.executables.pending;let B=E.get(u);const P=l(this,n,"f");let A;if(B&&(A=B.length)){const t=B.array;for(let r=0;r<A;r++){const s=t[r];if(shouldReplace(s,c,e,P)){t[r]=e,k=g.ReplacesPendingExecutable,s.finalize("rejected",new m.CodedError(m.REPLACED,p.JsonRpcErrorCode.TRANSACTION_REJECTED));break}const n=s.nonce.toBigInt();n>y&&(y=n)}void 0===c?(c=y+1n,e.nonce=p.Quantity.from(c),k=g.Executable):c===y+1n&&(k=g.Executable)}else{const t=w.nonce.toBigInt();if(void 0===c)c=t||0n,e.nonce=p.Quantity.from(c),k=g.Executable;else{if(c<t)throw new m.CodedError(`the tx doesn't have the correct nonce. account has nonce of: ${t} tx has nonce of: ${c}`,p.JsonRpcErrorCode.INVALID_INPUT);c===t&&(k=g.Executable)}}if(v&&k!==g.Executable&&k!==g.ReplacesPendingExecutable&&(A=v.length)){const t=v.array;for(let r=0;r<A;r++){const s=t[r];if(shouldReplace(s,c,e,P)){t[r]=e,k=g.ReplacesFutureTransaction,s.finalize("rejected",new m.CodedError(m.REPLACED,p.JsonRpcErrorCode.TRANSACTION_REJECTED));break}}}switch(t&&e.signAndHash(t.toBuffer()),k){case g.Executable:if(B?B.push(e):(B=d.Heap.from(e,byNonce),E.set(u,B)),v){let e=c+1n;for(;;){const t=v.peek();if((t.nonce.toBigInt()||0n)!==e)break;if(B.push(t),!v.removeBest()){_.delete(u);break}e+=1n}}return!0;case g.FutureQueue:return v?v.push(e):_.set(u,d.Heap.from(e,byNonce)),!1;case g.ReplacesPendingExecutable:return!0;case g.ReplacesFutureTransaction:return!1}}clear(){this.origins.clear(),l(this,a,"f").clear(),this.executables.pending.clear()}find(e){const{pending:t,inProgress:r}=this.executables;for(let[t,r]of this.origins){if(void 0===r)continue;const t=r.array;for(let s=0;s<r.length;s++){const r=t[s];if(r.hash.toBuffer().equals(e))return r}}for(let[r,s]of t){const t=s.array;for(let r=0;r<s.length;r++){const s=t[r];if(s.hash.toBuffer().equals(e))return s}}for(let t of r)if(t.hash.toBuffer().equals(e))return t;return null}}t.default=TransactionPool,s=new WeakMap,n=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap},177:function(e,t,r){"use strict";var s,n,i,a,o,c,l,u=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),h=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),d=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&u(t,e,r);return h(t,e),t},p=this&&this.__classPrivateFieldSet||function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r},m=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)},g=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const y=r(5),w=r(359),b=r(1),_=r(0),v=d(r(63)),k=r(440),E=r(83),B=g(r(14)),P=g(r(118)),A=r(13),T=r(10),O=Buffer.allocUnsafe(12).fill(255),S={dklen:32,n:1024,p:8,r:1},R="aes-128-ctr",scrypt=(...e)=>new Promise(((t,r)=>{B.default.scrypt.call(B.default,...e,((e,s)=>{if(!e)return t(s);r(e)}))})),N=Buffer.allocUnsafe(65),uncompressedPublicKeyToAddress=e=>{switch(v.default.publicKeyConvert(N,e)){case 0:return T.Address.from((0,b.keccak)(N.slice(1)).slice(-20));case 1:throw new Error("Public Key could not be parsed");case 2:throw new Error("Public Key serialization error")}},asUUID=e=>`${e.toString("hex",0,4)}-${e.toString("hex",4,6)}-${e.toString("hex",6,8)}-${e.toString("hex",8,10)}-${e.toString("hex",10)}`;class Wallet{constructor(e){this.knownAccounts=new Set,this.keyFiles=new Map,this.unlockedAccounts=new Map,this.lockTimers=new Map,s.set(this,void 0),n.set(this,(e=>{const t=Buffer.allocUnsafe(e),r=m(this,s,"f");for(let s=0;s<e;s++)t[s]=256*r()|0;return t})),i.set(this,(e=>{const t=(0,w.createAccountGeneratorFromSeedAndPath)((0,k.mnemonicToSeedSync)(e.mnemonic,null),e.hdPath),r=e.defaultBalance.toString().split(".",2),s=BigInt(r[0]),n=r[1]||"0",i=BigInt(n),c=10n**BigInt(n.length),l=b.WEI*s+i*(b.WEI/c),u=b.Quantity.from(l),h=new Map,d=e.accounts;let p;if(d&&0!==(p=d.length))for(let r=0;r<p;r++){const s=d[r],n=s.secretKey;let i;if(n){const t=b.Quantity.from(s.balance);i=m(this,a,"f").call(this,t,n,e)}else{const s=t(r);i=m(this,o,"f").call(this,u,s,e)}h.set(i.address.toString(),i)}else{const r=e.totalAccounts;if(null!=r)for(let s=0;s<r;s++){const r=t(s),n=m(this,o,"f").call(this,u,r,e);h.set(n.address.toString(),n)}}return h})),a.set(this,((e,t,r)=>{const s=b.Data.from(t),n=Wallet.createAccountFromPrivateKey(s);n.balance=e;const i=n.address;return m(this,c,"f").call(this,i,s,r),n})),o.set(this,((e,t,r)=>{const s=uncompressedPublicKeyToAddress(t.publicKey),n=b.Data.from(t.privateKey),i=Wallet.createAccount(e,n,s);return m(this,c,"f").call(this,s,n,r),i})),c.set(this,((e,t,r)=>{const{passphrase:s,lock:n}=r,i=this.knownAccounts;this.addToKeyFileSync(e,t,s,n);const a=e.toString();i.add(a),n||this.unlockedAccounts.set(a,t)})),l.set(this,(e=>(this.lockTimers.delete(e),this.unlockedAccounts.delete(e),!0))),p(this,s,(0,E.alea)("ganache "+e.mnemonic),"f");const t=m(this,i,"f").call(this,e);this.initialAccounts=Array.from(t.values()),this.addresses=Array.from(t.keys());const r=this.initialAccounts.length,u=this.unlockedAccounts,h=e.unlockedAccounts;if(h){const e=h.length;for(let s=0;s<e;s++){let e,n,i=h[s];switch(typeof i){case"string":const s=i.toLowerCase();if(0===s.indexOf("0x")){e=s;const r=t.get(e);r?n=r.privateKey:(n=this.createFakePrivateKey(e),this.addresses.push(e));break}{const e=i-0;if(!Number.isSafeInteger(e))throw new Error(`Invalid value in wallet.unlockedAccounts: ${i}`);i=e}case"number":const a=this.initialAccounts[i];if(null==a)throw new Error(`Account at index ${i} not found. Max index available is ${r-1}.`);e=a.address.toString().toLowerCase(),n=a.privateKey;break;default:throw new Error("Invalid value specified in unlocked_accounts")}u.has(e)||u.set(e,n)}}if(null!=e.accountKeysPath){const t={addresses:{},private_keys:{}};u.forEach(((e,r)=>{t.addresses[r]=r,t.private_keys[r]=e})),(0,A.writeFileSync)(e.accountKeysPath,JSON.stringify(t))}}async encrypt(e,t){const r=m(this,n,"f").call(this,64),s=r.slice(0,32),i=r.slice(32,48),a=r.slice(48),o=await scrypt(t,s,S.dklen,{...S,N:S.n});return this.finishEncryption(o,e,s,i,a)}encryptSync(e,t){const r=m(this,n,"f").call(this,64),s=r.slice(0,32),i=r.slice(32,48),a=r.slice(48),o=((...e)=>B.default.scryptSync.call(B.default,...e))(t,s,S.dklen,{...S,N:S.n});return this.finishEncryption(o,e,s,i,a)}finishEncryption(e,t,r,s,n){const i=B.default.createCipheriv(R,e.slice(0,16),s),a=Buffer.concat([i.update(t.toBuffer()),i.final()]),o=(0,P.default)("keccak256").update(Buffer.concat([e.slice(16,32),a])).digest();return{crypto:{cipher:R,ciphertext:b.Data.from(a),cipherparams:{iv:b.Data.from(s)},kdf:"scrypt",kdfParams:{...S,salt:b.Data.from(r)},mac:b.Data.from(o)},id:asUUID(n),version:3}}async decrypt(e,t){const r=e.crypto;if(r.cipher!==R)throw new Error(`keyfile cypher must be "${R}"`);if("scrypt"!==r.kdf)throw new Error('keyfile kdf must be "script"');const s=r.kdfParams,n=s.salt,i=r.mac,a=r.ciphertext.toBuffer();let o,c;if(null!=t)try{o=await scrypt(t,n.toBuffer(),s.dklen,{...s,N:s.n}),c=(0,P.default)("keccak256").update(Buffer.concat([o.slice(16,32),a])).digest()}catch{c=null}if(!c||!i.toBuffer().equals(c))throw new Error("could not decrypt key with given passphrase");return B.default.createDecipheriv(r.cipher,o.slice(0,16),r.cipherparams.iv.toBuffer()).update(a)}async addToKeyFile(e,t,r,s){r||s?this.keyFiles.set(e.toString(),{encrypted:!0,key:await this.encrypt(t,r)}):this.keyFiles.set(e.toString(),{encrypted:!1,key:t.toBuffer()})}addToKeyFileSync(e,t,r,s){r||s?this.keyFiles.set(e.toString(),{encrypted:!0,key:this.encryptSync(t,r)}):this.keyFiles.set(e.toString(),{encrypted:!1,key:t.toBuffer()})}async getFromKeyFile(e,t){const r=this.keyFiles.get(e.toString());if(null==r)throw new Error("no key for given address or file");if(!0===r.encrypted)return this.decrypt(r.key,t);if(t)throw new Error('could not decrypt key with given passphrase (default passphrase for accounts created at startup is "")');return r.key}static createAccount(e,t,r){const s=new y.Account(r);return s.privateKey=t,s.balance=e,s}static createAccountFromPrivateKey(e){const t=T.Address.from((0,_.privateToAddress)(e.toBuffer())),r=new y.Account(t);return r.privateKey=e,r}createRandomAccount(){const e=m(this,n,"f").call(this,128),t=(0,w.createAccountFromSeed)(e),r=uncompressedPublicKeyToAddress(t.publicKey),s=b.Data.from(t.privateKey);return Wallet.createAccount(b.Quantity.Zero,s,r)}async unlockAccount(e,t,r){const s=e.toString(),n=await this.getFromKeyFile(e,t),i=this.lockTimers.get(s);i&&clearTimeout(i);const a=1e3*r|0;if(a>0){const e=setTimeout(m(this,l,"f"),a,s);(0,b.unref)(e),this.lockTimers.set(s,e)}return this.unlockedAccounts.set(s,b.Data.from(n)),!0}async addUnknownAccount(e,t){const r=e.toString();if(this.knownAccounts.has(r))return!1;const s=this.createFakePrivateKey(r);return await this.addToKeyFile(e,s,t,!0),this.knownAccounts.add(r),this.addresses.push(r),!0}async removeKnownAccount(e,t){const r=e.toString();if(!this.knownAccounts.has(r))return!1;if(null!=await this.getFromKeyFile(e,t))return this.keyFiles.delete(r),this.knownAccounts.delete(r),this.addresses.splice(this.addresses.indexOf(r),1),this.lockTimers.delete(r),this.unlockedAccounts.delete(r),!0;throw new Error("could not find private key for address/passphrase combination")}createFakePrivateKey(e){let t;const r=T.Address.from(e).toBuffer();if(r.equals(b.ACCOUNT_ZERO))t=Buffer.allocUnsafe(32).fill(0,0,31),t[31]=1;else{const e=r.slice(0,12);if(t=Buffer.concat([r,e]),0===e.compare(O))for(;BigInt(`0x${t.toString("hex")}`)>=v.SECP256K1_N;)t=(0,b.keccak)(t)}return b.Data.from(t)}lockAccount(e){return!!this.unlockedAccounts.has(e)&&(clearTimeout(this.lockTimers.get(e)),m(this,l,"f").call(this,e))}}t.default=Wallet,s=new WeakMap,n=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap},184:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(295),t)},708:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChainOptions=void 0;const s=r(50);t.ChainOptions={allowUnlimitedContractSize:{normalize:s.normalize,cliDescription:"Allows unlimited contract sizes while debugging. Setting this to `true` will cause ganache to behave differently than production environments.",default:()=>!1,legacyName:"allowUnlimitedContractSize",cliType:"boolean"},asyncRequestProcessing:{normalize:s.normalize,cliDescription:"When set to `false` only one request will be processed at a time.",default:()=>!0,legacyName:"asyncRequestProcessing",cliType:"boolean"},chainId:{normalize:s.normalize,cliDescription:"The currently configured chain id.",default:()=>1337,legacyName:"chainId",cliType:"number"},networkId:{normalize:s.normalize,cliDescription:"The id of the network returned by the RPC method `net_version`.",default:()=>Date.now(),defaultDescription:"System time at process start or Network ID of forked blockchain if configured.",legacyName:"network_id",cliAliases:["i","networkId"],cliType:"number"},time:{normalize:e=>void 0!==e?new Date(e):null,cliDescription:"Date that the first block should start.",legacyName:"time",cliAliases:["t","time"],cliType:"string",cliCoerce:e=>{const t=e/1;return isNaN(t)?e:t}},hardfork:{normalize:s.normalize,cliDescription:"Set the hardfork rules for the EVM.",default:()=>"london",legacyName:"hardfork",cliAliases:["k","hardfork"],cliType:"string",cliChoices:["constantinople","byzantium","petersburg","istanbul","muirGlacier","berlin","london","arrowGlacier"]},vmErrorsOnRPCResponse:{normalize:s.normalize,cliDescription:"Whether to report runtime errors from EVM code as RPC errors.",default:()=>!1,legacyName:"vmErrorsOnRPCResponse",cliType:"boolean"}}},709:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseOptions=void 0;const s=r(50);t.DatabaseOptions={db:{normalize:s.normalize,cliDescription:"Specify an alternative database instance, like MemDOWN",disableInCLI:!0,legacyName:"db",conflicts:["dbPath"]},dbPath:{normalize:s.normalize,cliDescription:"Specify a path to a directory to save the chain database.",legacyName:"db_path",cliAliases:["db","db_path"],cliType:"string",conflicts:["db"]}}},324:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ForkOptions=t.KNOWN_NETWORKS=void 0;const s=r(50),n=r(5),i=r(88),a=Math.floor(Number.MAX_SAFE_INTEGER/2);t.KNOWN_NETWORKS=["mainnet","ropsten","kovan","rinkeby","goerli","g\xf6rli"];const o=/:\s?(?:.+)/;function coerceHeaders(e,t){const[r,s]=t.split(o);return e.push({name:r,value:s}),e}const c=["ws:","wss:","http:","https:"];t.ForkOptions={url:{normalize:e=>{if("string"!=typeof e||t.KNOWN_NETWORKS.includes(e))return;let r=new i.URL(e);const s=r.pathname+r.search,o=s.lastIndexOf("@");if(-1!==o){r=new i.URL(s.substr(0,o),r);const e=s.substr(o+1);if(e&&e!==n.Tag.latest){const t=e-0;isNaN(t)||t<0||(0|t)!==t||t>a?console.warn(`Ignoring invalid block number in fork url: "${e}". Block number must be an integer from [0 - ${a}].`):r._blockNumber=t}if(!c.includes(r.protocol))throw new Error(`Invalid protocol for fork url: ${r.protocol}. Supported protocols are: ${((e,t="and")=>{const r=e.pop();switch(e.length){case 0:return"";case 1:return r;case 2:return e[0]+` ${t} `+r;default:return e.join(", ")+`, ${t} `+r}})(c)}.`)}return r},cliDescription:'Fork from another currently running Ethereum client at a given block. Input should be the URL of the node, e.g. `"http://localhost:1337"`. You can optionally specify the block to fork from using an @ sign: `"http://localhost:1337@8675309"`.\n\nYou can specify Basic Authentication credentials in the URL as well. e.g., `"wss://user:password@example.com/"`. If you need to use an Infura Project Secret, you would use it like this: `"wss://:{YOUR-PROJECT-SECRET}@mainnet.infura.com/..."`\n\nAlternatively, you can use the `fork.username` and `fork.password` options.',legacyName:"fork",cliAliases:["f","fork"],conflicts:["provider","network"]},provider:{normalize:e=>"string"==typeof e||"object"==typeof e&&("string"==typeof e.url||"boolean"==typeof e.url||"string"==typeof e.network||"boolean"==typeof e.network)?void 0:e,cliDescription:"Specify an EIP-1193 provider to use instead of a url.",disableInCLI:!0,legacyName:"fork",conflicts:["url","network"]},network:{normalize:e=>{if("string"==typeof e&&t.KNOWN_NETWORKS.includes(e))return e;if("object"==typeof e&&"url"in e){const{url:r}=e;if(!0===r)return"mainnet";if(t.KNOWN_NETWORKS.includes(r))return e.url}},cliDescription:"A network name to fork from; uses Infura's archive nodes.\n\nUse the shorthand command `ganache --fork` to automatically fork from Mainnet at the latest block.\n",cliChoices:t.KNOWN_NETWORKS,legacyName:"fork",conflicts:["url","provider"]},blockNumber:{normalize:s.normalize,cliDescription:"Block number the provider should fork from.",legacyName:"fork_block_number",default:({url:e,provider:t,network:r})=>e?e._blockNumber?e._blockNumber:n.Tag.latest:t||r?n.Tag.latest:void 0,defaultDescription:"Latest block number"},preLatestConfirmations:{normalize:s.normalize,cliDescription:'When the `fork.blockNumber` is set to "latest" (default), the number of blocks before the remote node\'s "latest" block to fork from.',default:()=>5,defaultDescription:"5",cliType:"number"},username:{normalize:s.normalize,cliDescription:'* Username to use for Basic Authentication. Does not require setting `fork.password`.\n    \nWhen combined with `fork.password`, is shorthand for `fork: { headers: { "Authorization": "Basic {ENCODED-BASIC-HEADER}" } }`\n\nIf the `fork.headers` option specifies an "Authorization" header, it will be be inserted _after_ this Basic token.',default:({url:e})=>{if(e&&e.username)return e.username},defaultDescription:""},password:{normalize:s.normalize,cliDescription:'Password to use for Basic Authentication. Does not require setting `fork.username`.\n\nWhen combined with `fork.username`, is shorthand for `fork: { headers: { "Authorization": "Basic {ENCODED-BASIC-HEADER}" } }`\n\nIf the `fork.headers` option specifies an "Authorization" header, it will be be inserted _after_ this Basic token.',default:({url:e})=>{if(e&&e.password)return e.password},defaultDescription:""},jwt:{normalize:s.normalize,cliDescription:'_Encoded_ JSON Web Token (JWT) used for authenticating to some servers.\n\nShorthand for `fork: { headers: { "Authorization": "Bearer {YOUR-ENCODED-JWT}" } }`\n\n If the `fork.headers` option specifies an "Authorization" header, it will be be inserted _after_ the JWT Bearer token.'},userAgent:{normalize:s.normalize,cliDescription:'The User-Agent header sent to the fork on each request.\n\nSent as Api-User-Agent when used in the browser.\n \nWill be overridden by a `"User-Agent"` defined in the `fork.headers` option, if provided.',default:()=>"Ganache/7.3.2 (https://www.trufflesuite.com/ganache; ganache<at>trufflesuite.com)"},origin:{normalize:s.normalize,cliDescription:'The Origin header sent to the fork on each request.\n\nIgnored in the browser.\n\nWill be overridden by an `"Origin"` value defined in the `fork.headers` option, if provided.'},headers:{normalize:s.normalize,cliDescription:'Headers to supply on each request to the forked provider.\n\nHeaders set here override headers set by other options, unless otherwise specified.\n\nDefaults to: `["User-Agent: Ganache/VERSION (https://www.trufflesuite.com/ganache; ganache<at>trufflesuite.com)"]`',cliType:"array:string",implies:["url"],cliCoerce:e=>e.reduce(coerceHeaders,[])},requestsPerSecond:{normalize(e){if(e<0)throw new Error(`fork.requestsPerSecond is invalid: "${e}"; must be a positive number`);return e},default:()=>0,cliDescription:"Restrict the number of requests per second sent to the fork provider. `0` means no limit is applied.",cliType:"number"},disableCache:{normalize:s.normalize,default:()=>!1,cliDescription:"Disables caching of all forking requests.",cliType:"boolean"},deleteCache:{normalize:s.normalize,default:()=>!1,cliDescription:"Deletes the persistent cache before starting.",cliType:"boolean"}}},50:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.normalize=void 0;t.normalize=e=>e},295:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.EthereumOptionsConfig=t.EthereumDefaults=void 0;const i=r(708),a=r(709),o=r(710),c=r(711),l=r(339),u=r(324),h=r(45);t.EthereumDefaults={chain:i.ChainOptions,database:a.DatabaseOptions,logging:o.LoggingOptions,miner:c.MinerOptions,wallet:l.WalletOptions,fork:u.ForkOptions},t.EthereumOptionsConfig=new h.OptionsConfig(t.EthereumDefaults),n(r(708),t),n(r(709),t),n(r(50),t),n(r(710),t),n(r(711),t),n(r(339),t),n(r(324),t)},710:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggingOptions=void 0;const s=r(50);t.LoggingOptions={debug:{normalize:s.normalize,cliDescription:"Set to `true` to log EVM opcodes.",default:()=>!1,legacyName:"debug",cliType:"boolean"},quiet:{normalize:s.normalize,cliDescription:"Set to `true` to disable logging.",default:()=>!1,cliAliases:["q","quiet"],cliType:"boolean"},logger:{normalize:s.normalize,cliDescription:"An object, like `console`, that implements a `log` function.",disableInCLI:!0,default:e=>({log:e.quiet?()=>{}:console.log}),legacyName:"logger"},verbose:{normalize:s.normalize,cliDescription:"Set to `true` to log all RPC requests and responses.",default:()=>!1,legacyName:"verbose",cliAliases:["v","verbose"],cliType:"boolean"}}},711:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MinerOptions=void 0;const s=r(50),n=r(1),i=r(10),toBigIntOrString=e=>e.startsWith("0x")?e:BigInt(e);t.MinerOptions={blockTime:{normalize:e=>{if(e<0)throw new Error("miner.blockTime must be 0 or a positive number.");return e},cliDescription:'Sets the `blockTime` in seconds for automatic mining. A blockTime of `0` enables "instamine mode", where new executable transactions will be mined instantly.',default:()=>0,legacyName:"blockTime",cliAliases:["b","blockTime"],cliType:"number"},timestampIncrement:{normalize:e=>"clock"===e?"clock":n.Quantity.from(BigInt(e)),cliDescription:'The amount of time, in seconds, to add to the `timestamp` of each new block header. By default the value is `"clock"`, which uses your system clock time as the timestamp for each block.',default:()=>"clock",cliType:"string"},defaultGasPrice:{normalize:n.Quantity.from,cliDescription:"Sets the default gas price in WEI for transactions if not otherwise specified.",default:()=>n.Quantity.from(2e9),legacyName:"gasPrice",cliAliases:["g","gasPrice"],cliType:"string",cliCoerce:toBigIntOrString},blockGasLimit:{normalize:n.Quantity.from,cliDescription:"Sets the block gas limit in WEI.",default:()=>n.Quantity.from(3e7),legacyName:"gasLimit",cliAliases:["l","gasLimit"],cliType:"string",cliCoerce:toBigIntOrString},defaultTransactionGasLimit:{normalize:e=>"estimate"===e?n.Quantity.Empty:n.Quantity.from(e),cliDescription:'Sets the default transaction gas limit in WEI. Set to "estimate" to use an estimate (slows down transaction execution by 40%+).',default:()=>n.Quantity.from(9e4),cliType:"string",cliCoerce:e=>"estimate"===e?e:toBigIntOrString(e)},difficulty:{normalize:n.Quantity.from,cliDescription:"Sets the block difficulty.",default:()=>n.Quantity.One,cliType:"string",cliCoerce:toBigIntOrString},callGasLimit:{normalize:n.Quantity.from,cliDescription:"Sets the transaction gas limit in WEI for `eth_call` and `eth_estimateGas` calls.",default:()=>n.Quantity.from(5e7),legacyName:"callGasLimit",cliType:"string",cliCoerce:toBigIntOrString},instamine:{normalize:s.normalize,cliDescription:'Set the instamine mode to either "eager" (default) or "strict".\n * In "eager" mode a transaction will be included in a block before its hash is returned to the caller.\n * In "strict" mode a transaction\'s hash is returned to the caller before the transaction is included in a block.\n`instamine` has no effect if `blockTime` is *not* `0` (the default).',default:()=>"eager",legacyName:"instamine",cliAliases:["instamine"],cliType:"string",cliChoices:["eager","strict"]},coinbase:{normalize:e=>"number"==typeof e?e:i.Address.from(e),cliDescription:"Sets the address where mining rewards will go.",cliType:"string",cliCoerce:e=>e.startsWith("0x")?e:parseInt(e),default:()=>i.Address.from(n.ACCOUNT_ZERO)},extraData:{normalize:e=>{const t=n.Data.from(e);if(t.toBuffer().length>32)throw new Error(`extra exceeds max length. ${t.toBuffer().length} > 32`);return t},cliDescription:"Set the extraData block header field a miner can include.",default:()=>n.Data.Empty,cliType:"string"},priceBump:{normalize:BigInt,cliDescription:"Minimum price bump percentage needed to replace a transaction that already exists in the transaction pool.",default:()=>10n,cliType:"string"}}},339:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WalletOptions=void 0;const n=r(50),i=s(r(83)),a=r(440),o=r(45),c=(0,i.default)();const l=(()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=e.length;return(r,s)=>{let n="";for(let i=0;i<r;i++)n+=e[s()*t|0];return n}})();t.WalletOptions={accounts:{normalize:n.normalize,cliDescription:"Account data in the form `<private_key>,<initial_balance>`, can be specified multiple times. Note that private keys are 64 characters long and must be entered as an 0x-prefixed hex string. Balance can either be input as an integer, or as a 0x-prefixed hex string with either form specifying the initial balance in wei.",legacyName:"accounts",cliAliases:["account"],cliType:"array:string",cliCoerce:e=>e.map((e=>{const[t,r]=e.split(/,(.+)/);return{secretKey:t,balance:BigInt(r)}})),conflicts:["totalAccounts"]},totalAccounts:{normalize:n.normalize,cliDescription:"Number of accounts to generate at startup.",default:e=>null==e.accounts?10:0,legacyName:"total_accounts",cliAliases:["a","accounts"],cliType:"number",conflicts:["accounts"]},deterministic:{normalize:n.normalize,cliDescription:"Use pre-defined, deterministic seed.",default:()=>!1,cliAliases:["d","deterministic"],cliType:"boolean",conflicts:["mnemonic","seed"]},seed:{normalize:n.normalize,cliDescription:"Seed to use to generate a mnemonic.",default:e=>!0===e.deterministic?o.DeterministicSeedPhrase:l(10,c),defaultDescription:"Random value, unless wallet.deterministic is specified",legacyName:"seed",cliAliases:["s","seed"],cliType:"string",conflicts:["mnemonic","deterministic"]},mnemonic:{normalize:n.normalize,cliDescription:"Use a specific HD wallet mnemonic to generate initial addresses.",default:e=>(0,a.entropyToMnemonic)(function notVeryRandomBytes(e,t){const r=Buffer.allocUnsafe(e);for(let s=0;s<e;s++)r[s]=255*t()|0;return r}(16,(0,i.default)(e.seed))),defaultDescription:"Generated from wallet.seed",legacyName:"mnemonic",cliAliases:["m","mnemonic"],cliType:"string",conflicts:["seed","deterministic"]},unlockedAccounts:{normalize:n.normalize,cliDescription:"Array of addresses or address indexes specifying which accounts should be unlocked.",legacyName:"unlocked_accounts",cliAliases:["u","unlock"],cliType:"array:string"},lock:{normalize:n.normalize,cliDescription:"Lock available accounts by default (good for third party transaction signing).",default:()=>!1,legacyName:"secure",cliAliases:["n","secure","lock"],cliType:"boolean"},passphrase:{normalize:n.normalize,cliDescription:"Passphrase to use when locking accounts.",default:()=>"",cliAliases:["passphrase"],cliType:"string"},accountKeysPath:{normalize:n.normalize,cliDescription:"Specifies a file to save accounts and private keys to, for testing.",legacyName:"account_keys_path",cliAliases:["account_keys_path","acctKeys"],cliType:"string"},defaultBalance:{normalize:n.normalize,cliDescription:"The default account balance, specified in ether.",default:()=>1e3,legacyName:"default_balance_ether",cliAliases:["e","defaultBalanceEther"],cliType:"number"},hdPath:{normalize:e=>e.split("/"),cliDescription:"The hierarchical deterministic path to use when generating accounts.",default:()=>["m","44'","60'","0'","0"],legacyName:"hd_path",cliType:"string"}}},36:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(190),t),n(r(191),t),n(r(208),t),n(r(806),t),n(r(433),t),n(r(209),t),n(r(807),t),n(r(808),t),n(r(75),t),n(r(185),t),n(r(434),t),n(r(809),t),n(r(810),t)},429:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AccessLists=t.isAccessList=void 0;const s=r(58);var n=r(58);Object.defineProperty(t,"isAccessList",{enumerable:!0,get:function(){return n.isAccessList}});const i=r(1),a=r(10),o=r(209);t.AccessLists=class AccessLists{static getAccessListData(e){let t,r,n=0;const c=o.Params.ACCESS_LIST_STORAGE_KEY_GAS,l=o.Params.ACCESS_LIST_ADDRESS_GAS;if(e&&(0,s.isAccessList)(e)){t=e;const s=[];for(let t=0;t<e.length;t++){const r=e[t],o=a.Address.toBuffer(r.address),c=[],l=r.storageKeys.length;n+=l;for(let e=0;e<l;e++)c.push(i.Data.toBuffer(r.storageKeys[e],32));s.push([o,c])}r=s}else{r=e||[];const s=[];for(let e=0;e<r.length;e++){const t=r[e],o=a.Address.toString(t[0]),c=[],l=t[1].length;n+=l;for(let e=0;e<l;e++)c.push(i.Data.toString(t[1][e],32));const u={address:o,storageKeys:c};s.push(u)}t=s}return{AccessListJSON:t,accessList:r,dataFeeEIP2930:BigInt(r.length*l+n*c)}}}},208:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseTransaction=t.calculateIntrinsicGas=void 0;const s=r(1),n=r(10),i=r(209),a=1n<<64n-1n;t.calculateIntrinsicGas=(e,t,r)=>{const s=r.hardfork();let n=i.Params.TRANSACTION_GAS;if(t||(n+=i.Params.TRANSACTION_CREATION),e){const t=e.toBuffer(),r=t.byteLength;if(r>0){const e=i.Params.TRANSACTION_DATA_NON_ZERO_GAS.get(s),o=i.Params.TRANSACTION_DATA_ZERO_GAS;let c=0n;for(const e of t)0!==e&&c++;if((a-n)/e<c)return-1n;n+=c*e;const l=BigInt(r)-c;if((a-n)/o<l)return-1n;n+=l*o}}return n};t.BaseTransaction=class BaseTransaction{constructor(e,t){this.common=e,t&&this.setExtra(t)}setExtra(e){const[t,r,i,a,o,c]=e;this.from=n.Address.from(t),this.hash=s.Data.from(r,32),this.blockHash=s.Data.from(i,32),this.blockNumber=s.Quantity.from(a),this.index=s.Quantity.from(o),this.effectiveGasPrice=s.Quantity.from(c)}calculateIntrinsicGas(){const e=null!=this.to&&!this.to.toBuffer().equals(s.BUFFER_EMPTY);return(0,t.calculateIntrinsicGas)(this.data,e,this.common)}}},191:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EIP1559FeeMarketTransaction=void 0;const n=r(1),i=r(10),a=r(0),o=r(15),c=r(75),l=r(429),u=r(105),h=s(r(63)),d=r(5);const p=[2718,2930,1559];class EIP1559FeeMarketTransaction extends c.RuntimeTransaction{constructor(e,t,r){if(super(e,t,r),this.type=n.Quantity.from("0x2"),Array.isArray(e)){this.chainId=n.Quantity.from(e[0]),this.nonce=n.Quantity.from(e[1]),this.maxPriorityFeePerGas=n.Quantity.from(e[2]),this.maxFeePerGas=n.Quantity.from(e[3]),this.gas=n.Quantity.from(e[4]),this.to=0==e[5].length?n.Quantity.Empty:i.Address.from(e[5]),this.value=n.Quantity.from(e[6]),this.data=n.Data.from(e[7]);const s=l.AccessLists.getAccessListData(e[8]);if(this.accessList=s.accessList,this.accessListJSON=s.AccessListJSON,this.v=n.Quantity.from(e[9]),this.r=n.Quantity.from(e[10]),this.s=n.Quantity.from(e[11]),this.raw=[this.type.toBuffer(),...e],!r){if(t.chainId()!==this.chainId.toNumber())throw new d.CodedError(`Invalid chain id (${this.chainId.toNumber()}) for chain with id ${t.chainId()}.`,n.JsonRpcErrorCode.INVALID_INPUT);const{from:e,serialized:r,hash:s,encodedData:i,encodedSignature:a}=this.computeIntrinsics(this.v,this.raw);this.from=e,this.serialized=r,this.hash=s,this.encodedData=i,this.encodedSignature=a}}else{e.chainId?this.chainId=n.Quantity.from(e.chainId):this.chainId=n.Quantity.from(t.chainIdBN().toArrayLike(Buffer)),this.maxPriorityFeePerGas=n.Quantity.from(e.maxPriorityFeePerGas),this.maxFeePerGas=n.Quantity.from(e.maxFeePerGas);const r=l.AccessLists.getAccessListData(e.accessList);this.accessList=r.accessList,this.accessListJSON=r.AccessListJSON,this.validateAndSetSignature(e)}}maxGasPrice(){return this.maxFeePerGas}toJSON(e){return{type:this.type,hash:this.hash,chainId:this.chainId,nonce:this.nonce,blockHash:this.blockHash?this.blockHash:null,blockNumber:this.blockNumber?this.blockNumber:null,transactionIndex:this.index?this.index:null,from:this.from,to:this.to.isNull()?null:this.to,value:this.value,maxPriorityFeePerGas:this.maxPriorityFeePerGas,maxFeePerGas:this.maxFeePerGas,gasPrice:this.effectiveGasPrice,gas:this.gas,input:this.data,accessList:this.accessListJSON,v:this.v,r:this.r,s:this.s}}static fromTxData(e,t,r){return new EIP1559FeeMarketTransaction(e,t,r)}toVmTransaction(){const e=this.from,t=e.toBuffer(),r=this.to.toBuffer(),s=this.data.toBuffer();return{hash:()=>n.BUFFER_32_ZERO,nonce:new a.BN(this.nonce.toBuffer()),maxPriorityFeePerGas:new a.BN(this.maxPriorityFeePerGas.toBuffer()),maxFeePerGas:new a.BN(this.maxFeePerGas.toBuffer()),gasLimit:new a.BN(this.gas.toBuffer()),to:0===r.length?null:{buf:r,equals:e=>r.equals(e.buf)},value:new a.BN(this.value.toBuffer()),data:s,AccessListJSON:this.accessListJSON,getSenderAddress:()=>({buf:t,equals:e=>t.equals(e.buf),toString:()=>e.toString()}),getBaseFee:()=>{const e=this.calculateIntrinsicGas();return new a.BN(n.Quantity.toBuffer(e))},getUpfrontCost:(e=new a.BN(0))=>{const{gas:t,maxPriorityFeePerGas:r,maxFeePerGas:s,value:n}=this,i=new a.BN(r.toBuffer()),o=new a.BN(s.toBuffer()),c=new a.BN(t.toBuffer()),l=new a.BN(n.toBuffer()),u=a.BN.min(i,o.sub(e)).add(e);return c.mul(u).add(l)},supports:e=>p.includes(e)}}signAndHash(e){if(null!=this.v)throw new Error("Internal Error: RuntimeTransaction `sign` called but transaction has already been signed");const t=this.type.toBuffer(),r=this.toEthRawTransaction(n.BUFFER_ZERO,n.BUFFER_ZERO,n.BUFFER_ZERO),s=(0,o.encodeRange)(r,1,9),i=s.length,a=function ecsign(e,t){const r={signature:new Uint8Array(64),recid:null};if(0===h.default.ecdsaSign(r,e,t)){const e=r.signature.buffer;return{r:Buffer.from(e,0,32),s:Buffer.from(e,32,32),v:r.recid}}throw new Error("The nonce generation function failed, or the private key was invalid")}((0,n.keccak)(Buffer.concat([t,(0,o.digest)([s.output],i)])),e);this.v=n.Quantity.from(a.v),this.r=n.Quantity.from(a.r),this.s=n.Quantity.from(a.s),r[10]=this.v.toBuffer(),r[11]=this.r.toBuffer(),r[12]=this.s.toBuffer(),this.raw=r;const c=(0,o.encodeRange)(r,10,3);this.serialized=Buffer.concat([t,(0,o.digest)([s.output,c.output],i+c.length)]),this.hash=n.Data.from((0,n.keccak)(this.serialized)),this.encodedData=s,this.encodedSignature=c}toEthRawTransaction(e,t,r){return[this.type.toBuffer(),this.chainId.toBuffer(),this.nonce.toBuffer(),this.maxPriorityFeePerGas.toBuffer(),this.maxFeePerGas.toBuffer(),this.gas.toBuffer(),this.to.toBuffer(),this.value.toBuffer(),this.data.toBuffer(),this.accessList,e,t,r]}computeIntrinsics(e,t){return(0,u.computeIntrinsicsFeeMarketTx)(e,t)}updateEffectiveGasPrice(e){const t=e.toBigInt(),r=this.maxFeePerGas.toBigInt(),s=this.maxPriorityFeePerGas.toBigInt(),i=r-t,a=i<s?i:s;this.effectiveGasPrice=n.Quantity.from(t+a)}}t.EIP1559FeeMarketTransaction=EIP1559FeeMarketTransaction},190:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EIP2930AccessListTransaction=void 0;const n=r(1),i=r(10),a=r(0),o=r(15),c=r(75),l=r(429),u=r(105),h=s(r(63)),d=r(5);const p=[2718,2930];class EIP2930AccessListTransaction extends c.RuntimeTransaction{constructor(e,t,r){if(super(e,t,r),this.type=n.Quantity.from("0x1"),Array.isArray(e)){this.chainId=n.Quantity.from(e[0]),this.nonce=n.Quantity.from(e[1]),this.gasPrice=this.effectiveGasPrice=n.Quantity.from(e[2]),this.gas=n.Quantity.from(e[3]),this.to=0==e[4].length?n.Quantity.Empty:i.Address.from(e[4]),this.value=n.Quantity.from(e[5]),this.data=n.Data.from(e[6]);const s=l.AccessLists.getAccessListData(e[7]);if(this.accessList=s.accessList,this.accessListJSON=s.AccessListJSON,this.accessListDataFee=s.dataFeeEIP2930,this.v=n.Quantity.from(e[8]),this.r=n.Quantity.from(e[9]),this.s=n.Quantity.from(e[10]),this.raw=[this.type.toBuffer(),...e],!r){if(t.chainId()!==this.chainId.toNumber())throw new d.CodedError(`Invalid chain id (${this.chainId.toNumber()}) for chain with id ${t.chainId()}.`,n.JsonRpcErrorCode.INVALID_INPUT);const{from:e,serialized:r,hash:s,encodedData:i,encodedSignature:a}=this.computeIntrinsics(this.v,this.raw);this.from=e,this.serialized=r,this.hash=s,this.encodedData=i,this.encodedSignature=a}}else{if(e.chainId){if(this.chainId=n.Quantity.from(e.chainId),this.common.chainId()!==this.chainId.toNumber())throw new d.CodedError(`Invalid chain id (${this.chainId.toNumber()}) for chain with id ${t.chainId()}.`,n.JsonRpcErrorCode.INVALID_INPUT)}else this.chainId=n.Quantity.from(t.chainIdBN().toArrayLike(Buffer));this.gasPrice=this.effectiveGasPrice=n.Quantity.from(e.gasPrice);const r=l.AccessLists.getAccessListData(e.accessList);this.accessList=r.accessList,this.accessListJSON=r.AccessListJSON,this.accessListDataFee=r.dataFeeEIP2930,this.validateAndSetSignature(e)}}maxGasPrice(){return this.gasPrice}toJSON(e){return{hash:this.hash,type:this.type,chainId:this.chainId,nonce:this.nonce,blockHash:this.blockHash?this.blockHash:null,blockNumber:this.blockNumber?this.blockNumber:null,transactionIndex:this.index?this.index:null,from:this.from,to:this.to.isNull()?null:this.to,value:this.value,gas:this.gas,gasPrice:this.gasPrice,input:this.data,accessList:this.accessListJSON,v:this.v,r:this.r,s:this.s}}static fromTxData(e,t,r){return new EIP2930AccessListTransaction(e,t,r)}toVmTransaction(){const e=this.from,t=this.from.toBuffer(),r=this.to.toBuffer(),s=this.data.toBuffer();return{hash:()=>n.BUFFER_32_ZERO,nonce:new a.BN(this.nonce.toBuffer()),gasPrice:new a.BN(this.gasPrice.toBuffer()),gasLimit:new a.BN(this.gas.toBuffer()),to:0===r.length?null:{buf:r,equals:e=>r.equals(e.buf)},value:new a.BN(this.value.toBuffer()),data:s,AccessListJSON:this.accessListJSON,getSenderAddress:()=>({buf:t,equals:e=>t.equals(e.buf),toString:()=>e.toString()}),getBaseFee:()=>{const e=this.calculateIntrinsicGas();return new a.BN(n.Quantity.toBuffer(e+this.accessListDataFee))},getUpfrontCost:()=>{const{gas:e,gasPrice:t,value:r}=this,s=e.toBigInt()*t.toBigInt()+r.toBigInt();return new a.BN(n.Quantity.toBuffer(s))},supports:e=>p.includes(e)}}signAndHash(e){if(null!=this.v)throw new Error("Internal Error: RuntimeTransaction `sign` called but transaction has already been signed");const t=this.type.toBuffer(),r=this.toEthRawTransaction(n.BUFFER_ZERO,n.BUFFER_ZERO,n.BUFFER_ZERO),s=(0,o.encodeRange)(r,1,8),i=s.length,a=function ecsign(e,t){const r={signature:new Uint8Array(64),recid:null};if(0===h.default.ecdsaSign(r,e,t)){const e=r.signature.buffer;return{r:Buffer.from(e,0,32),s:Buffer.from(e,32,32),v:r.recid}}throw new Error("The nonce generation function failed, or the private key was invalid")}((0,n.keccak)(Buffer.concat([t,(0,o.digest)([s.output],i)])),e);this.v=n.Quantity.from(a.v),this.r=n.Quantity.from(a.r),this.s=n.Quantity.from(a.s),r[9]=this.v.toBuffer(),r[10]=this.r.toBuffer(),r[11]=this.s.toBuffer(),this.raw=r;const c=(0,o.encodeRange)(r,9,3);this.serialized=Buffer.concat([t,(0,o.digest)([s.output,c.output],i+c.length)]),this.hash=n.Data.from((0,n.keccak)(this.serialized)),this.encodedData=s,this.encodedSignature=c}toEthRawTransaction(e,t,r){return[this.type.toBuffer(),this.chainId.toBuffer(),this.nonce.toBuffer(),this.gasPrice.toBuffer(),this.gas.toBuffer(),this.to.toBuffer(),this.value.toBuffer(),this.data.toBuffer(),this.accessList,e,t,r]}computeIntrinsics(e,t){return(0,u.computeIntrinsicsAccessListTx)(e,t)}updateEffectiveGasPrice(){}}t.EIP2930AccessListTransaction=EIP2930AccessListTransaction},806:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},433:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LegacyTransaction=void 0;const s=r(1),n=r(10),i=r(0),a=r(15),o=r(0),c=r(75),l=r(105);class LegacyTransaction extends c.RuntimeTransaction{constructor(e,t,r){if(super(e,t,r),this.type=s.Quantity.from("0x0"),Array.isArray(e)){if(this.nonce=s.Quantity.from(e[0]),this.gasPrice=this.effectiveGasPrice=s.Quantity.from(e[1]),this.gas=s.Quantity.from(e[2]),this.to=0==e[3].length?s.Quantity.Empty:n.Address.from(e[3]),this.value=s.Quantity.from(e[4]),this.data=s.Data.from(e[5]),this.v=s.Quantity.from(e[6]),this.r=s.Quantity.from(e[7]),this.s=s.Quantity.from(e[8]),this.raw=e,!r){const{from:e,serialized:t,hash:r,encodedData:s,encodedSignature:n}=this.computeIntrinsics(this.v,this.raw,this.common.chainId());this.from=e,this.serialized=t,this.hash=r,this.encodedData=s,this.encodedSignature=n}}else this.gasPrice=this.effectiveGasPrice=s.Quantity.from(e.gasPrice),this.validateAndSetSignature(e)}maxGasPrice(){return this.gasPrice}toJSON(e){const t={hash:this.hash,type:this.type,nonce:this.nonce,blockHash:this.blockHash?this.blockHash:null,blockNumber:this.blockNumber?this.blockNumber:null,transactionIndex:this.index?this.index:null,from:this.from,to:this.to.isNull()?null:this.to,value:this.value,gas:this.gas,gasPrice:this.gasPrice,input:this.data,v:this.v,r:this.r,s:this.s};return(this.common||e).isActivatedEIP(2718)&&(t.type=this.type),t}static fromTxData(e,t,r){return new LegacyTransaction(e,t,r)}static fromEIP2930AccessListTransaction(e,t){return Array.isArray(e)?new LegacyTransaction(e.slice(1,7).concat(e.slice(8)),t):new LegacyTransaction(e,t)}toVmTransaction(){const e=this.from,t=e.toBuffer(),r=this.to.toBuffer(),n=this.data.toBuffer();return{hash:()=>s.BUFFER_32_ZERO,nonce:new o.BN(this.nonce.toBuffer()),gasPrice:new o.BN(this.gasPrice.toBuffer()),gasLimit:new o.BN(this.gas.toBuffer()),to:0===r.length?null:{buf:r,equals:e=>r.equals(e.buf)},value:new o.BN(this.value.toBuffer()),data:n,getSenderAddress:()=>({buf:t,equals:e=>t.equals(e.buf),toString:()=>e.toString()}),getBaseFee:()=>{const e=this.calculateIntrinsicGas();return new o.BN(s.Quantity.toBuffer(e))},getUpfrontCost:()=>{const{gas:e,gasPrice:t,value:r}=this,n=e.toBigInt()*t.toBigInt()+r.toBigInt();return new o.BN(s.Quantity.toBuffer(n))},supports:e=>!1}}signAndHash(e){if(null!=this.v)throw new Error("Internal Error: RuntimeTransaction `sign` called but transaction has already been signed");let t,r,n,o,c;if(this.common.gteHardfork("spuriousDragon")){t=this.common.chainIdBN().toArrayLike(Buffer),r=this.toEthRawTransaction(t,s.BUFFER_EMPTY,s.BUFFER_EMPTY),n=(0,a.encodeRange)(r,0,6),o=n.length;const l=(0,a.encodeRange)(r,6,3),u=(0,s.keccak)((0,a.digest)([n.output,l.output],o+l.length));c=(0,i.ecsign)(u,e,t)}else{r=this.toEthRawTransaction(s.BUFFER_EMPTY,s.BUFFER_EMPTY,s.BUFFER_EMPTY),n=(0,a.encodeRange)(r,0,6),o=n.length;const t=(0,s.keccak)((0,a.digest)([n.output],o));c=(0,i.ecsign)(t,e)}this.v=s.Quantity.from(c.v),this.r=s.Quantity.from(c.r),this.s=s.Quantity.from(c.s),r[6]=this.v.toBuffer(),r[7]=this.r.toBuffer(),r[8]=this.s.toBuffer(),this.raw=r;const l=(0,a.encodeRange)(r,6,3);this.serialized=(0,a.digest)([n.output,l.output],o+l.length),this.hash=s.Data.from((0,s.keccak)(this.serialized)),this.encodedData=n,this.encodedSignature=l}toEthRawTransaction(e,t,r){return[this.nonce.toBuffer(),this.gasPrice.toBuffer(),this.gas.toBuffer(),this.to.toBuffer(),this.value.toBuffer(),this.data.toBuffer(),e,t,r]}computeIntrinsics(e,t,r){return(0,l.computeIntrinsicsLegacyTx)(e,t,r)}updateEffectiveGasPrice(){}}t.LegacyTransaction=LegacyTransaction},209:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Params=void 0,t.Params={TRANSACTION_GAS:21000n,TRANSACTION_DATA_NON_ZERO_GAS:new Map([["chainstart",68n],["homestead",68n],["dao",68n],["tangerineWhistle",68n],["spuriousDragon",68n],["byzantium",68n],["constantinople",68n],["petersburg",68n],["istanbul",16n],["muirGlacier",16n],["berlin",16n],["london",16n],["arrowGlacier",16n]]),TRANSACTION_DATA_ZERO_GAS:4n,TRANSACTION_CREATION:32000n,ACCESS_LIST_ADDRESS_GAS:2400,ACCESS_LIST_STORAGE_KEY_GAS:1900}},807:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},808:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},75:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RuntimeTransaction=t.hasPartialSignature=t.toValidLengthAddress=void 0;const s=r(5),n=r(1),i=r(15),a=r(208),o=r(185),c=r(10);t.toValidLengthAddress=(e,t)=>{const r=n.Data.toBuffer(e);if(r.byteLength!==c.Address.ByteLength)throw new Error(`The field ${t} must have byte length of ${c.Address.ByteLength}`);return c.Address.from(r)};t.hasPartialSignature=e=>null!=e.v||null!=e.r||null!=e.s;const l=n.Quantity.One.toBuffer();class RuntimeTransaction extends a.BaseTransaction{constructor(e,r,s){let i;if(super(r,s),this.locked=!1,this.validateAndSetSignature=e=>{if((0,t.hasPartialSignature)(e)){if(null==e.v||null==e.r||null==e.s)throw new Error("Transaction signature is incomplete; v, r, and s are required.");if(null==e.nonce)throw new Error("Signed transaction is incomplete; nonce is required.");this.v=n.Quantity.from(e.v,!0),this.r=n.Quantity.from(e.r,!0),this.s=n.Quantity.from(e.s,!0);const r=this.toEthRawTransaction(this.v.toBuffer(),this.r.toBuffer(),this.s.toBuffer());if(this.raw=r,!this.from){const{from:s,serialized:n,hash:i,encodedData:a,encodedSignature:o}=this.computeIntrinsics(this.v,r,this.common.chainId());if(null!==e.from){const r=(0,t.toValidLengthAddress)(e.from,"from");if(!s.toBuffer().equals(r.toBuffer()))throw new Error("Transaction is signed and contains a `from` field, but the signature doesn't match.")}this.from=s,this.serialized=n,this.hash=i,this.encodedData=a,this.encodedSignature=o}}else null!=e.from&&(this.from=(0,t.toValidLengthAddress)(e.from,"from"))},this.finalized=new Promise((e=>{i=(...t)=>process.nextTick(e,...t)})),this.finalizer=i,!Array.isArray(e)){this.nonce=n.Quantity.from(e.nonce,!0),this.gas=n.Quantity.from(null==e.gas?e.gasLimit:e.gas),this.to=null==e.to?n.Quantity.Empty:(0,t.toValidLengthAddress)(e.to,"to"),this.value=n.Quantity.from(e.value||0);const r=null==e.data?null==e.input?"0x":e.input:e.data;this.data=n.Data.from(r)}}serializeForDb(e,t,r){const s=[this.raw,[this.from.toBuffer(),this.hash.toBuffer(),e.toBuffer(),t.toBuffer(),r.toBuffer(),this.effectiveGasPrice.toBuffer()]];return(0,i.encode)(s)}fillFromResult(e,t){const r=e.execResult;let i;r.exceptionError?(i=n.BUFFER_ZERO,this.execException=new s.RuntimeError(this.hash,e,s.RETURN_TYPES.TRANSACTION_HASH)):i=l;return(this.receipt=o.InternalTransactionReceipt.fromValues(i,n.Quantity.toBuffer(t),e.bloom.bitvector,this.logs=r.logs||[],e.gasUsed.toArrayLike(Buffer),e.createdAddress?e.createdAddress.buf:null,this.type)).serialize(!1)}getReceipt(){return this.receipt}getLogs(){return this.logs}once(e){return this.finalized}finalize(e,t=null){this.finalizer({status:e,error:t})}}t.RuntimeTransaction=RuntimeTransaction},105:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.computeIntrinsicsFeeMarketTx=t.computeIntrinsicsAccessListTx=t.computeIntrinsicsLegacyTx=t.computeFromAddress=t.publicKeyConvert=t.ecdsaRecover=t.isValidSigRecovery=void 0;const n=r(1),i=r(15),a=r(10),o=s(r(63));function copyOrFill(e,t,r,s){if(e.byteLength>s)throw new Error("Invalid signature");const n=s-e.byteLength,i=r+n;let a=r;for(;a<i;a++)t[a]=0;let o=r+s;const c=r+n;for(;a<o;a++)t[a]=e[a-c]}t.isValidSigRecovery=e=>1===e||0===e;function _ecdsaRecover(e,r,s,i,a){if(!(0,t.isValidSigRecovery)(a))throw new Error("Invalid signature v value");const c=(0,n.keccak)(e),l=r.slice(0,64);copyOrFill(s,l,0,32),copyOrFill(i,l,32,32);const u=r.slice(0,33);if(0!==o.default.ecdsaRecover(u,l,a,c))throw new Error("Invalid Signature");return u}t.ecdsaRecover=(e,t,r,s,a,o)=>{let c,l;const u=2*s+35;if(r===u||r===u+1){const t=[0===(h=s)?n.BUFFER_EMPTY:(0,n.uintToBuffer)(h),n.BUFFER_EMPTY,n.BUFFER_EMPTY],a=(0,i.encodeRange)(t,0,3);c=(0,i.digest)([e.output,a.output],e.length+a.length),l=r-u}else c=(0,i.digest)([e.output],e.length),l=r-27;var h;return _ecdsaRecover(c,t,a,o,l)};t.publicKeyConvert=(e,t)=>{const r=e.slice(0,65);if(0!==o.default.publicKeyConvert(r,t))throw new Error("Invalid Signature");return r};const c=Buffer.allocUnsafe(65);t.computeFromAddress=(e,r,s,i,o)=>{const l=(0,t.ecdsaRecover)(e,c,r,o,s,i),u=(0,t.publicKeyConvert)(c,l);return a.Address.from((0,n.keccak)(u.slice(1)).slice(-20))};t.computeIntrinsicsLegacyTx=(e,r,s)=>{const a=(0,i.encodeRange)(r,0,6),o=(0,i.encodeRange)(r,6,3),c=(0,i.digest)([a.output,o.output],a.length+o.length);return{from:(0,t.computeFromAddress)(a,e.toNumber(),r[7],r[8],s),hash:n.Data.from((0,n.keccak)(c),32),serialized:c,encodedData:a,encodedSignature:o}};t.computeIntrinsicsAccessListTx=(e,r)=>{const s=r[0],o=(0,i.encodeRange)(r,1,8),l=(0,i.encodeRange)(r,9,3),u=Buffer.concat([s,(0,i.digest)([o.output,l.output],o.length+l.length)]),h=_ecdsaRecover(Buffer.concat([s,(0,i.digest)([o.output],o.length)]),c,r[10],r[11],e.toNumber()),d=(0,t.publicKeyConvert)(c,h);return{from:a.Address.from((0,n.keccak)(d.slice(1)).slice(-20)),hash:n.Data.from((0,n.keccak)(u),32),serialized:u,encodedData:o,encodedSignature:l}};t.computeIntrinsicsFeeMarketTx=(e,r)=>{const s=r[0],o=(0,i.encodeRange)(r,1,9),l=(0,i.encodeRange)(r,10,3),u=Buffer.concat([s,(0,i.digest)([o.output,l.output],o.length+l.length)]),h=_ecdsaRecover(Buffer.concat([s,(0,i.digest)([o.output],o.length)]),c,r[11],r[12],e.toNumber()),d=(0,t.publicKeyConvert)(c,h);return{from:a.Address.from((0,n.keccak)(d.slice(1)).slice(-20)),hash:n.Data.from((0,n.keccak)(u),32),serialized:u,encodedData:o,encodedSignature:l}}},434:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransactionFactory=t.TransactionType=void 0;const s=r(1),n=r(433),i=r(190),a=r(15),o=r(5),c=r(191),l=r(63);function assertValidTransactionSValue(e,t){if(t.s&&t.s.toBigInt()>=l.SECP256K1_MAX_PRIVATE_KEY_DIV_2&&e.gteHardfork("homestead"))throw new Error("Invalid Signature: s-values greater than secp256k1n/2 are considered invalid")}var u;!function(e){e[e.Legacy=0]="Legacy",e[e.EIP2930AccessList=1]="EIP2930AccessList",e[e.EIP1559AccessList=2]="EIP1559AccessList"}(u=t.TransactionType||(t.TransactionType={}));class TransactionFactory{constructor(e,t){const[r,s]=(0,a.decode)(e);this.tx=TransactionFactory.fromDatabaseTx(r,t,s)}static _fromData(e,t,r,a){if(!r.isActivatedEIP(2718))return n.LegacyTransaction.fromTxData(e,r,a);if(r.isActivatedEIP(1559))if(Array.isArray(e)){if(t===u.Legacy)return n.LegacyTransaction.fromTxData(e,r,a);if(t===u.EIP2930AccessList)return i.EIP2930AccessListTransaction.fromTxData(e,r,a);if(t===u.EIP1559AccessList)return c.EIP1559FeeMarketTransaction.fromTxData(e,r,a)}else{const o=(t===u.Legacy||t===u.EIP2930AccessList)&&void 0===e.gasPrice;if(t===u.EIP1559AccessList||o){const t=c.EIP1559FeeMarketTransaction.fromTxData(e,r,a);return o&&(e.maxFeePerGas||(t.maxFeePerGas=s.Quantity.from(null)),e.maxPriorityFeePerGas||(t.maxPriorityFeePerGas=s.Quantity.Gwei)),t}if(t===u.Legacy)return n.LegacyTransaction.fromTxData(e,r,a);if(t===u.EIP2930AccessList)return void 0===e.accessList?n.LegacyTransaction.fromTxData(e,r,a):i.EIP2930AccessListTransaction.fromTxData(e,r,a)}else{if(t===u.Legacy)return n.LegacyTransaction.fromTxData(e,r,a);if(t===u.EIP2930AccessList){if(r.isActivatedEIP(2930))return i.EIP2930AccessListTransaction.fromTxData(e,r,a);throw new o.CodedError("EIP 2930 is not activated.",s.JsonRpcErrorCode.INVALID_PARAMS)}if(t===u.EIP1559AccessList)throw new o.CodedError("EIP 1559 is not activated.",s.JsonRpcErrorCode.INVALID_PARAMS)}throw new o.CodedError("Tx instantiation with supplied type not supported",s.JsonRpcErrorCode.METHOD_NOT_FOUND)}static fromRpc(e,t,r){const s=this.typeOfRPC(e),n=this._fromData(e,s,t,r);return assertValidTransactionSValue(t,n),n}static fromDatabaseTx(e,t,r){const a=this.typeOfRaw(e);switch(a){case u.EIP1559AccessList:return c.EIP1559FeeMarketTransaction.fromTxData(e.slice(1),t,r);case u.Legacy:return n.LegacyTransaction.fromTxData(e,t,r);case u.EIP2930AccessList:return i.EIP2930AccessListTransaction.fromTxData(e.slice(1),t,r);default:throw new o.CodedError(`Transactions with supplied type ${a} not supported`,s.JsonRpcErrorCode.METHOD_NOT_FOUND)}}static fromString(e,t){let r=s.Data.toBuffer(e);const n=r[0],i=this.typeOf(n);let o;if(t.isActivatedEIP(2718)){let e;try{e=(0,a.decode)(i===u.Legacy?r:r.slice(1))}catch(e){throw new Error("Could not decode transaction: "+e.message)}o=this._fromData(e,i,t)}else{let e;try{e=(0,a.decode)(r)}catch(e){throw new Error("Could not decode transaction: "+e.message)}o=this._fromData(e,u.Legacy,t)}return assertValidTransactionSValue(t,o),o}static typeOf(e){if(e===u.EIP1559AccessList||e===u.EIP2930AccessList)return e;if(e>=192||e===u.Legacy||void 0===e)return u.Legacy;throw new Error(`Invalid transaction type: ${e}`)}static typeOfRaw(e){if(9===e.length)return u.Legacy;const t=e[0][0];return this.typeOf(t)}static typeOfRPC(e){if("type"in e&&void 0!==e.type){const t=parseInt(e.type,16);return this.typeOf(t)}return u.Legacy}}t.TransactionFactory=TransactionFactory},185:function(e,t,r){"use strict";var s,n,i=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)},a=this&&this.__classPrivateFieldSet||function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r};Object.defineProperty(t,"__esModule",{value:!0}),t.InternalTransactionReceipt=void 0;const o=r(5),c=r(15),l=r(1),u=[l.Quantity.Zero,l.Quantity.One];class InternalTransactionReceipt{constructor(e){if(s.set(this,void 0),n.set(this,((e,t,r,n,i,o=null,c=null)=>{this.raw=[e,t,r,n],this.contractAddress=o,a(this,s,i,"f"),this.txType=c})),e){const t=(0,c.decode)(e);i(this,n,"f").call(this,t[0],t[1],t[2],t[3],t[4],t[5])}}static fromValues(e,t,r,s,a,o,c=null){const l=new InternalTransactionReceipt;return i(l,n,"f").call(l,e,t,r,s,a,o,c),l}serialize(e){if(null==this.encoded&&(this.encoded=(0,c.encodeRange)(this.raw,0,4)),e){const e=[i(this,s,"f"),this.contractAddress],t=(0,c.encodeRange)(e,0,2);return(0,c.digest)([this.encoded.output,t.output],this.encoded.length+t.length)}{const e=(0,c.digest)([this.encoded.output],this.encoded.length);return this.txType?Buffer.concat([this.txType.toBuffer(),e]):e}}toJSON(e,t,r){const n=this.raw,a=0===this.contractAddress.length?null:l.Data.from(this.contractAddress),c=e.hash(),h=e.header.number,d=o.BlockLogs.create(c),p=t.hash,m=t.index;d.blockNumber=h,n[3].forEach((e=>d.append(m,p,e)));const g=[...d.toJSON()];e.header.baseFeePerGas&&t.updateEffectiveGasPrice(e.header.baseFeePerGas);const y={transactionHash:p,transactionIndex:m,blockNumber:h,blockHash:c,from:t.from,to:a?null:t.to,cumulativeGasUsed:l.Quantity.from(n[1]),gasUsed:l.Quantity.from(i(this,s,"f")),contractAddress:a,logs:g,logsBloom:l.Data.from(n[2],256),status:u[n[0][0]],effectiveGasPrice:t.effectiveGasPrice};return t.type&&r.isActivatedEIP(2718)&&(y.type=t.type),y}}t.InternalTransactionReceipt=InternalTransactionReceipt,s=new WeakMap,n=new WeakMap},809:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},810:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},5:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(292),t)},738:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbortError=void 0;class AbortError extends Error{constructor(){super("The user aborted a request.")}}t.AbortError=AbortError},737:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallError=void 0;const s=r(207),n=r(201),i=r(1),a=r(1);class CallError extends n.CodedError{constructor(e){const t=e.execResult,r=t.exceptionError.error;let o=s.VM_EXCEPTION+r;super(o,i.JsonRpcErrorCode.INVALID_INPUT),n.CodedError.captureStackTraceExtended.bind(this,o),this.name=this.constructor.name;const{returnValue:c}=t,l=n.CodedError.createRevertReason(c);this.message=l?o+" "+l:o,this.data=a.Data.toString(c)}}t.CallError=CallError},201:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CodedError=void 0;const s=r(727),n=Buffer.from("08c379a0","hex");class CodedError extends Error{constructor(e,t){super(e),CodedError.captureStackTraceExtended.bind(this,e),this.code=t}static from(e,t){const r=new CodedError(e.message,t);return r.stack=e.stack,r}static nonEnumerableProperty(e){return{value:e,writable:!0,configurable:!0}}static captureStackTraceExtended(e){Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):(Object.defineProperty(this,"stack",CodedError.nonEnumerableProperty(Error(e).stack)),Object.defineProperty(this,"message",CodedError.nonEnumerableProperty(void 0!==e?""+e:"")))}static createRevertReason(e){let t;if(e.length>4&&0===n.compare(e,0,4))try{t=(0,s.rawDecode)(["bytes"],e.slice(4))[0].toString()}catch{t=null}else t=null;return t}}t.CodedError=CodedError},207:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INSUFFICIENT_FUNDS=t.TRANSACTION_LOCKED=t.VM_EXCEPTIONS=t.VM_EXCEPTION=t.GAS_LIMIT=t.INTRINSIC_GAS_TOO_LOW=t.REPLACED=t.UNDERPRICED=t.NONCE_TOO_LOW=t.INVALID_SENDER=void 0,t.INVALID_SENDER="invalid sender",t.NONCE_TOO_LOW="nonce too low",t.UNDERPRICED="transaction underpriced",t.REPLACED="transaction replaced by better transaction",t.INTRINSIC_GAS_TOO_LOW="intrinsic gas too low",t.GAS_LIMIT="exceeds block gas limit",t.VM_EXCEPTION="VM Exception while processing transaction: ",t.VM_EXCEPTIONS="Multiple VM Exceptions while processing transactions: : \n\n",t.TRANSACTION_LOCKED="transaction can't be replaced, mining has already started. (please open an issue with reproduction steps: https://github.com/trufflesuite/ganache/issues/new)",t.INSUFFICIENT_FUNDS="insufficient funds for gas * price + value"},426:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RuntimeError=t.RETURN_TYPES=void 0;const s=r(207),n=r(1),i=r(201),a=r(1);var o;!function(e){e[e.TRANSACTION_HASH=0]="TRANSACTION_HASH",e[e.RETURN_VALUE=1]="RETURN_VALUE"}(o=t.RETURN_TYPES||(t.RETURN_TYPES={}));class RuntimeError extends i.CodedError{constructor(e,t,r){const c=t.execResult,l=c.exceptionError.error;let u=s.VM_EXCEPTION+l;super(u,a.JsonRpcErrorCode.INVALID_INPUT),i.CodedError.captureStackTraceExtended.bind(this,u),this.name=this.constructor.name;const h=e.toString(),{returnValue:d}=c,p=i.CodedError.createRevertReason(d);this.message=p?u+" "+p:u,this.data={hash:h,programCounter:c.runState.programCounter,result:r===o.TRANSACTION_HASH?h:n.Data.toString(d||"0x"),reason:p,message:l}}}t.RuntimeError=RuntimeError},292:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(201),t),n(r(207),t),n(r(426),t),n(r(737),t),n(r(738),t),n(r(739),t),n(r(741),t),n(r(355),t),n(r(742),t),n(r(743),t),n(r(744),t),n(r(745),t),n(r(427),t),n(r(746),t),n(r(747),t),n(r(748),t),n(r(749),t),n(r(750),t)},739:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Account=void 0;const s=r(1),n=r(0),i=r(15);class Account{constructor(e){this.stateRoot=n.KECCAK256_RLP,this.codeHash=n.KECCAK256_NULL,this.address=e,this.balance=s.Quantity.Empty,this.nonce=s.Quantity.Empty}static fromBuffer(e){const t=Object.create(Account.prototype),r=(0,i.decode)(e);return t.nonce=s.Quantity.from(r[0]),t.balance=s.Quantity.from(r[1]),t.stateRoot=r[2],t.codeHash=r[3],t}serialize(){return(0,i.encode)([this.nonce.toBuffer(),this.balance.toBuffer(),this.stateRoot,this.codeHash])}}t.Account=Account},741:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BlockLogs=void 0;const s=r(1),n=r(1),i=r(15),a=r(10),o=Symbol("raw"),c=Symbol("logs"),filterByTopic=(e,t)=>!(e.length>t.length)&&e.every(((e,r)=>{if(null===e)return!0;let n;if(!Array.isArray(e))return t[r].equals(s.Data.toBuffer(e));if(0===e.length)return!0;n=e;const i=t[r];return n.some((e=>i.equals(s.Data.toBuffer(e))))}));class BlockLogs{constructor(e){if(e){const t=(0,i.decode)(e);this[o]=t}}static create(e){const t=Object.create(BlockLogs.prototype);return t[o]=[e.toBuffer(),[]],t}serialize(){return(0,i.encode)(this[o])}append(e,t,r){this[o][1].push([n.BUFFER_ZERO,e.toBuffer(),t.toBuffer(),r[0],r[1],r[2]])}get length(){return this[o][1].length}static fromJSON(e){if(!e||0===e.length)return null;const t=e[0].blockHash,r=e[0].blockNumber,i=BlockLogs.create(s.Data.from(t,32));return i.blockNumber=s.Quantity.from(r),e.forEach((e=>{const t=a.Address.from(e.address),r=(e.blockNumber,Array.isArray(e.data)?e.data.map((e=>s.Data.toBuffer(e))):s.Data.toBuffer(e.data)),o=(e.logIndex,!1===e.removed?n.BUFFER_ZERO:s.Quantity.One.toBuffer(),Array.isArray(e.topics)?e.topics.map((e=>s.Data.toBuffer(e,32))):s.Data.toBuffer(e.topics,32)),c=s.Data.from(e.transactionHash,32),l=s.Quantity.from(e.transactionIndex);i.append(l,c,[t.toBuffer(),o,r])})),i}toJSON(){return this[c]().toJSON()}[c](){const e=this.blockNumber,t=this[o],r=t[1],n=this.length,i=s.Data.from(t[0]);return{toJSON:()=>({*[Symbol.iterator](){for(let t=0;t<n;t++)yield BlockLogs.logToJSON(r[t],s.Quantity.from(t),i,e)}}),*[Symbol.iterator](){for(let t=0;t<n;t++){const n=r[t],a=n[3],o=n[4];yield{address:a,topics:o,toJSON:()=>BlockLogs.logToJSON(n,s.Quantity.from(t),i,e)}}}}}static logToJSON(e,t,r,i){const o=e[4],c=e[5];return{address:a.Address.from(e[3]),blockHash:r,blockNumber:i,data:Array.isArray(c)?c.map((e=>s.Data.from(e,e.length))):s.Data.from(c,c.length),logIndex:t,removed:!e[0].equals(n.BUFFER_ZERO),topics:Array.isArray(o)?o.map((e=>s.Data.from(e,32))):s.Data.from(o,32),transactionHash:s.Data.from(e[2],32),transactionIndex:s.Quantity.from(e[1])}}*filter(e,t){const r=this[c]();if(0!==e.length)if(0===t.length)for(const t of r)e.some((e=>e.equals(t.address)))&&(yield t.toJSON());else for(const s of r)e.some((e=>e.equals(s.address)))&&filterByTopic(t,s.topics)&&(yield s.toJSON());else if(0!==t.length)for(const e of r)filterByTopic(t,e.topics)&&(yield e.toJSON());else yield*r.toJSON()}}t.BlockLogs=BlockLogs},355:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tag=t.InternalTag=void 0,function(e){e.earliest="earliest",e.latest="latest",e.pending="pending"}(t.InternalTag||(t.InternalTag={})),function(e){e.latest="latest",e.earliest="earliest",e.pending="pending"}(t.Tag||(t.Tag={}))},742:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TraceDataFactory=void 0;const s=r(1),n=["","00","0000","000000","00000000","0000000000","000000000000","00000000000000","0000000000000000","000000000000000000","00000000000000000000","0000000000000000000000","000000000000000000000000","00000000000000000000000000","0000000000000000000000000000","000000000000000000000000000000","00000000000000000000000000000000","0000000000000000000000000000000000","000000000000000000000000000000000000","00000000000000000000000000000000000000","0000000000000000000000000000000000000000","000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000","0000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","0000000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000000000","0000000000000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000000000000000","0000000000000000000000000000000000000000000000000000000000000000"];t.TraceDataFactory=()=>{const e=new Map;return{from:t=>{const r=(0,s.bufferToMinHexKey)(t),i=e.get(r);if(i)return i;let a,o;const c={toBuffer:()=>{if(a)return a;const e=t.byteLength;if(32===e)a=t;else{const r=32-e;a=Buffer.allocUnsafe(32).fill(0,0,r),t.copy(a,r,0,e)}return a},toJSON:()=>o||(o=`${n[32-r.length/2]}${r}`)};return e.set(r,c),c}}}},743:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TraceStorageMap=void 0;class TraceStorageMap extends Map{toJSON(){const e={};for(const[t,r]of this)e[t.toJSON()]=r;return e}}t.TraceStorageMap=TraceStorageMap},744:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},745:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},427:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilterTypes=void 0,function(e){e[e.log=0]="log",e[e.block=1]="block",e[e.pendingTransaction=2]="pendingTransaction"}(t.FilterTypes||(t.FilterTypes={}))},746:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},747:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},748:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},749:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},750:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},895:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilecoinDefaults=t.FilecoinOptionsConfig=void 0;const s=r(393);var n=r(393);Object.defineProperty(t,"FilecoinOptionsConfig",{enumerable:!0,get:function(){return n.FilecoinOptionsConfig}}),Object.defineProperty(t,"FilecoinDefaults",{enumerable:!0,get:function(){return n.FilecoinDefaults}}),t.default={FilecoinDefaults:s.FilecoinDefaults,FilecoinOptionsConfig:s.FilecoinOptionsConfig}},896:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChainOptions=void 0;const s=r(101);t.ChainOptions={ipfsHost:{normalize:s.normalize,cliDescription:"The IPFS simulator host name/address to listen on.",default:()=>"127.0.0.1",cliType:"string"},ipfsPort:{normalize:s.normalize,cliDescription:"The IPFS simulator port.",default:()=>5001,cliType:"number"},asyncRequestProcessing:{normalize:s.normalize,cliDescription:"When set to `false` only one request will be processed at a time.",default:()=>!0,cliType:"boolean"}}},897:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseOptions=void 0;const s=r(101);t.DatabaseOptions={db:{normalize:s.normalize,cliDescription:"Specify an alternative database instance, like MemDOWN",disableInCLI:!0,conflicts:["dbPath"]},dbPath:{normalize:s.normalize,cliDescription:"Specify a path to a directory to save the chain database.",cliAliases:["db"],cliType:"string",conflicts:["db"]}}},101:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.normalize=void 0;t.normalize=e=>e},393:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilecoinOptionsConfig=t.FilecoinDefaults=void 0;const s=r(896),n=r(897),i=r(898),a=r(899),o=r(394),c=r(45);t.FilecoinDefaults={chain:s.ChainOptions,database:n.DatabaseOptions,logging:i.LoggingOptions,miner:a.MinerOptions,wallet:o.WalletOptions},t.FilecoinOptionsConfig=new c.OptionsConfig(t.FilecoinDefaults)},898:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggingOptions=void 0;const s=r(101),n={log:console.log};t.LoggingOptions={logger:{normalize:s.normalize,cliDescription:"An object, like `console`, that implements a `log` function.",disableInCLI:!0,default:()=>n}}},899:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MinerOptions=void 0;const s=r(101);t.MinerOptions={blockTime:{normalize:e=>Math.max(0,e),cliDescription:'Sets the `blockTime` in seconds for automatic mining. A `blockTime` of `0` or a negative number enables "instamine mode", where new executable transactions will be mined instantly.',default:()=>0,cliType:"number"},mine:{normalize:s.normalize,cliDescription:"Enable mining. Set to `false` to pause the miner.",default:()=>!0,cliType:"boolean"}}},394:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WalletOptions=void 0;const n=r(101),i=s(r(83)),a=r(45),o=(0,i.default)(),c=(()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=e.length;return(r,s)=>{let n="";for(let i=0;i<r;i++)n+=e[s()*t|0];return n}})();t.WalletOptions={totalAccounts:{normalize:n.normalize,cliDescription:"Number of accounts to generate at startup.",default:()=>10,cliAliases:["a"],cliType:"number"},deterministic:{normalize:n.normalize,cliDescription:"Use pre-defined, deterministic seed.",default:()=>!1,cliAliases:["d"],cliType:"boolean",conflicts:["seed"]},seed:{normalize:n.normalize,cliDescription:"Seed to use to generate a mnemonic.",default:e=>!0===e.deterministic?a.DeterministicSeedPhrase:c(10,o),cliAliases:["s"],cliType:"string",conflicts:["deterministic"]},defaultBalance:{normalize:n.normalize,cliDescription:"The default account balance, specified in FIL.",default:()=>100,cliAliases:["b"],cliType:"number"}}},110:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(900),t)},900:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TruffleColors=void 0,t.TruffleColors={porsche:"#e4a663",turquoise:"#3fe0c5",infura:"#ff6b4a"}},112:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.__experimental_info=t.provider=t.server=t._DefaultServerOptions=t.ServerStatus=t.Server=void 0;const n=r(1),i=s(r(406)),a=s(r(305));var o=r(305);Object.defineProperty(t,"Server",{enumerable:!0,get:function(){return o.Server}}),Object.defineProperty(t,"ServerStatus",{enumerable:!0,get:function(){return o.ServerStatus}}),Object.defineProperty(t,"_DefaultServerOptions",{enumerable:!0,get:function(){return o._DefaultServerOptions}});const c={server:e=>new a.default(e),provider:e=>i.default.initialize(e).connector.provider,__experimental_info:()=>({version:"7.3.2",fork:{knownChainIds:Array.from(n.KNOWN_CHAINIDS)}})};t.server=c.server,t.provider=c.provider,t.__experimental_info=c.__experimental_info,t.default=c},406:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1),n=r(56),i=r(56);t.default={initialize:(e={flavor:n.DefaultFlavor,chain:{asyncRequestProcessing:!0}})=>{const t=e.flavor||n.DefaultFlavor;let r;r="chain"in e&&"asyncRequestProcessing"in e.chain?e.chain.asyncRequestProcessing:!("asyncRequestProcessing"in e)||e.asyncRequestProcessing;const a=new s.RequestCoordinator(r?0:1),o=new s.Executor(a),c=(0,i.GetConnector)(t,e,o),l=c.connect?c.connect():c.initialize();return{connector:c,promise:l.then(a.resume)}}}},582:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.serverOptionsConfig=t.serverDefaults=void 0;const s=r(902),n=r(45);t.serverDefaults={server:s.ServerOptions},t.serverOptionsConfig=new n.OptionsConfig(t.serverDefaults)},902:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerOptions=void 0;const s=r(56),n=r(20),normalize=e=>e;t.ServerOptions={ws:{normalize,cliDescription:"Enable a websocket server.",default:()=>!0,legacyName:"ws",cliType:"boolean"},wsBinary:{normalize,cliDescription:"Whether or not websockets should response with binary data (ArrayBuffers) or strings.",default:()=>"auto",cliChoices:["true","false","auto"]},rpcEndpoint:{normalize,cliDescription:"Defines the endpoint route the HTTP and WebSocket servers will listen on.",default:(e,t)=>{switch(t){case s.FilecoinFlavorName:return"/rpc/v0";case s.DefaultFlavor:default:return"/"}},defaultDescription:'"/" (Ethereum), "/rpc/v0" (Filecoin)'},chunkSize:{normalize:e=>{if(e<0||e>n.kMaxLength)throw new Error(`--server.chunkSize must be >= 0 and <= ${n.kMaxLength}`);return e},cliDescription:"For memory and performance reasons ganache may respond with chunked transfer-encoding over HTTP and fragmented send over WebSockets. This option allows you to control the approximate size of each chunk.",default:()=>1048576,cliType:"number"}}},305:function(e,t,r){"use strict";var s,n,i,a,o,c,l,u,h,d=this&&this.__classPrivateFieldSet||function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r},p=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)},m=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Server=t._DefaultServerOptions=t.ServerStatus=void 0;const g=r(582);m(r(583)).default.shim();const y=m(r(627)),w=r(630);w._cfg&&(0,w._cfg)(new Uint8Array([115,105,108,101,110,116]));const b=r(56),_=m(r(406)),v=m(r(326)),k=m(r(323)),E=m(r(27));var B;!function(e){e[e.unknown=0]="unknown",e[e.ready=1]="ready",e[e.opening=2]="opening",e[e.open=4]="open",e[e.openingOrOpen=6]="openingOrOpen",e[e.closing=8]="closing",e[e.closed=16]="closed",e[e.closingOrClosed=24]="closingOrClosed"}(B=t.ServerStatus||(t.ServerStatus={})),t._DefaultServerOptions=g.serverDefaults;class Server extends E.default{constructor(e={flavor:b.DefaultFlavor}){super(),s.set(this,void 0),n.set(this,void 0),i.set(this,B.unknown),a.set(this,null),o.set(this,null),c.set(this,null),l.set(this,void 0),u.set(this,null),h.set(this,void 0),d(this,s,g.serverOptionsConfig.normalize(e),"f"),d(this,n,e,"f"),d(this,i,B.ready,"f");const t=_.default.initialize(p(this,n,"f")),r=d(this,l,t.connector,"f");d(this,h,Promise.all([t.promise,this.initialize(r)]),"f")}get provider(){return p(this,l,"f").provider}get status(){return p(this,i,"f")}async initialize(e){const t=d(this,a,(0,w.App)(),"f");p(this,s,"f").server.ws&&d(this,u,new v.default(t,e,p(this,s,"f").server),"f"),d(this,o,new k.default(t,e,p(this,s,"f").server),"f"),await e.once("ready")}listen(e,t,r){"function"==typeof t&&(r=t,t=null);const s="function"==typeof r;if("number"!=typeof e&&"string"!=typeof e||"string"==typeof e&&0===e.trim().length||+e!=+e>>>0||e>65535||0===e){const t=new Error(`Port should be >= 0 and < 65536. Received ${e}.`);return s?process.nextTick(r,t):Promise.reject(t)}const n=+e,o=p(this,i,"f");if(o===B.closing){const e=new Error("Cannot start server while it is closing.");return s?process.nextTick(r,e):Promise.reject(e)}if(0!=(o&B.openingOrOpen)){const e=new Error(`Server is already open, or is opening, on port: ${n}.`);return s?process.nextTick(r,e):Promise.reject(e)}d(this,i,B.opening,"f");const l=Promise.allSettled([p(this,h,"f"),new Promise((e=>{t?p(this,a,"f").listen(t,n,1,e):p(this,a,"f").listen(n,1,e)})).then((e=>{if(!e){d(this,i,B.closed,"f");throw new Error(`listen EADDRINUSE: address already in use ${t||"127.0.0.1"}:${n}.`)}d(this,i,B.open,"f"),d(this,c,e,"f")}))]).then((async e=>{const t=[];if("rejected"===e[0].status&&t.push(e[0].reason),"rejected"===e[1].status&&t.push(e[1].reason),0!==t.length){d(this,i,B.unknown,"f");try{await this.close()}catch(e){t.push(e)}throw t.length>1?new y.default(t):t[0]}this.emit("open")}));if(!s)return l;l.then((()=>r(null))).catch(r)}async close(){if(p(this,i,"f")===B.opening)throw new Error("Cannot close server while it is opening.");if(0!=(p(this,i,"f")&B.closingOrClosed))throw new Error("Server is already closing or closed.");d(this,i,B.closing,"f");const e=p(this,c,"f");d(this,c,null,"f"),null!==e&&(0,w.us_listen_socket_close)(e),null!==p(this,u,"f")&&p(this,u,"f").close(),null!==p(this,o,"f")&&p(this,o,"f").close(),null!==p(this,l,"f")&&await p(this,l,"f").close(),d(this,i,B.closed,"f"),d(this,a,null,"f"),await this.emit("close")}}t.Server=Server,s=new WeakMap,n=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,h=new WeakMap,t.default=Server},323:function(e,t,r){"use strict";var s,n,i,a,o,c=this&&this.__classPrivateFieldSet||function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r},l=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const h=u(r(912)),d=u(r(913)),p=r(11),m=r(647),noop=()=>{};function prepareCORSResponseHeaders(e,t){const r=t.getHeader("origin"),s=t.getHeader("access-control-request-headers");return t=>{""!==r&&("OPTIONS"===e&&(t.writeHeader("Access-Control-Allow-Methods","POST"),""!==s&&t.writeHeader("Access-Control-Allow-Headers",s),t.writeHeader("Access-Control-Max-Age","600")),t.writeHeader("Access-Control-Allow-Credentials","true"),t.writeHeader("Access-Control-Allow-Origin",r))}}function sendResponse(e,t,r,s,n,i=noop){e.cork((()=>{e.writeStatus(r),i(e),null!=s&&e.writeHeader("Content-Type",s),null!==n?e.end(n,t):e.end(void 0,t)}))}t.default=class HttpServer{constructor(e,t,r){s.set(this,void 0),n.set(this,void 0),i.set(this,!1),a.set(this,((e,t)=>{const r=prepareCORSResponseHeaders("POST",t);let a,o=!1;e.onAborted((()=>{o=!0})),e.onData(((c,u)=>{const g=Buffer.from(c);if(u){const c=l(this,s,"f");let u;try{const e=a?Buffer.concat([a,g],a.length+g.length):g;u=c.parse(e)}catch(t){return void sendResponse(e,l(this,i,"f"),d.default.BAD_REQUEST,h.default.PLAIN,"400 Bad Request: "+t.message,r)}c.handle(u,t).then((({value:e})=>e)).then((t=>{if(o)return;const s=c.format(t,u);p.types.isGeneratorObject(s)?function sendChunkedResponse(e,t,r,s,n,i,a=noop){const o=(0,m.getFragmentGenerator)(n,i),{value:c}=o.next();let{value:l,done:u}=o.next();u?sendResponse(e,t,r,s,c,a):e.cork((()=>{for(l of(e.writeStatus(r),a(e),e.writeHeader("Content-Type",s),e.write(c),e.write(l),o))e.write(l);e.end(void 0,t)}))}(e,l(this,i,"f"),d.default.OK,h.default.JSON,s,l(this,n,"f").chunkSize,r):sendResponse(e,l(this,i,"f"),d.default.OK,h.default.JSON,s,r)})).catch((t=>{if(o)return;const s=c.formatError(t,u);sendResponse(e,l(this,i,"f"),d.default.OK,h.default.JSON,s,r)}))}else a=a?Buffer.concat([a,g],a.length+g.length):Buffer.concat([g],g.length)}))})),o.set(this,((e,t)=>{const r=prepareCORSResponseHeaders("OPTIONS",t);sendResponse(e,l(this,i,"f"),d.default.NO_CONTENT,null,null,r)})),c(this,s,t,"f"),c(this,n,r,"f"),e.post(r.rpcEndpoint,l(this,a,"f")).options(r.rpcEndpoint,l(this,o,"f")),e.get("/418",(e=>{sendResponse(e,l(this,i,"f"),d.default.IM_A_TEAPOT,h.default.PLAIN,"418 I'm a teapot")})),e.any("/*",((e,t)=>{const r=t.getHeader("connection");r&&"upgrade"===r.toLowerCase()?sendResponse(e,l(this,i,"f"),d.default.BAD_REQUEST,h.default.PLAIN,"400 Bad Request"):sendResponse(e,l(this,i,"f"),d.default.NOT_FOUND,h.default.PLAIN,"404 Not Found")}))}close(){c(this,i,!0,"f")}},s=new WeakMap,n=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap},912:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.PLAIN="text/plain",e.JSON="application/json"}(r||(r={})),t.default=r},647:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFragmentGenerator=void 0,t.getFragmentGenerator=function*getFragmentGenerator(e,t){let r=Buffer.allocUnsafe(t),s=0;for(const n of e){const{byteLength:e}=n;s>0&&e+s>t&&(yield r.subarray(0,s),r=null,s=0),e<t?(null===r&&(r=Buffer.allocUnsafe(t)),n.copy(r,s,0,e),s+=e):yield n}s>0&&(yield r.subarray(0,s))}},913:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.OK="200",e.NO_CONTENT="204",e.BAD_REQUEST="400",e.NOT_FOUND="404",e.METHOD_NOT_ALLOWED="405",e.IM_A_TEAPOT="418"}(r||(r={})),t.default=r},911:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.CLOSE_NORMAL=1e3]="CLOSE_NORMAL"}(r||(r={})),t.default=r},326:function(e,t,r){"use strict";var s,n=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_PAYLOAD_SIZE=t.sendFragmented=void 0;const a=i(r(911)),o=r(11),c=r(647);function sendFragmented(e,t,r,s){e.cork((()=>{const n=(0,c.getFragmentGenerator)(t,s),{value:i}=n.next();let{value:a,done:o}=n.next();if(o)e.send(i,r);else{e.sendFirstFragment(i,r);for(const t of n)e.sendFragment(a,false),a=t;e.sendLastFragment(a,false)}}))}t.sendFragmented=sendFragmented,t.MAX_PAYLOAD_SIZE=15728640;t.default=class WebsocketServer{constructor(e,r,i){s.set(this,new Map);const a=n(this,s,"f"),c=i.wsBinary,l="auto"===c;e.ws(i.rpcEndpoint,{maxPayloadLength:t.MAX_PAYLOAD_SIZE,idleTimeout:120,open:e=>{e.closed=!1,a.set(e,new Set)},message:async(e,t,s)=>{let n;const u=l?s:c;try{n=r.parse(Buffer.from(t))}catch(t){const s=r.formatError(t,n);return void e.send(s,u)}let h;try{const{value:t}=await r.handle(n,e);if(e.closed)return;const i=t,o=await i;if(e.closed)return;if(h=r.format(o,n),"function"==typeof i.on){const t=i;t.on("message",(t=>{const r=JSON.stringify({jsonrpc:"2.0",method:t.type,params:t.data});e.send(r,s)})),a.get(e).add(t.dispose)}}catch(t){if(e.closed)return;h=r.formatError(t,n)}o.types.isGeneratorObject(h)?sendFragmented(e,h,u,i.chunkSize):e.send(h,u)},drain:e=>{},close:e=>{e.closed=!0,a.get(e).forEach((e=>e())),a.delete(e)}})}close(){n(this,s,"f").forEach(((e,t)=>t.end(a.default.CLOSE_NORMAL,"Server closed by client")))}},s=new WeakMap},910:(e,t,r)=>{var s={"./uws_darwin_arm64_108.node":632,"./uws_darwin_arm64_83.node":633,"./uws_darwin_arm64_93.node":634,"./uws_darwin_x64_108.node":635,"./uws_darwin_x64_83.node":636,"./uws_darwin_x64_93.node":637,"./uws_linux_arm64_108.node":638,"./uws_linux_arm64_83.node":639,"./uws_linux_arm64_93.node":640,"./uws_linux_x64_108.node":641,"./uws_linux_x64_83.node":642,"./uws_linux_x64_93.node":643,"./uws_win32_x64_108.node":644,"./uws_win32_x64_83.node":645,"./uws_win32_x64_93.node":646};function webpackContext(e){var t=webpackContextResolve(e);return r(t)}function webpackContextResolve(e){if(!r.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}webpackContext.keys=function webpackContextKeys(){return Object.keys(s)},webpackContext.resolve=webpackContextResolve,e.exports=webpackContext,webpackContext.id=910},56:function(__unused_webpack_module,exports,__webpack_require__){"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.GetConnector=exports.DefaultOptionsByName=exports.DefaultFlavor=exports.FilecoinFlavorName=exports.EthereumFlavorName=void 0;const ethereum_1=__webpack_require__(312),ethereum_options_1=__webpack_require__(184),filecoin_options_1=__webpack_require__(895),colors_1=__webpack_require__(110),chalk_1=__importDefault(__webpack_require__(102));__webpack_require__(45);const NEED_HELP="Need help? Reach out to the Truffle community at",COMMUNITY_LINK="https://trfl.io/support";function GetConnector(flavor,providerOptions,executor){if(flavor===exports.DefaultFlavor)return new ethereum_1.Connector(providerOptions,executor);try{if(flavor===exports.FilecoinFlavorName){flavor="@ganache/filecoin";const f=eval("require")(flavor),Connector=void 0!==f.default?f.default.Connector:f.Connector;return new Connector(providerOptions,executor)}{const{Connector:e}=__webpack_require__(901)(flavor);return new e(providerOptions,executor)}}catch(e){if(!e.message.includes(`Cannot find module '${flavor}'`))throw e;console.warn(chalk_1.default`\n\n{red.bold ERROR:} Could not find Ganache flavor "{bold filecoin}" (${flavor}); `+"it probably\nneeds to be installed.\n \u25b8 if you're using Ganache as a library run: \n"+chalk_1.default`   {blue.bold $ npm install ${flavor}}\n`+" \u25b8 if you're using Ganache as a CLI run: \n"+chalk_1.default`   {blue.bold $ npm install --global ${flavor}}\n\n`+chalk_1.default`{hex("${colors_1.TruffleColors.porsche}").bold ${NEED_HELP}}\n`+chalk_1.default`{hex("${colors_1.TruffleColors.turquoise}") ${COMMUNITY_LINK}}\n\n`),process.exit(1)}}exports.EthereumFlavorName="ethereum",exports.FilecoinFlavorName="filecoin",exports.DefaultFlavor=exports.EthereumFlavorName,exports.DefaultOptionsByName={[exports.EthereumFlavorName]:ethereum_options_1.EthereumDefaults,[exports.FilecoinFlavorName]:filecoin_options_1.FilecoinDefaults},exports.GetConnector=GetConnector},901:e=>{function webpackEmptyContext(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}webpackEmptyContext.keys=()=>[],webpackEmptyContext.resolve=webpackEmptyContext,webpackEmptyContext.id=901,e.exports=webpackEmptyContext},51:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.debug=void 0;t.debug=()=>()=>{}},45:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(839),t),n(r(840),t),n(r(841),t),n(r(332),t),n(r(842),t)},839:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},842:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeterministicSeedPhrase=void 0,t.DeterministicSeedPhrase="TestRPC is awesome!"},332:function(e,t,r){"use strict";var s,n,i=this&&this.__classPrivateFieldSet||function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r},a=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.OptionsConfig=void 0;const o=r(1),checkForConflicts=(e,t,r,s)=>{if(s)for(const n of s)if(r.has(n))throw new Error(`Values for both "${t}.${e}" and "${t}.${n}" cannot be specified; they are mutually exclusive.`)};t.OptionsConfig=class OptionsConfig{constructor(e){s.set(this,void 0),n.set(this,void 0),i(this,s,e,"f"),i(this,n,Object.keys(e),"f")}normalize(e){const t=a(this,s,"f"),r={};return a(this,n,"f").forEach((s=>{!function fill(e,t,r,s){const n=e[s],i=r[s]=r[s]||{},a=t.flavor,c=new Set,l=Object.keys(n);if((0,o.hasOwn)(t,s)){const e=t[s];for(let r=0,u=l.length;r<u;r++){const u=l[r],h=n[u];let d=e[u];if(void 0!==d){const t=h.normalize(e[u]);void 0!==t&&(checkForConflicts(u,s,c,h.conflicts),i[u]=t,c.add(u))}else if(d=t[h.legacyName||u],void 0!==d){const e=h.normalize(d);void 0!==e&&(checkForConflicts(u,s,c,h.conflicts),i[u]=e,c.add(u))}else(0,o.hasOwn)(h,"default")&&(i[u]=h.default(i,a))}}else for(let e=0,r=l.length;e<r;e++){const r=l[e],u=n[r],h=t[u.legacyName||r];if(void 0!==h){const e=u.normalize(h);void 0!==e&&(checkForConflicts(r,s,c,u.conflicts),i[r]=e,c.add(r))}else(0,o.hasOwn)(u,"default")&&(i[r]=u.default(i,a))}}(t,e,r,s)})),r}},s=new WeakMap,n=new WeakMap},841:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},840:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},320:function(e,t,r){"use strict";var s,n,i,a=this&&this.__decorate||function(e,t,r,s){var n,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(i<3?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},o=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=c(r(27)),u=c(r(887));let h=class PromiseQueue{constructor(){s.set(this,[]),n.set(this,((e,t)=>{t===e[0]?(e.shift(),t.resolve(t.value),o(this,i,"f").call(this,e)):t.resolved=!0})),i.set(this,(e=>{let t=e[0];for(;t&&t.resolved;)e.shift(),t.resolve(t.value),t=e[0];0===e.length&&this.emit("idle")}))}isBusy(){return 0!==o(this,s,"f").length}add(e){const t=o(this,s,"f"),r=new u.default(e,t,o(this,n,"f"));return t.push(r),r.promise}clear(e){const t=o(this,s,"f").splice(0);t.forEach((r=>{r.queue=t,r.value=e}))}};s=new WeakMap,n=new WeakMap,i=new WeakMap,h=a([l.default.mixin(Symbol.for("emittery"),["emit","once"])],h),t.default=h},887:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class Entry{constructor(e,t,r){this.resolved=!1,this.value=e,this.queue=t,this.onSetteled=r;const _onSetteled=()=>this.onSetteled(this.queue,this);e.then(_onSetteled,_onSetteled),this.promise=new Promise((e=>{this.resolve=e}))}}},15:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decode=t.encodeLength=t.encode=t.digest=t.encodeRange=t.getLength=void 0;const s=r(123);Object.defineProperty(t,"getLength",{enumerable:!0,get:function(){return s.getLength}});const n=r(1);function encode(e){if(Array.isArray(e)){let t=0;const r=[];for(let s=0,n=e.length;s<n;s++){const n=encode(e[s]);t+=n.length,r.push(n)}const s=Buffer.concat(r,t),n=encodeLength(t,192);return Buffer.concat([n,s],n.length+t)}if(null==e){const e=Buffer.allocUnsafe(1);return e[0]=128,e}{const t=e.length;if(1===t&&e[0]<128)return e;{const r=encodeLength(t,128);return Buffer.concat([r,e],r.length+t)}}}function encodeLength(e,t){if(e<56){const r=Buffer.allocUnsafe(1);return r[0]=e+t,r}{const r=(0,n.uintToBuffer)(e),s=r.length,i=(0,n.uintToBuffer)(t+55+s);return Buffer.concat([i,r],i.length+s)}}t.encodeRange=function encodeRange(e,t,r){let s=0;const n=t+r,i=[];for(var a=t;a<n;a++){const t=encode(e[a]);s+=t.length,i.push(t)}return{length:s,output:i}},t.digest=function digest(e,t){const r=encodeLength(t,192),s=r.length,n=Buffer.allocUnsafe(s+t);r.copy(n,0,0,s);let i=s;for(let t=0,r=e.length;t<r;t++){const r=e[t];for(let e=0,t=r.length;e<t;e++){const t=r[e],s=t.length;t.copy(n,i,0,s),i+=s}}return n},t.encode=encode,t.encodeLength=encodeLength,t.decode=function decode(e){return(0,s.decode)(e)}},63:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SECP256K1_MAX_PRIVATE_KEY_DIV_2=exports.SECP256K1_N=void 0;const path_1=__webpack_require__(12);let secp256k1;exports.SECP256K1_N=0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141n,exports.SECP256K1_MAX_PRIVATE_KEY_DIV_2=0x7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a0n;try{const nodeRequire=eval("require"),path=nodeRequire.resolve("secp256k1/package.json"),dir=(0,path_1.dirname)(path),nodeGypBuild=__webpack_require__(431),{Secp256k1}=nodeGypBuild(dir);secp256k1=new Secp256k1}catch{secp256k1=__webpack_require__(432)}exports.default=secp256k1},1:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromiEvent=t.JsonRpcErrorCode=t.makeResponse=t.makeRequest=t.makeError=t.JsonRpcType=void 0,n(r(307),t),n(r(293),t);var a=r(722);Object.defineProperty(t,"JsonRpcType",{enumerable:!0,get:function(){return a.JsonRpcType}}),n(r(724),t),n(r(725),t),n(r(726),t);var o=r(405);Object.defineProperty(t,"makeError",{enumerable:!0,get:function(){return o.makeError}}),Object.defineProperty(t,"makeRequest",{enumerable:!0,get:function(){return o.makeRequest}}),Object.defineProperty(t,"makeResponse",{enumerable:!0,get:function(){return o.makeResponse}}),Object.defineProperty(t,"JsonRpcErrorCode",{enumerable:!0,get:function(){return o.JsonRpcErrorCode}});var c=r(329);Object.defineProperty(t,"PromiEvent",{enumerable:!0,get:function(){return i(c).default}})},717:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toBigIntBE=t.toBufferBE=void 0;var s=r(198);Object.defineProperty(t,"toBufferBE",{enumerable:!0,get:function(){return s.toBufferBE}}),Object.defineProperty(t,"toBigIntBE",{enumerable:!0,get:function(){return s.toBigIntBE}})},722:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JsonRpcType=void 0;var s=r(200);Object.defineProperty(t,"JsonRpcType",{enumerable:!0,get:function(){return s.BaseJsonRpcType}})},723:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseAndValidateStringInput=t.parseAndValidateBigIntInput=t.parseAndValidateNumberInput=void 0;const s=r(402),n=r(199),i=Buffer.allocUnsafe(0);t.parseAndValidateNumberInput=function parseAndValidateNumberInput(e){if(0===e)return i;if(e<0)throw new Error("Cannot wrap a negative value as a json-rpc type");if(e%1)throw new Error("Cannot wrap a decimal as a json-rpc type");if(!isFinite(e))throw new Error(`Cannot wrap a ${e} as a json-rpc type`);return(0,n.uintToBuffer)(e)},t.parseAndValidateBigIntInput=function parseAndValidateBigIntInput(e){if(0n===e)return i;if(e<0n)throw new Error("Cannot wrap a negative value as a json-rpc type");return(0,s.bigIntToBuffer)(e)},t.parseAndValidateStringInput=function parseAndValidateStringInput(e){if("0x"!==e.slice(0,2).toLowerCase())throw new Error(`Cannot wrap string value "${e}" as a json-rpc type; strings must be prefixed with "0x".`);let t=e.slice(2);1&t.length&&(t=`0${t}`);const r=Math.ceil(e.length/2-1),s=Buffer.from(t,"hex");if(s.length!==r)throw new Error(`Cannot wrap string value "${e}" as a json-rpc type; the input value contains an invalid hex character.`);return s}},200:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseJsonRpcType=void 0;const s=r(723),n=Symbol.for("nodejs.util.inspect.custom");t.BaseJsonRpcType=class BaseJsonRpcType{constructor(e){if(null==e)this.bufferValue=null;else if(Buffer.isBuffer(e))this.bufferValue=0===e.length?null:e;else switch(typeof e){case"string":this.bufferValue=(0,s.parseAndValidateStringInput)(e);break;case"number":this.bufferValue=(0,s.parseAndValidateNumberInput)(e);break;case"bigint":this.bufferValue=(0,s.parseAndValidateBigIntInput)(e);break;default:throw new Error(`Cannot wrap a "${typeof e}" as a json-rpc type`)}}[n](e,t){return`[${this.constructor.name}] ${this.toString()}`}toString(){return null==this.bufferValue?null:`0x${this.bufferValue.toString("hex")}`}toBuffer(){return this.bufferValue}valueOf(){return this.bufferValue}toJSON(){return this.toString()}isNull(){return null==this.bufferValue}}},726:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Data=void 0;const s=r(200),n=r(111);class Data extends s.BaseJsonRpcType{constructor(e,t){if(super(e),this._byteLength=t,"bigint"==typeof e)throw new Error(`Cannot create a ${typeof e} as a Data`)}toString(e){const t=e||this._byteLength;if(null==this.bufferValue)return"0x";if(void 0===t)return super.toString();const r=this.bufferValue.toString("hex");return`0x${Data.stringToFixedByteLength(r,t)}`}toBuffer(e){if(null==this.bufferValue)return n.BUFFER_EMPTY;const t=e||this._byteLength;return null==t||t===this.bufferValue.length?this.bufferValue:Data.bufferToFixedByteLength(this.bufferValue,t)}static from(e,t){return new Data(e,t)}static stringToFixedByteLength(e,t){const r=2*t;if(r===e.length)return e;const s=r-e.length;let n;return n=s>0?"0".repeat(s)+e:e.slice(0,r),n}static bufferToFixedByteLength(e,t){if(t===e.length)return e;const r=Buffer.allocUnsafe(t),s=e.length>t?0:t-e.length;return s>0&&r.fill(0,0,s),e.copy(r,s,0,t),r}static toBuffer(e,t){return Data.from(e,t).toBuffer()}static toString(e,t){return Data.from(e,t).toString()}}t.Data=Data,Data.Empty=Data.from(n.BUFFER_EMPTY)},725:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Quantity=void 0;const s=r(403),n=r(200),i=r(111);class Quantity extends n.BaseJsonRpcType{constructor(e,t){if(super(e),this._nullable=!1,"0x"===e)throw new Error('Cannot wrap "0x" as a json-rpc Quantity type; strings must contain at least one hexadecimal character.');this._nullable=t}static from(e,t=!1){return e instanceof Quantity?e:new Quantity(e,t)}toString(){if(null==this.bufferValue)return this._nullable?null:Quantity.ZERO_VALUE_STRING;const e=this.findFirstNonZeroByteIndex();if(e===this.bufferValue.length)return Quantity.ZERO_VALUE_STRING;let t=this.bufferValue.toString("hex",e);return"0"===t[0]&&(t=t.slice(1)),`0x${t}`}toBuffer(){if(null==this.bufferValue)return i.BUFFER_EMPTY;const e=this.findFirstNonZeroByteIndex();return e>0?this.bufferValue.subarray(e):this.bufferValue}toBigInt(){return null==this.bufferValue?this._nullable?null:0n:0===this.bufferValue.length?0n:(0,s.bufferToBigInt)(this.bufferValue)}toNumber(){if(null==this.bufferValue)return this._nullable?null:0;const e=this.findFirstNonZeroByteIndex(),t=this.bufferValue.length-e;if(0===t)return 0;let r;if(t>6){const n=0===e?this.bufferValue:this.bufferValue.subarray(e,t);r=Number((0,s.bufferToBigInt)(n)),Number.isSafeInteger(r)||console.warn(`0x${this.bufferValue.toString("hex")} is too large - the maximum safe integer value is 0${Number.MAX_SAFE_INTEGER.toString(16)}`)}else r=this.bufferValue.readUIntBE(e,t);return r}valueOf(){return null==this.bufferValue?null:this.toBigInt()}findFirstNonZeroByteIndex(){let e=0;for(e=0;e<this.bufferValue.length&&0===this.bufferValue[e];e++);return e}static toBuffer(e,t){return Quantity.from(e,t).toBuffer()}static toString(e,t){return Quantity.from(e,t).toString()}static toNumber(e,t){return Quantity.from(e,t).toNumber()}static toBigInt(e,t){return Quantity.from(e,t).toBigInt()}}t.Quantity=Quantity,Quantity.Empty=Quantity.from(i.BUFFER_EMPTY,!0),Quantity.Zero=Quantity.from(i.BUFFER_ZERO),Quantity.One=Quantity.from(1),Quantity.Gwei=Quantity.from(1e9),Quantity.ZERO_VALUE_STRING="0x0",t.default=Quantity},405:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JsonRpcErrorCode=t.makeError=t.makeResponse=t.makeRequest=void 0;const r="2.0";t.makeRequest=e=>({id:e.id,jsonrpc:r,method:e.method,params:e.params});t.makeResponse=(e,t)=>({id:e,jsonrpc:r,result:t});t.makeError=(e,t,s)=>{const n={message:t.message};return Object.getOwnPropertyNames(t).forEach((e=>{"string"==typeof e&&(n[e]=t[e])})),"number"!=typeof n.code&&(n.code=-32700),void 0!==s?{id:e,jsonrpc:r,error:n,result:s}:{id:e,jsonrpc:r,error:n}},function(e){e[e.PARSE_ERROR=-32700]="PARSE_ERROR",e[e.INVALID_REQUEST=-32600]="INVALID_REQUEST",e[e.METHOD_NOT_FOUND=-32601]="METHOD_NOT_FOUND",e[e.INVALID_PARAMS=-32602]="INVALID_PARAMS",e[e.INTERNAL_ERROR=-32603]="INTERNAL_ERROR",e[e.INVALID_INPUT=-32e3]="INVALID_INPUT",e[e.TRANSACTION_REJECTED=-32003]="TRANSACTION_REJECTED",e[e.METHOD_NOT_SUPPORTED=-32004]="METHOD_NOT_SUPPORTED",e[e.LIMIT_EXCEEDED=-32005]="LIMIT_EXCEEDED",e[e.JSON_RPC_VERSION_NOT_SUPPORTED=-32006]="JSON_RPC_VERSION_NOT_SUPPORTED"}(t.JsonRpcErrorCode||(t.JsonRpcErrorCode={}))},329:function(e,t,r){"use strict";var s,n=this&&this.__decorate||function(e,t,r,s){var n,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(i<3?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(r(27)),o=["clearListeners","once","on","emit","onAny"],c=a.default.mixin.bind(a.default);let l=s=class PromiEvent extends Promise{constructor(e){super(e),this.dispose=()=>{if(!this.clearListeners)throw new Error("PromiEvent already disposed");this.clearListeners();const fn=()=>{throw new Error("PromiEvent bound after dispose")};o.filter((e=>"emit"!==e)).forEach((e=>{Object.defineProperty(this,e,{enumerable:!1,value:fn})}))}}catch(e){const t=new s(((r,s)=>{this.onAny(((e,r)=>t.emit(e,r)));super.catch(e).then(r,s)}));return t}static resolve(e){return new s((t=>{t(e)}))}};l=s=n([c(Symbol.for("emittery"),o)],l),t.default=l},724:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},716:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},714:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},307:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(714),t),n(r(715),t),n(r(716),t)},715:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},402:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bigIntToBuffer=void 0;const s=r(717),n=r(199),i=Buffer.allocUnsafe;let a;function bigIntByteLength(e){let t=1;for(;e>>=8n;)t++;return t}const o=BigInt(Number.MAX_SAFE_INTEGER);try{if(!s.toBufferBE)throw new Error("Missing function `toBufferBE`!");a=e=>{if(e<=o)return(0,n.uintToBuffer)(Number(e));{const t=bigIntByteLength(e);return(0,s.toBufferBE)(e,t)}}}catch{a=e=>{if(e<=o)return(0,n.uintToBuffer)(Number(e));{let t=bigIntByteLength(e);const r=i(t);do{r[--t]=Number(0xffffffffn&e),e>>=8n}while(t);return r}}}t.bigIntToBuffer=a},403:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bufferToBigInt=void 0;const s=r(198);t.bufferToBigInt=function bufferToBigInt(e){const t=e.byteLength;if(0===t)return null;if(t<=6)return BigInt(e.readUIntBE(0,t));let r;if(7===t){const t=new Uint8Array(8);t.set(e,1),r=new DataView(t.buffer)}else{if(8!==t)return(0,s.toBigIntBE)(e);r=new DataView(e.buffer,e.byteOffset,t)}return r.getBigUint64(0)}},720:(e,t)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.bufferToMinHexKey=void 0,r="function"==typeof Buffer.prototype.latin1Slice?(e,t,r)=>e.hexSlice(t,r):(e,t,r)=>e.slice(t,r).toString("hex"),t.bufferToMinHexKey=function bufferToMinHexKey(e){for(let t=0,n=e.byteLength;t<n;t++){const i=e[t];if(0!==i)return t+1===n?s[i]:r(e,t,n)}return""};const s=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]},111:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KNOWN_CHAINIDS=t.WEI=t.BUFFER_8_ZERO=t.BUFFER_32_ZERO=t.BUFFER_ZERO=t.BUFFER_EMPTY=t.ACCOUNT_ZERO=t.BUFFER_256_ZERO=void 0,t.BUFFER_256_ZERO=Buffer.allocUnsafe(256).fill(0),t.ACCOUNT_ZERO=t.BUFFER_256_ZERO.slice(0,20),t.BUFFER_EMPTY=Buffer.allocUnsafe(0),t.BUFFER_ZERO=t.BUFFER_256_ZERO.slice(0,1),t.BUFFER_32_ZERO=t.BUFFER_256_ZERO.slice(0,32),t.BUFFER_8_ZERO=t.BUFFER_256_ZERO.slice(0,8),t.WEI=1000000000000000000n,t.KNOWN_CHAINIDS=new Set([1,3,4,5,42,11155111])},327:function(e,t,r){"use strict";var s,n=this&&this.__classPrivateFieldSet||function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r},i=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.Executor=void 0;const a=r(404);t.Executor=class Executor{constructor(e){s.set(this,void 0),n(this,s,e,"f")}execute(e,t,r){if("string"==typeof t&&((0,a.hasOwn)(e.__proto__,t)&&"constructor"!==t||(0,a.hasOwn)(e,t))){const n=e[t];if("function"==typeof n)return i(this,s,"f").queue(n,e,r)}throw new Error(`The method ${t} does not exist/is not available`)}},s=new WeakMap},721:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findInsertPosition=void 0,t.findInsertPosition=function findInsertPosition(e,t,r){let s=e.length,n=0,i=0;for(;s>0;){const a=s/2|0;i+=a,r(t,e[i])?(s=a,i=n):(n=++i,s-=a+1)}return n}},404:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasOwn=void 0;const r={}.hasOwnProperty.call.bind({}.hasOwnProperty);t.hasOwn=(e,t)=>null!=e&&r(e,t)},718:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Heap=void 0;class Heap{constructor(e,t){this.length=0,this.array=[],this.less=e,this.refresher=t}init(e){this.array=e;const t=this.length=e.length;for(let e=(t/2|0)-1;e>=0;)this.down(e--,t)}refresh(e){const t=this.length,r=t/2|0;for(let s=r;s<t;s++)this.refresher(this.array[s],e);for(let s=r-1;s>=0;)this.refresher(this.array[s],e),this.down(s--,t)}push(e){const t=this.length++;this.array[t]=e,this.up(t)}size(){return this.length}peek(){return this.array[0]}clear(){this.length=this.array.length=0}shift(){const e=this.length;if(e<=1){if(0===e)return;const t=this.array[0];return this.clear(),t}const t=this.array,r=t[0],s=this.length=e-1;return t[0]=t[s],this.down(0,s),r}replaceBest(e){this.array[0]=e,this.down(0,this.length)}replace(e,t){this.array[e]=t,this.fix(e)}remove(e){const t=--this.length;t!==e&&(this.swap(e,t),this.down(e,t)||this.up(e))}removeBest(){const e=this.array;if(1===this.length)return this.length=e.length=0,!1;const t=--this.length;return e[0]=e[t],this.down(0,t),!0}fix(e){this.down(e,this.length)||this.up(e)}up(e){const t=this.less.bind(null,this.array);for(let r;r=(e-1)/2|0,r!==e&&t(e,r);e=r)this.swap(r,e)}down(e,t){const r=this.less.bind(null,this.array);let s,n=e;for(;(s=2*n+1)<t;){let e=s,i=s+1;if(i<t&&r(i,s)&&(e=i),!r(e,n))break;this.swap(n,e),n=e}return n>e}swap(e,t){const r=this.array,s=r[e];r[e]=r[t],r[t]=s}static from(e,t,r){const s=new Heap(t,r);return s.array=[e],s.length=1,s}}t.Heap=Heap},293:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(402),t),n(r(403),t),n(r(327),t),n(r(718),t),n(r(328),t),n(r(719),t),n(r(404),t),n(r(199),t),n(r(111),t),n(r(720),t),n(r(343),t),n(r(721),t),n(r(344),t)},343:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.keccak=void 0;const n=s(r(118)),i=(0,n.default)("keccak256");t.keccak=function keccak(e){i._state.absorb(e);const t=i._state.squeeze(32);return i._state.initialize(1088,512),i._finalized=!1,t}},344:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RandomNumberGenerator=void 0;const n=s(r(83));t.RandomNumberGenerator=class RandomNumberGenerator{constructor(e,t){if("string"==typeof e&&void 0===t)this.rng=n.default.alea(e,{state:!0});else if("object"==typeof t)this.rng=n.default.alea("",{state:t});else{const e=Math.random()*Date.now();this.rng=n.default.alea(`${e}`,{state:!0})}}getNumber(e=1){return 1!==e?this.rng()*e:this.rng()}getNumbers(e,t=1){const r=[];for(let s=0;s<e;s++)r.push(this.getNumber(t));return r}getBuffer(e){return Buffer.from(this.getNumbers(e,256))}state(){return this.rng.state()}}},328:function(e,t){"use strict";var r,s,n=this&&this.__classPrivateFieldSet||function(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r},i=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.RequestCoordinator=void 0;const noop=()=>{};t.RequestCoordinator=class RequestCoordinator{constructor(e){this.pending=[],this.runningTasks=0,r.set(this,!0),this.pause=()=>{n(this,r,!0,"f")},this.resume=()=>{n(this,r,!1,"f"),i(this,s,"f").call(this)},s.set(this,(()=>{for(;!this.paused&&this.pending.length>0&&(!this.limit||this.runningTasks<this.limit);){const e=this.pending.shift();this.runningTasks++,e().catch(noop).finally((()=>{this.runningTasks--,i(this,s,"f").call(this)}))}})),this.queue=(e,t,r)=>new Promise(((n,a)=>{this.pending.push((async()=>{try{const s=Reflect.apply(e,t,r||[]);return n({value:s}),s}catch(e){a(e)}})),i(this,s,"f").call(this)})),this.limit=e}get paused(){return i(this,r,"f")}},r=new WeakMap,s=new WeakMap},199:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uintToBuffer=void 0;const r=4294967295,s=Buffer.allocUnsafe;t.uintToBuffer=function uintToBuffer(e){return e>r?function uintWideToBuf(e){let t,n=Number(BigInt(e)>>32n);const i=n;let a=0;if(n>>>=8){const e=n;if(n>>>=8){const r=n;(n>>>=8)?(t=s(8),t[0]=n,t[1]=r,t[2]=e,t[3]=i,a=7):(t=s(7),t[0]=r,t[1]=e,t[2]=i,a=6)}else t=s(6),t[0]=e,t[1]=i,a=5}else t=s(5),t[0]=i,a=4;let o=e&r;const c=o;if(o>>>=8){const e=o;if(o>>>=8){const r=o;t[a-3]=o>>>=8,t[a-2]=r,t[a-1]=e,t[a]=c}else t[a-3]=0,t[a-2]=0,t[a-1]=e,t[a]=c}else t[a-3]=0,t[a-2]=0,t[a-1]=0,t[a]=c;return t}(e):function uint32ToBuf(e){let t;const r=e;if(e>>>=8){const n=e;if(e>>>=8){const i=e;(e>>>=8)?(t=s(4),t[0]=e,t[1]=i,t[2]=n,t[3]=r):(t=s(3),t[0]=i,t[1]=n,t[2]=r)}else t=s(2),t[0]=n,t[1]=r}else t=s(1),t[0]=r;return t}(e)}},719:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unref=void 0,t.unref=function unref(e){return"object"==typeof e&&"function"==typeof e.unref&&(e.unref(),!0)}}};
//# sourceMappingURL=1.js.map